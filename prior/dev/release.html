<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>pgBackRest Releases</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8"></meta><meta property="og:site_name" content="pgBackRestReliable PostgreSQL Backup &amp; Restore"></meta><meta property="og:title" content="pgBackRest Releases"></meta><meta property="og:type" content="website"></meta><link rel="icon" href="favicon.png" type="image/png"></link><meta property="og:image:type" content="image/png"></meta><meta property="og:image" content="http://www.pgbackrest.org/logo.png"></meta><meta name="description" content="The pgBackRest Releases detail each version of the software and lists the changes made in each version."></meta><meta property="og:description" content="The pgBackRest Releases detail each version of the software and lists the changes made in each version."></meta><link rel="stylesheet" href="default.css" type="text/css"></link></head><body><div class="page-header"><div class="page-header-title">pgBackRest Releases</div></div><div class="page-menu"><div class="menu-body"><div class="menu"><a class="menu-link" href="index.html">Home</a></div><div class="menu"><a class="menu-link" href="user-guide.html">User Guide</a></div><div class="menu"><a class="menu-link" href="configuration.html">Configuration</a></div><div class="menu"><a class="menu-link" href="command.html">Commands</a></div></div></div><div class="page-toc"><div class="page-toc-header"><div class="page-toc-title">Table of Contents</div></div><div class="page-toc-body"><div class="section1-toc"><div class="section1-toc-title"><a href="#introduction">Introduction</a></div></div><div class="section1-toc"><div class="section1-toc-title"><a href="#development">Development Notes</a></div><div class="section2-toc"><div class="section2-toc-title"><a href="#2.12dev">v2.12dev Notes</a></div></div></div><div class="section1-toc"><div class="section1-toc-title"><a href="#current">Current Stable Release</a></div><div class="section2-toc"><div class="section2-toc-title"><a href="#2.11">v2.11 Release Notes</a></div></div></div><div class="section1-toc"><div class="section1-toc-title"><a href="#supported">Stable Releases</a></div></div><div class="section1-toc"><div class="section1-toc-title"><a href="#unsupported">Pre-Stable Releases</a></div></div></div></div><div class="page-body"><div class="section1"><a id="introduction"></a><div class="section1-header"><div class="section1-title">Introduction</div></div><div class="section-intro"><span class="backrest">pgBackRest</span> release numbers consist of two parts, major and minor. A major release <i>may</i> break compatibility with the prior major release, but <span class="host">v2</span> releases are fully compatible with <span class="host">v1</span> repositories and will accept all <span class="host">v1</span> options. Minor releases can include bug fixes and features but do not change the repository format and strive to avoid changing options and naming.<br/>
<br/>
Documentation for the <span class="host">v1</span> release can be found <a href="http://www.pgbackrest.org/1">here</a>.<br/>
<br/>
The notes for a release may also contain <q>Additional Notes</q> but changes in this section are only to documentation or the test suite and have no direct impact on the <span class="backrest">pgBackRest</span> codebase.</div><div class="section-body"></div></div><div class="section1"><a id="development"></a><div class="section1-header"><div class="section1-title">Development Notes</div></div><div class="section-body"><div class="section2"><a id="2.12dev"></a><div class="section2-header"><div class="section2-title">v2.12dev Notes</div></div><div class="section-body"><div class="section2-subtitle">UNDER DEVELOPMENT</div><div class="section2-subsubtitle">No Release Date Set</div><div class="section-body-text"><b>IMPORTANT NOTE</b>: The new <span class="host">TLS</span>/<span class="host">SSL</span> implementation forbids dots in <span class="host">S3</span> bucket names per RFC-2818. This security fix is required for compliant hostname verification.</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fix issues when a path option is / terminated. (<i>Reported by Marc Cousin.</i>)</li><li class="list-unordered">Fix issue setting <span class="br-option">log-level-file=off</span> for the <span class="cmd">archive-get</span> command. (<i>Reported by Brad Nicholson.</i>)</li><li class="list-unordered">Fix C code to recognize <span class="id">host:port</span> option format like Perl does. (<i>Reported by Kyle Nevins.</i>)</li><li class="list-unordered">Fix issues with <span class="id">remote</span>/<span class="id">local</span> command logging options.</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">The <span class="cmd">archive-push</span> command is implemented entirely in C.</li><li class="list-unordered">Increase <span class="br-option">process-max</span> limit to <span class="id">999</span>. (<i>Suggested by Rakshitha-BR.</i>)</li><li class="list-unordered">Improve error message when an <span class="host">S3</span> bucket name contains dots.</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Add separate <span class="cmd">archive-push-async</span> command.</li><li class="list-unordered"><span class="id">CryptoHash</span> improvements and fixes. Fix incorrect buffer size used in <span class="id">cryptoHashOne()</span>. Add missing <span class="id">const</span> to <span class="id">cryptoHashOne()</span> and <span class="id">cryptoHashOneStr()</span>. Add hash size constants. Extern hash type constant.</li><li class="list-unordered">Add <span class="id">CIFS</span> storage driver.</li><li class="list-unordered">Add file write to the remote and S3 storage drivers.</li><li class="list-unordered">Add <span class="id">storageRepoWrite()</span> and <span class="id">storagePg()</span>/<span class="id">storagePgWrite()</span> to storage helper.</li><li class="list-unordered">Use a single file to handle global errors in async archiving.</li><li class="list-unordered">Add document creation to XML objects.</li><li class="list-unordered">Remove redundant documentation from <span class="postgres">PostgreSQL</span> interface files and clarify ambiguous function names.</li><li class="list-unordered">Add WAL info to <span class="postgres">PostgreSQL</span> interface.</li><li class="list-unordered">Refactor <span class="postgres">PostgreSQL</span> interface to remove most code duplication.</li><li class="list-unordered">Logging improvements. Allow three-digits process IDs in logging. Allow process id in C logging.</li><li class="list-unordered">Add process id to <span class="id">ProtocolParallelJob</span>.</li><li class="list-unordered">Add process id to C <span class="cmd">archive-get</span> and <span class="cmd">archive-push</span> logging.</li><li class="list-unordered">Close log file before <span class="id">exec()</span>.</li><li class="list-unordered">Allow warnings to be written by <span class="id">archiveAsyncStatusOkWrite()</span>.</li><li class="list-unordered">Move WAL path prefix logic into <span class="id">walPath()</span>.</li><li class="list-unordered">Make notion of current <span class="postgres">PostgreSQL</span> info ID in C align with Perl.</li><li class="list-unordered">Add locking capability to the remote command.</li><li class="list-unordered">Add <span class="id">forkSafe()</span> to handle fork errors.</li><li class="list-unordered">Add <span class="id">httpHeaderDup()</span>.</li><li class="list-unordered"><span class="id">httpClientRequest()</span> accepts a body parameter.</li><li class="list-unordered">Add <span class="id">protocolKeepAlive()</span> to send <span class="id">noops</span> to all remotes.</li><li class="list-unordered">Make <span class="id">strLstDup()</span> null-tolerant.</li><li class="list-unordered">Add <span class="id">strLstMergeAnti()</span> for merge anti-joins.</li><li class="list-unordered">Add <span class="id">cvtSSizeToZ()</span> and debug macros.</li><li class="list-unordered">Remove unused <span class="id">infoArchiveCheckPg()</span> function.</li><li class="list-unordered">Add constants for <span class="file">.ok</span>/<span class="file">.error</span> status extensions.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Clarify that S3-compatible object stores are supported. (<i>Suggested by Magnus Hagander.</i>)</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Build test harness with the same warnings as code being tested.</li><li class="list-unordered">Add <span class="id">TEST_64BIT()</span> macro to detect 64-bit platforms.</li><li class="list-unordered">Skip coverage for macros with numbers in their name.</li><li class="list-unordered">Use <span class="cmd">restore</span> command for remote performances tests.</li></ul></div></div></div></div><div class="section1"><a id="current"></a><div class="section1-header"><div class="section1-title">Current Stable Release</div></div><div class="section-body"><div class="section2"><a id="2.11"></a><div class="section2-header"><div class="section2-title">v2.11 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">C Implementation of Archive Get</div><div class="section2-subsubtitle">Released March 11, 2019</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fix possible truncated WAL segments when an error occurs mid-write. (<i>Reported by blogh.</i>)</li><li class="list-unordered">Fix info command missing WAL min/max when stanza specified. (<i>Fixed by Stefan Fercot.</i>)</li><li class="list-unordered">Fix non-compliant JSON for options passed from C to Perl. (<i>Reported by Leo Khomenko.</i>)</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">The <span class="cmd">archive-get</span> command is implemented entirely in C.</li><li class="list-unordered">Enable socket keep-alive on older <span class="host">Perl</span> versions. (<i>Contributed by Marc Cousin.</i>)</li><li class="list-unordered">Error when parameters are passed to a command that does not accept parameters. (<i>Suggested by Jason O'Donnell.</i>)</li><li class="list-unordered">Add hints when unable to find a WAL segment in the archive. (<i>Suggested by Hans-J&uuml;rgen Sch&ouml;nig.</i>)</li><li class="list-unordered">Improve error when hostname cannot be found in a certificate. (<i>Suggested by James Badger.</i>)</li><li class="list-unordered">Add additional options to <span class="file">backup.manifest</span> for debugging purposes. (<i>Contributed by blogh.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Migrate <span class="cmd">local</span> and <span class="cmd">remote</span> commands to C.</li><li class="list-unordered">Add separate <span class="cmd">archive-get-async</span> command.</li><li class="list-unordered">Add <span class="id">ProtocolParallel*</span> objects for parallelizing commands.</li><li class="list-unordered">Add <span class="id">ProtocolCommand</span> object.</li><li class="list-unordered">Add <span class="id">exists()</span> to remote storage.</li><li class="list-unordered">Resolve storage path expressions before passing to remote.</li><li class="list-unordered">Expose handle (file descriptor) from <span class="id">IoRead</span> when applicable.</li><li class="list-unordered">Add <span class="id">storageHelperFree()</span> to storage helper.</li><li class="list-unordered">Add <span class="id">kvKeyExists()</span> to <span class="id">KeyValue</span> object.</li><li class="list-unordered">Add <span class="id">lstRemove()</span> to <span class="id">List</span> object.</li><li class="list-unordered">Allow <span class="id">cfgExecParam()</span> to exclude options.</li><li class="list-unordered"><span class="id">MemContext</span> improvements. Improve performance of context and memory allocations. Use <span class="id">contextTop</span>/<span class="id">contextCurrent</span> instead of <span class="id">memContextTop()</span>/<span class="id">memContextCurrent()</span>. Don't make a copy of the context name.</li><li class="list-unordered">Make <span class="id">DESTDIR</span> fully-configurable in the <span class="file">Makefile</span>. (<i>Contributed by Douglas J Hunley.</i>)</li><li class="list-unordered">Add note for <span class="id">CSTD</span> settings on BSD variants. (<i>Suggested by ucando, jungle-boogie, Luca Ferrari.</i>)</li><li class="list-unordered">Add <span class="id">clean</span> and <span class="id">uninstall</span> targets to <span class="file">Makefile</span>. (<i>Contributed by Luca Ferrari.</i>)</li><li class="list-unordered">Change <span class="id">execRead()</span> to return a <span class="id">size_t</span>. (<i>Contributed by Stephen Frost.</i>)</li><li class="list-unordered">Prevent option warning from being output when running help command.</li><li class="list-unordered">Improve null-handling of <span class="id">strToLog()</span> and <span class="id">varToLog()</span>.</li><li class="list-unordered">Increase per-call stack trace size to <span class="id">4096</span>.</li><li class="list-unordered">Move <span class="id">compress</span> module to <span class="id">common/compress</span>.</li><li class="list-unordered">Move <span class="id">crypto</span> module to <span class="id">common/crypto</span>.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Update default documentation version to <span class="postgres">PostgreSQL</span> 10.</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Add instructions for building the coverage report.</li><li class="list-unordered">Documentation builds on <span class="postgres">PostgreSQL</span> 9.4-10.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Create test matrix for <span class="id">mock/archive</span>, <span class="id">mock/archive-stop</span>, <span class="id">mock/all</span>, <span class="id">mock/expire</span>, and <span class="id">mock/stanza</span> to increase coverage and reduce tests.</li><li class="list-unordered">Improve fork harness to allow multiple children and setup pipes automatically.</li><li class="list-unordered">Reduce expect log level in <span class="id">mock/archive</span> and <span class="id">mock/stanza</span> tests.</li><li class="list-unordered">Rename test modules for consistency.</li><li class="list-unordered">Only run test-level stack trace by default for unit-tested modules.</li><li class="list-unordered">Add missing ToLog() coverage to <span class="id">String</span>, <span class="id">List</span>, and <span class="id">PgControl</span>.</li><li class="list-unordered">Create aliases for test VMs ordered by age.</li></ul></div></div></div></div><div class="section1"><a id="supported"></a><div class="section1-header"><div class="section1-title">Stable Releases</div></div><div class="section-body"><div class="section2"><a id="2.10"></a><div class="section2-header"><div class="section2-title">v2.10 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Bug Fixes</div><div class="section2-subsubtitle">Released February 9, 2019</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Add unimplemented <span class="host">S3</span> driver method required for <span class="cmd">archive-get</span>. (<i>Reported by mibiio.</i>)</li><li class="list-unordered">Fix check for improperly configured <span class="br-option">pg-path</span>. (<i>Reported by James Chanco Jr.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">JSON improvements. Optimize parser implementation. Make the renderer more null tolerant.</li><li class="list-unordered">Automatically adjust <span class="br-option">db-timeout</span> when <span class="br-option">protocol-timeout</span> is smaller.</li></ul></div></div><div class="section2"><a id="2.09"></a><div class="section2-header"><div class="section2-title">v2.09 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Minor Improvements and Bug Fixes</div><div class="section2-subsubtitle">Released January 30, 2019</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fix issue with multiple async status files causing a hard error. (<i>Reported by Vidhya Gurumoorthi, Joe Ayers, Douglas J Hunley.</i>)</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">The <span class="cmd">info</span> command is implemented entirely in C.</li><li class="list-unordered">Simplify <span class="cmd">info</span> command text message when no stanzas are present by replacing the repository path with <q>the repository</q>.</li><li class="list-unordered">Add <span class="id">_DARWIN_C_SOURCE</span> flag to Makefile for <span class="host">MacOS</span> builds. (<i>Contributed by Douglas J Hunley.</i>)</li><li class="list-unordered">Update address lookup in C TLS client to use modern methods. (<i>Suggested by Bruno Friedmann.</i>)</li><li class="list-unordered">Include Posix-compliant header for <span class="id">strcasecmp()</span> and <span class="id">fd_set</span>. (<i>Suggested by ucando.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Add remote storage objects.</li><li class="list-unordered">Add <span class="id">ProtocolClient</span> object and helper functions.</li><li class="list-unordered">Add <span class="id">Exec</span> object.</li><li class="list-unordered">Add <span class="id">IoHandleRead</span> and <span class="id">IoHandleWrite</span> objects.</li><li class="list-unordered">Add <span class="id">cfgExecParam()</span> to generate parameters for executing commands.</li><li class="list-unordered">Ignore <span class="id">SIGPIPE</span> signals and check <span class="id">EPIPE</span> result instead.</li><li class="list-unordered">Function log macro improvements. Rename FUNCTION_DEBUG_* and consolidate ASSERT_* macros for consistency. Improve <span class="id">CONST</span> and <span class="id">P</span>/<span class="id">PP</span> type macro handling. Move <span class="id">MACRO_TO_STR()</span> to <span class="file">common/debug.h</span>. Remove unused type parameter from <span class="id">FUNCTION_TEST_RETURN()</span>.</li><li class="list-unordered">Make the <span class="host">C</span> version of the <span class="cmd">info</span> command conform to the <span class="host">Perl</span> version.</li><li class="list-unordered">Improve accuracy of <span class="id">strSizeFormat()</span>.</li><li class="list-unordered">Add <span class="id">ioReadBuf()</span> to easily read into a buffer.</li><li class="list-unordered">JSON improvements. Allow empty arrays in JSON parser. Fix null output in JSON renderer. Fix escaping in JSON string parser/renderer.</li><li class="list-unordered">Allocate extra space for concatenations in the <span class="id">String</span> object.</li><li class="list-unordered">Return <span class="id">UnknownError</span> from <span class="id">errorTypeFromCode()</span> for invalid error codes.</li><li class="list-unordered">Update Perl repo rules to work when stanza is not specified.</li><li class="list-unordered">Update <span class="id">Storage::Local->list()</span> to accept an undefined path.</li><li class="list-unordered">Null-terminate list returned by <span class="id">strLstPtr()</span>.</li><li class="list-unordered">Add <span class="id">kvMove()</span> and <span class="id">varLstMove()</span>.</li><li class="list-unordered">Replace <span class="id">FileOpenError</span> with <span class="id">HostConnectError</span> in <span class="id">TlsClient</span>.</li><li class="list-unordered">Allow string <span class="id">Variant</span> objects to contain <span class="id">null</span>.</li><li class="list-unordered">Rename <span class="id">common/io/handle</span> module to <span class="id">common/io/handleWrite</span>.</li><li class="list-unordered">Add <span class="id">const VariantList *</span> debug type.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fix hard-coded repository path. (<i>Reported by Heath Lord.</i>)</li></ul><div class="section-body-text"><b>Documentation Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Clarify that encryption is always performed client-side. (<i>Suggested by Bruce Burdick.</i>)</li><li class="list-unordered">Add examples for building a documentation host.</li><li class="list-unordered">Allow <span class="id">if</span> in manifest variables, lists, and list items.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Move C module include in <span class="file">test.c</span> above headers included for testing.</li><li class="list-unordered">Allow primary <span class="id">gid</span> for the test user to be different from <span class="id">uid</span>.</li><li class="list-unordered">Increase timeout in <span class="id">storage/s3</span> module to improve reliability.</li></ul></div></div><div class="section2"><a id="2.08"></a><div class="section2-header"><div class="section2-title">v2.08 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Minor Improvements and Bug Fixes</div><div class="section2-subsubtitle">Released January 2, 2019</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Remove request for S3 object info directly after putting it. (<i>Reported by Matt Kunkel.</i>)</li><li class="list-unordered">Correct <span class="br-option">archive-get-queue-max</span> to be <span class="id">size</span> type. (<i>Reported by Ronan Dunklau.</i>)</li><li class="list-unordered">Add error message when current user <span class="id">uid</span>/<span class="id">gid</span> does not map to a name. (<i>Reported by Camilo Aguilar.</i>)</li><li class="list-unordered">Error when <span class="br-option">--target-action=shutdown</span> specified for <span class="postgres">PostgreSQL</span> < 9.5.</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Set TCP keepalives on <span class="host">S3</span> connections. (<i>Suggested by Ronan Dunklau.</i>)</li><li class="list-unordered">Reorder <span class="cmd">info</span> command text output so most recent backup is output last. (<i>Contributed by Cynthia Shang. Suggested by Ryan Lambert.</i>)</li><li class="list-unordered">Change file ownership only when required.</li><li class="list-unordered">Redact <span class="id">authentication</span> header when throwing <span class="host">S3</span> errors. (<i>Suggested by Brad Nicholson.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Enable S3 storage and encryption for <span class="cmd">archive-get</span> command in C.</li><li class="list-unordered">Migrate local <span class="cmd">info</span> command to C. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Add <span class="host">S3</span> storage driver.</li><li class="list-unordered">Add <span class="id">HttpClient</span> object.</li><li class="list-unordered">Add <span class="id">TlsClient</span> object.</li><li class="list-unordered">Add interface objects for <span class="host">libxml2</span>.</li><li class="list-unordered">Add encryption capability to <span class="id">Info*</span> objects.</li><li class="list-unordered">Add <span class="id">IoFilter</span> interface to <span class="id">CipherBlock</span> object.</li><li class="list-unordered">Allow arbitary <span class="id">InOut</span> filters to be chained in <span class="id">IoFilterGroup</span>.</li><li class="list-unordered">Add <span class="id">infoBackup</span> object to encapsulate the <span class="file">backup.info</span> file. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Improve JSON to <span class="id">Variant</span> conversion and add <span class="id">Variant</span> to JSON conversion. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Storage helper improvements. Allow <span class="id">NULL</span> stanza in storage helper. Add path expression for repository backup. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Info module improvements. Rename constants in <span class="id">Info</span> module for consistency. Remove <span class="id">#define</span> statements in the <span class="id">InfoPg</span> module to conform with newly-adopted coding standards. Use cast to make for loop more readable in <span class="id">InfoPg</span> module. Add <span class="id">infoArchiveIdHistoryMatch()</span> to the <span class="id">InfoArchive</span> object. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Allow I/O read interface to explicitly request blocking reads.</li><li class="list-unordered">Improve error messages when info files are missing/corrupt. (<i>Contributed by David Steele, Cynthia Shang.</i>)</li><li class="list-unordered">Add <span class="id">strSizeFormat()</span> to <span class="id">String</span> object. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Add <span class="id">strLstInsert()</span> and <span class="id">strLstInsertZ()</span> to <span class="id">StringList</span> object.</li><li class="list-unordered">Rename <span class="id">PGBACKREST</span>/<span class="id">BACKREST</span> constants to <span class="id">PROJECT</span>.</li><li class="list-unordered">Require <span class="host">S3</span> key options except for <span class="cmd">local</span>/<span class="cmd">remote</span> commands.</li><li class="list-unordered">Explicitly compile with Posix 2001 standard.</li><li class="list-unordered">Add <span class="id">ServiceError</span> for errors from a service that can be retried.</li><li class="list-unordered">Conditional compilation of Perl logic in <span class="file">exit.c</span>.</li><li class="list-unordered">Merge <span class="id">cipher.h</span> into <span class="id">crypto.h</span>.</li><li class="list-unordered">Remove extraneous <span class="id">use</span>/<span class="id">include</span> statements.</li><li class="list-unordered">Remove embedded semicolon from <span class="id">String</span> constant macros.</li><li class="list-unordered">Reduce debug level for <span class="id">infoIni()</span> to test.</li><li class="list-unordered">Return <span class="id">IoFilterGroup *</span> from <span class="id">ioFilterGroupAdd()</span>.</li><li class="list-unordered">Add coding standards for <span class="id">String</span> constants.</li><li class="list-unordered">Add missing <span class="id">LOG_DEBUG()</span> macro.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Clarify when <span class="br-option">target-action</span> is effective and <span class="postgres">PostgreSQL</span> version support. (<i>Suggested by Keith Fiske.</i>)</li><li class="list-unordered">Clarify that region/endpoint must be configured correctly for the bucket. (<i>Suggested by Pritam Barhate.</i>)</li><li class="list-unordered">Add documentation for building the documentation.</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Add <span class="id">admonitions</span> to all documentation renderers (HTML, PDF, Markdown and help text) and update <span class="file">xml</span> files accordingly. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Add HTML table rendering and update PDF/Markdown renderers to support header-less tables. Add optional table captions. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Escape special characters in latex when not in a code block. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Base menu ordering on natural ordering in the manifest. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Replace keywords with more flexible if statements.</li><li class="list-unordered">Pre-build containers for any <span class="id">execute</span> elements marked <span class="id">pre</span>.</li><li class="list-unordered">Documentation may be built with user-specified packages.</li><li class="list-unordered">Add Centos/RHEL 7 option to documentation build.</li><li class="list-unordered">Allow custom logo for PDF documentation. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Modify general document elements to allow any child element. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Use absolute paths so that <span class="file">./doc.pl</span> runs.</li><li class="list-unordered">Pick <span class="id">pg_switch_wal()</span>/<span class="id">pg_switch_xlog()</span> based on <span class="postgres">PostgreSQL</span> version.</li><li class="list-unordered">Add configuration to the standby so it works as a primary when promoted.</li><li class="list-unordered">Create common <span class="id">if</span> expressions for testing <span class="id">os-type</span>.</li><li class="list-unordered">Add <span class="id">zlib1g-dev</span> to <span class="host">Debian</span> builds.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">New test containers with static test certificates.</li><li class="list-unordered">Fix test binary name for <span class="file">gprof</span>.</li><li class="list-unordered">Allow arbitrary multiplier and flush character in <span class="id">IoTestFilterMultiply</span>.</li><li class="list-unordered">Update URL for Docker install.</li><li class="list-unordered">Add <span class="id">testRepoPath()</span> to let C unit tests know where the code repository is located.</li><li class="list-unordered">Merge <span class="file">common/typeStringListTest</span> module into <span class="file">common/typeStringTest</span>.</li><li class="list-unordered">Merge <span class="file">common/typeVariantListTest</span> module into <span class="file">common/typeVariantTest</span>.</li></ul></div></div><div class="section2"><a id="2.07"></a><div class="section2-header"><div class="section2-title">v2.07 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Automatic Backup Checksum Delta</div><div class="section2-subsubtitle">Released November 16, 2018</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fix issue with <span class="br-option">archive-push-queue-max</span> not being honored on connection error. (<i>Reported by Lardi&egrave;re S&eacute;bastien.</i>)</li><li class="list-unordered">Fix static WAL segment size used to determine if <span class="br-option">archive-push-queue-max</span> has been exceeded.</li><li class="list-unordered">Fix error after log file open failure when processing should continue. (<i>Reported by vthriller.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Automatically enable backup checksum delta when anomalies (e.g. timeline switch) are detected. (<i>Contributed by Cynthia Shang.</i>)</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Retry all S3 <span class="id">5xx</span> errors rather than just <span class="id">500</span> internal errors. (<i>Suggested by Craig A. James.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Correct current history item in <span class="id">InfoPg</span> to always be in position 0. (<i>Contributed by Cynthia Shang, David Steele.</i>)</li><li class="list-unordered">Make <span class="id">ioReadLine()</span> read less aggressively.</li><li class="list-unordered">Add <span class="id">ioWriteFlush()</span> to flush pending output.</li><li class="list-unordered">Add destructors to <span class="id">IoRead</span> and <span class="id">IoWrite</span> objects.</li><li class="list-unordered">Add <span class="id">base</span> variants to all integer to string conversion functions.</li><li class="list-unordered">Add <span class="id">lstInsert()</span> to <span class="id">List</span> object.</li><li class="list-unordered">Add <span class="id">strCatChr()</span>, <span class="id">strEmpty()</span>, and constant macros to <span class="id">String</span> object.</li><li class="list-unordered">Add <span class="id">regExpPrefix()</span> to aid in static prefix searches.</li><li class="list-unordered">Correct <span class="id">cfgDefDataFind()</span> to use <span class="id">UINTP</span> instead of <span class="id">VOIDPP</span>. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Change <span class="id">infoArchiveCheckPg()</span> to display the <span class="postgres">PostgreSQL</span> version as a string (e.g. 9.4) instead of the integer representation (e.g. 90400) when throwing an error. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Allow storage path and file mode to be 0.</li><li class="list-unordered">Limit usable <span class="id">Buffer</span> size without changing allocated size.</li><li class="list-unordered">Construct <span class="id">Wait</span> object in milliseconds instead of fractional seconds.</li><li class="list-unordered">Add <span class="id">THROW*_ON_SYS_ERROR*</span> macros to test and throw system errors.</li><li class="list-unordered">Add <span class="id">KernelError</span> to report miscellaneous kernel errors.</li><li class="list-unordered">Use <span class="id">THROW_ON_SYS_ERROR</span> macro to improve <span class="id">fork</span> code coverage.</li><li class="list-unordered"><span class="id">Storage</span> interface methods no longer declare the driver as const.</li><li class="list-unordered">Add <span class="id">memContextCallbackClear()</span> to prevent double <span class="id">free()</span> calls.</li><li class="list-unordered">Merge <span class="file">crypto/random</span> module into <span class="file">crypto/crypto</span>.</li><li class="list-unordered">Add <span class="id">cryptoError()</span> and update crypto code to use it.</li><li class="list-unordered">Rename <span class="id">CipherError</span> to <span class="id">CryptoError</span>.</li><li class="list-unordered">Reword misleading message in stack trace when parameter buffer is full.</li><li class="list-unordered">Add logging macros for <span class="id">TimeMSec</span> type.</li><li class="list-unordered">Modify value of <span class="id">PERL_EMBED_ERROR</span> macro.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Add new HTML tags and <span class="id">strExtra</span> to <span class="id">DocHtmlElement</span>.</li><li class="list-unordered">Remove error suppression for <span class="backrest">pgBackRest</span> <span class="file">make</span>.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">New test containers. Add libxml2 library needed for S3 development. Include new minor version upgrades for <span class="postgres">PostgreSQL</span>. Remove <span class="postgres">PostgreSQL</span> 11 beta/rc repository.</li><li class="list-unordered">Test speed improvements. Mount <span class="id">tmpfs</span> in <span class="file">Vagrantfile</span> instead <span class="file">test.pl</span>. Preserve contents of C unit test build directory between <span class="file">test.pl</span> executions. Improve efficiency of code generation.</li><li class="list-unordered">New, concise coverage report for C.</li><li class="list-unordered">Add <span class="id">TEST_LOG()</span> and <span class="id">TEST_LOG_FMT()</span> macros.</li><li class="list-unordered">Improve alignment of expected vs. actual error test results.</li><li class="list-unordered">Add time since the beginning of the run to each test statement.</li></ul></div></div><div class="section2"><a id="2.06"></a><div class="section2-header"><div class="section2-title">v2.06 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Checksum Delta Backup and PostgreSQL 11 Support</div><div class="section2-subsubtitle">Released October 15, 2018</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fix missing URI encoding in S3 driver. (<i>Reported by Dan Farrell.</i>)</li><li class="list-unordered">Fix incorrect error message for duplicate options in configuration files. (<i>Reported by Jesper St John.</i>)</li><li class="list-unordered">Fix incorrectly reported error return in <span class="id">info</span> logging. A return code of 1 from the <span class="cmd">archive-get</span> was being logged as an error message at <span class="id">info</span> level but otherwise worked correctly.</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Add checksum delta for incremental backups which uses checksums rather than timestamps to determine if files have changed. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered"><span class="postgres">PostgreSQL</span> 11 support, including configurable WAL segment size.</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Ignore all files in a linked tablespace directory except the subdirectory for the current version of <span class="postgres">PostgreSQL</span>. Previously an error would be generated if other files were present and not owned by the <span class="postgres">PostgreSQL</span> user.</li><li class="list-unordered">Improve <span class="cmd">info</span> command to display the stanza cipher type. (<i>Contributed by Cynthia Shang. Suggested by Douglas J Hunley.</i>)</li><li class="list-unordered">Improve support for special characters in filenames.</li><li class="list-unordered">Allow <span class="br-option">delta</span> option to be specified in the <span class="backrest">pgBackRest</span> configuration file. (<i>Contributed by Cynthia Shang.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Migrate local, unencrypted, non-S3 <span class="cmd">archive-get</span> command to C.</li><li class="list-unordered">Storage refactoring. Posix file functions now differentiate between open and missing errors. Don't use negations in objects below Storage. Rename posix driver files/functions for consistency. Full abstraction of storage driver interface. Merge protocol storage helper into storage helper. Add CIFS driver to storage helper for read-only repositories.</li><li class="list-unordered">Update all interfaces to use variable parameter constructors.</li><li class="list-unordered">Info objects now parse JSON and use specified storage.</li><li class="list-unordered">Add <span class="id">ioReadLine()</span>/<span class="id">ioWriteLine()</span> to <span class="id">IoRead</span>/<span class="id">IoWrite</span> objects.</li><li class="list-unordered">Add helper for repository storage.</li><li class="list-unordered">Add <span class="id">cryptoHmacOne()</span> for HMAC support.</li><li class="list-unordered">Add <span class="id">cfgDefOptionMulti()</span> to identify multi-value options.</li><li class="list-unordered">Add <span class="id">bufNewZ()</span> and <span class="id">bufHex()</span> to <span class="id">Buffer</span> object. (<i>Contributed by David Steele, Stephen Frost.</i>)</li><li class="list-unordered">Allow <span class="id">hashSize()</span> to run on remote storage. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Restore <span class="id">bIgnoreMissing</span> flag in <span class="id">backupFile()</span> lost in storage refactor. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Migrate <span class="id">walIsPartial()</span>, <span class="id">walIsSegment()</span>, and <span class="id">walSegmentFind()</span> from Perl to C.</li><li class="list-unordered">Migrate control functions to detect stop files to C.</li><li class="list-unordered">Make archive-get info messages consistent between C and Perl implementations.</li><li class="list-unordered">Change locking around async process forking to be more test friendly.</li><li class="list-unordered">Simplify debug logging by allowing log functions to return <span class="id">String</span> objects.</li><li class="list-unordered">Improve documentation in <span class="id">filter.h</span> and <span class="id">filter.internal.h</span>.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Use <span class="id">command</span> in <span class="file">authorized_hosts</span> to improve SSH security. (<i>Suggested by Stephen Frost, Magnus Hagander.</i>)</li><li class="list-unordered">List allowable values for the <span class="br-option">buffer-size</span> option in the configuration reference. (<i>Contributed by Cynthia Shang. Suggested by St&eacute;phane Schildknecht.</i>)</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Update introduction to be pithy.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Install <span class="host">nodejs</span> from <span class="id">deb.nodesource.com</span>.</li><li class="list-unordered">Disable flapping <span class="id">archive/get</span> unit on CentOS 6.</li><li class="list-unordered">Move test expect log out of the regular test directory.</li><li class="list-unordered">Fix buffer underrun in configuration test harness.</li><li class="list-unordered">Fix missing test caused by a misplaced YAML tag.</li><li class="list-unordered">Make Valgrind return an error even when a non-fatal issue is detected. Update some minor issues discovered in the tests as a result.</li><li class="list-unordered">Add <span class="id">-ftree-coalesce-vars</span> option to unit test compilation.</li><li class="list-unordered">Clear test directory between test runs.</li><li class="list-unordered">Allow C or Perl coverage to run on more than one VM.</li><li class="list-unordered">Don't perform valgrind when requested.</li><li class="list-unordered">Remove compiler warnings that are not valid for u16.</li><li class="list-unordered">Merge all posix storage tests into a single unit.</li><li class="list-unordered">Add <span class="file">.gitignore</span> to C <span class="path">src</span> directory. (<i>Contributed by Stephen Frost.</i>)</li><li class="list-unordered">Fix typo in unit test error messages, EXECTED => EXPECTED.</li><li class="list-unordered">Make comment blocks consistent across all tests.</li></ul></div></div><div class="section2"><a id="2.05"></a><div class="section2-header"><div class="section2-title">v2.05 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Environment Variable Options and Exclude Temporary/Unlogged Relations</div><div class="section2-subsubtitle">Released August 31, 2018</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fix issue where <i>relative</i> links in <span class="path">$PGDATA</span> could be stored in the backup with the wrong path. This issue did not affect absolute links and relative tablespace links were caught by other checks. (<i>Reported by Cynthia Shang.</i>)</li><li class="list-unordered">Remove incompletely implemented <span class="br-option">online</span> option from the <span class="cmd">check</span> command. Offline operation runs counter to the purpose of this command, which is to check if archiving and backups are working correctly. (<i>Reported by Jason O'Donnell.</i>)</li><li class="list-unordered">Fix issue where errors raised in C were not logged when called from Perl. <span class="backrest">pgBackRest</span> properly terminated with the correct error code but lacked an error message to aid in debugging. (<i>Reported by Douglas J Hunley.</i>)</li><li class="list-unordered">Fix issue when a boolean option (e.g. <span class="br-option">delta</span>) was specified more than once. (<i>Reported by Yogesh Sharma.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Allow any option to be set in an environment variable. This includes options that previously could only be specified on the command line, e.g. <span class="br-option">stanza</span>, and secret options that could not be specified on the command-line, e.g. <span class="br-option">repo1-s3-key-secret</span>.</li><li class="list-unordered">Exclude temporary and unlogged relation (table/index) files from backup. Implemented using the same logic as the patches adding this feature to <span class="postgres">PostgreSQL</span>, <a href="https://git.postgresql.org/pg/commitdiff/8694cc96b52a967a49725f32be7aa77fd3b6ac25">8694cc96</a> and <a href="https://git.postgresql.org/pg/commitdiff/920a5e500a119b03356fb1fb64a677eb1aa5fc6f">920a5e50</a>. Temporary relation exclusion is enabled in <span class="postgres">PostgreSQL</span> &ge; <span class="id">9.0</span>. Unlogged relation exclusion is enabled in <span class="postgres">PostgreSQL</span> &ge; <span class="id">9.1</span>, where the feature was introduced. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Allow arbitrary directories and/or files to be excluded from a backup. Misuse of this feature can lead to inconsistent backups so read the <span class="br-option">--exclude</span> documentation carefully before using. (<i>Reviewed by Cynthia Shang.</i>)</li><li class="list-unordered">Add <span class="br-option">log-subprocess</span> option to allow file logging for <span class="id">local</span> and <span class="id">remote</span> subprocesses.</li><li class="list-unordered"><span class="postgres">PostgreSQL</span> 11 Beta 3 support.</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Allow zero-size files in backup manifest to reference a prior manifest regardless of timestamp delta. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Improve asynchronous <span class="cmd">archive-get</span>/<span class="cmd">archive-push</span> performance by directly checking status files. (<i>Contributed by Stephen Frost.</i>)</li><li class="list-unordered">Improve error message when a command is missing the <span class="br-option">stanza</span> option. (<i>Suggested by Sarah Conway.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Validate configuration options in a single pass. By pre-calculating and storing the option dependencies in <span class="file">parse.auto.c</span> validation can be completed in a single pass, which is both simpler and faster.</li><li class="list-unordered">Add gzip compression/decompression filters for C.</li><li class="list-unordered">Improve performance of string to int conversion. Use <span class="id">strtoll()</span> instead of <span class="id">sprintf()</span> for conversion. Also use available integer min/max constants rather than hard-coded values. (<i>Reviewed by Stephen Frost. Suggested by Stephen Frost.</i>)</li><li class="list-unordered">Add <span class="id">uint64</span> variant type and supporting conversion functions. (<i>Contributed by Cynthia Shang. Reviewed by Stephen Frost.</i>)</li><li class="list-unordered">Add basic C JSON parser.</li><li class="list-unordered">Migrate minimum set of code for reading <span class="file">archive.info</span> files from Perl to C. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Allow <span class="id">Buffer</span> object <q>used size</q> to be different than <q>allocated size</q>. Add functions to manage used size and remaining size and update automatically when possible.</li><li class="list-unordered">Abstract IO layer out of the storage layer. This allows the routines to be used for IO objects that do not have a storage representation. Implement buffer read and write IO objects. Implement filters and update <span class="id">cryptoHash</span> to use the new interface. Implement size and buffer filters. (<i>Reviewed by Cynthia Shang.</i>)</li><li class="list-unordered"><span class="id">storageFileRead()</span> accepts a buffer for output rather than creating one. This is more efficient overall and allows the caller to specify how many bytes will be read on each call. Reads are appended if the buffer already contains data but the buffer size will never increase.</li><li class="list-unordered">Add <span class="id">iniSectionList()</span> to <span class="id">Ini</span> object and remove dead code. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Manifest improvements. Require <span class="postgres">PostgreSQL</span> catalog version when instantiating a <span class="id">Manifest</span> object (and not loading it from disk). Prevent manifest from being built more than once. Limit manifest build recursion (i.e. links followed) to sixteen levels to detect link loops. (<i>Contributed by David Steele, Cynthia Shang.</i>)</li><li class="list-unordered">Do nothing in <span class="id">memContextMove()</span> when the context is already in the specified parent.</li><li class="list-unordered">Allow command/option constants to autonumber in both C and Perl to reduce churn when a new command/option is added.</li><li class="list-unordered">Show exact log level required for stack trace param output instead of just <q>debug</q>.</li><li class="list-unordered">Update <span class="id">Archive::Info->archiveIdList()</span> to return a valid error code instead of unknown.</li><li class="list-unordered">Add <span class="id">cvtBoolToConstZ()</span> to simplify conversion of boolean to string.</li><li class="list-unordered">Add <span class="id">cvtZToUInt()</span> to convert string to unsigned int.</li><li class="list-unordered">Enable <span class="id">-Wstrict-prototypes</span>, <span class="id">-Wpointer-arith</span>, <span class="id">-Wduplicated-branches</span>, <span class="id">-Wvla</span>, and <span class="id">-Wduplicated-cond</span> and update code to conform where necessary.</li><li class="list-unordered">Rename error-handling variables in <span class="id">Main.pm</span> to conform to standard.</li><li class="list-unordered">Remove redundant lines from embedded Perl by combining blank lines.</li><li class="list-unordered">Define cipher magic size with <span class="id">sizeof()</span> rather than using a constant.</li><li class="list-unordered">Add <span class="id">cvtCharToZ()</span> and macro for debugging <span class="id">char</span> params.</li><li class="list-unordered">Add <span class="id">strReplaceChr()</span> to <span class="id">String</span> object.</li><li class="list-unordered">Correct <span class="id">OptionInvalidError</span> to <span class="id">OptionInvalidValueError</span> in boolean option parsing.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fix invalid log level in <span class="br-option">log-path</span> option reference. (<i>Reported by Camilo Aguilar.</i>)</li></ul><div class="section-body-text"><b>Documentation Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Stop trying to arrange contributors in <span class="file">release.xml</span> by last/first name. Contributor names have always been presented in the release notes exactly as given, but we tried to assign internal IDs based on last/first name which can be hard to determine and ultimately doesn't make sense. Inspired by Christophe's <span class="host">PostgresOpen 2017</span> talk, <q>Human Beings Do Not Have a Primary Key</q>. (<i>Suggested by Christophe Pettus.</i>)</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Allow containers to be defined in a document. The defined containers are built before the document build begins which allows them to be reused.</li><li class="list-unordered">Move most host setup to containers defined in the documentation. This includes <span class="postgres">PostgreSQL</span> installation which had previously been included in the documentation. This way produces faster builds and there is no need for us to document <span class="postgres">PostgreSQL</span> installation.</li></ul><div class="section-body-text"><b>Test Suite Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Error if LibC build is performed outside the test environment. LibC is no longer required for production builds.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Use pre-built images from Docker Hub when the container definition has not changed. Downloading an image is quite a bit faster than building a new image from scratch and saves minutes per test run in CI.</li><li class="list-unordered">Refactor the <span class="id">common/log</span> tests to not depend on <span class="id">common/harnessLog</span>. <span class="id">common/harnessLog</span> was not ideally suited for general testing and made all the tests quite awkward. Instead, move all code used to test the <span class="id">common/log</span> module into the <span class="id">logTest</span> module and repurpose <span class="id">common/harnessLog</span> to do log expect testing for all other tests in a cleaner way. Add a few exceptions for config testing since the log levels are reset by default in <span class="id">config/parse</span>.</li><li class="list-unordered">Add <span class="br-setting">--log-level-test</span> option. This allows setting the test log level independently from the general test harness setting, but current only works for the C tests. It is useful for seeing log output from functions on the console while a test is running.</li><li class="list-unordered">Improve error reporting for <span class="id">TEST_ASSIGN()</span> and <span class="id">TEST_RESULT_VOID()</span> macros.</li><li class="list-unordered">Update code count for new file types and exclusions.</li></ul></div></div><div class="section2"><a id="2.04"></a><div class="section2-header"><div class="section2-title">v2.04 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Critical Bug Fix for Backup Resume</div><div class="section2-subsubtitle">Released July 5, 2018</div><div class="section-body-text"><b>IMPORTANT NOTE</b>: This release fixes a critical bug in the backup resume feature. All resumed backups prior to this release should be considered inconsistent. A backup will be resumed after a prior backup fails, unless <span class="br-option">resume=n</span> has been specified. A resumed backup can be identified by checking the backup log for the message <q>aborted backup of same type exists, will be cleaned to remove invalid files and resumed</q>. If the message exists, do not use this backup or any backup in the same set for a restore and check the restore logs to see if a resumed backup was restored. If so, there may be inconsistent data in the cluster.</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fix critical bug in resume that resulted in inconsistent backups. A regression in <span class="id">v0.82</span> removed the timestamp comparison when deciding which files from the aborted backup to keep on resume. See note above for more details. (<i>Reported by David Youatt, Yogesh Sharma, Stephen Frost.</i>)</li><li class="list-unordered">Fix error in selective restore when only one user database exists in the cluster. (<i>Fixed by Cynthia Shang. Reported by Nj Baliyan.</i>)</li><li class="list-unordered">Fix non-compliant ISO-8601 timestamp format in S3 authorization headers. AWS and some gateways were tolerant of space rather than zero-padded hours while others were not. (<i>Fixed by Andrew Schwartz.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered"><span class="postgres">PostgreSQL</span> 11 Beta 2 support.</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Improve the HTTP client to set <span class="id">content-length</span> to 0 when not specified by the server. S3 (and gateways) always set <span class="id">content-length</span> or <span class="id">transfer-encoding</span> but <span class="id">HTTP 1.1</span> does not require it and proxies (e.g. <span class="host">HAProxy</span>) may not include either. (<i>Suggested by Adam K. Sumner.</i>)</li><li class="list-unordered">Set <span class="id">search_path = 'pg_catalog'</span> on <span class="postgres">PostgreSQL</span> connections. (<i>Suggested by Stephen Frost.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Move cryptographic hash functions to C using <span class="host">OpenSSL</span>.</li><li class="list-unordered">Split log levels into separate header file. Many modules that use <span class="id">debug.h</span> do not need to do logging so this reduces dependencies for those modules.</li><li class="list-unordered">Auto-generate Makefile with dependencies.</li><li class="list-unordered">Rename <span class="id">cipher</span> module to the more general <span class="id">crypto</span>.</li><li class="list-unordered">Update Debian package to add debug symbols to <span class="backrest">pgBackRest</span> executable.</li><li class="list-unordered">Convert the not very portable <span class="id">uint</span> type to <span class="id">unsigned int</span>. (<i>Suggested by Devrim G&uuml;nd&uuml;z.</i>)</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Create a new section to describe building <span class="backrest">pgBackRest</span> and build on a separate host.</li><li class="list-unordered">Add sample S3 policy to restrict bucket privileges. (<i>Suggested by Douglas J Hunley, Jason O'Donnell.</i>)</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Fix default location of <span class="file">pgbackrest.conf</span> in option reference.</li><li class="list-unordered">Preliminary documentation for <span class="postgres">PostgreSQL</span> 11 unprivileged user backup.</li><li class="list-unordered">Remove call to <span class="file">lscpu</span> which can vary widely by build host.</li><li class="list-unordered">Build containers from scratch for more accurate testing. Use a prebuilt s3 server container.</li><li class="list-unordered">Document generator improvements. Allow parameters to be passed when a container is created. Allow <span class="file">/etc/hosts</span> update to be skipped (for containers without bash). Allow environment load to be skipped. Allow bash wrapping to be skipped. Allow forcing a command to run as a user without sudo. Allow an entire execute list to be hidden.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Add zero-length file to <span class="id">mock</span>/<span class="id">all</span> test.</li><li class="list-unordered">Update primary test environment (Vagrant and Docker) to Ubuntu 18.04.</li><li class="list-unordered">Improve efficiency of C library builds now that they are used only for testing.</li><li class="list-unordered">Remove RHEL and Debian package patches since they have been committed upstream.</li><li class="list-unordered">Update parameters for <span class="file">VBoxService</span> start.</li><li class="list-unordered">Make <span class="file">ls</span> ordering deterministic in <span class="id">mock</span>/<span class="id">all</span> test.</li></ul></div></div><div class="section2"><a id="2.03"></a><div class="section2-header"><div class="section2-title">v2.03 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Single Executable to Deploy</div><div class="section2-subsubtitle">Released May 22, 2018</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fix potential buffer overrun in error message handling. (<i>Reported by L&aelig;titia.</i>)</li><li class="list-unordered">Fix archive write lock being taken for the synchronous <span class="cmd">archive-get</span> command. (<i>Reported by uspen.</i>)</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Embed exported C functions and Perl modules directly into the <span class="backrest">pgBackRest</span> executable.</li><li class="list-unordered">Use <span class="id">time_t</span> instead of <span class="id">__time_t</span> for better portability. (<i>Suggested by Nick Floersch.</i>)</li><li class="list-unordered">Print total runtime in milliseconds at command end.</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Add stack trace macros to all functions. Low-level functions only include stack trace in test builds while higher-level functions ship with stack trace built-in. Stack traces include all parameters passed to the function but production builds only create the parameter list when the log level is set high enough, i.e. <span class="id">debug</span> or <span class="id">trace</span> depending on the function.</li><li class="list-unordered">Build <span class="path">libc</span> using links rather than referencing the C files in <span class="path">src</span> directly. The C library builds with different options which should not be reused for the C binary or vice versa.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Test harness improvements. Allow more than one test to provide coverage for the same module. Add option to disable valgrind. Add option to disabled coverage. Add option to disable debug build. Add option to disable compiler optimization. Add <span class="id">--dev-test</span> mode.</li><li class="list-unordered">Update SSL error message test on CentOS 7.</li><li class="list-unordered">Set <span class="br-option">log-timestamp=n</span> for integration tests. This means less filtering of logs needs to be done and new timestamps can be added without adding new filters.</li></ul></div></div><div class="section2"><a id="2.02"></a><div class="section2-header"><div class="section2-title">v2.02 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Parallel Asynchronous Archive Get and Configuration Includes</div><div class="section2-subsubtitle">Released May 6, 2018</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fix directory syncs running recursively when only the specified directory should be synced. (<i>Reported by Craig A. James.</i>)</li><li class="list-unordered">Fix <span class="br-option">archive-copy</span> throwing <q>path not found</q> error for incr/diff backups. (<i>Reported by yummyliu, Vitaliy Kukharik.</i>)</li><li class="list-unordered">Fix failure in manifest build when two or more files in <span class="id">PGDATA</span> are linked to the same directory. (<i>Reported by Vitaliy Kukharik.</i>)</li><li class="list-unordered">Fix delta restore failing when a linked file is missing.</li><li class="list-unordered">Fix rendering of key/value and list options in help. (<i>Reported by Clinton Adams.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Add asynchronous, parallel <span class="cmd">archive-get</span>. This feature maintains a queue of WAL segments to help reduce latency when <span class="postgres">PostgreSQL</span> requests a WAL segment with <span class="pg-option">restore_command</span>.</li><li class="list-unordered">Add support for additional <span class="backrest">pgBackRest</span> configuration files in the directory specified by the <span class="br-option">--config-include-path</span> option. Add <span class="br-option">--config-path</span> option for overriding the default base path of the <span class="br-option">--config</span> and <span class="br-option">--config-include-path</span> option. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Add <span class="br-option">repo-s3-token</span> option to allow temporary credentials tokens to be configured. <span class="backrest">pgBackRest</span> currently has no way to request new credentials so the entire command (e.g. <span class="cmd">backup</span>, <span class="cmd">restore</span>) must complete before the credentials expire. (<i>Contributed by Yogesh Sharma.</i>)</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Update the <span class="br-option">archive-push-queue-max</span>, <span class="br-option">manifest-save-threshold</span>, and <span class="br-option">buffer-size</span> options to accept values in <span class="id">KB</span>, <span class="id">MB</span>, <span class="id">GB</span>, <span class="id">TB</span>, or <span class="id">PB</span> where the multiplier is a power of <span class="id">1024</span>. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Make backup/restore path sync more efficient. Scanning the entire directory can be very expensive if there are a lot of small tables. The backup manifest contains the path list so use it to perform syncs instead of scanning the backup/restore path.</li><li class="list-unordered">Show command parameters as well as command options in initial info log message.</li><li class="list-unordered">Rename <span class="br-option">archive-queue-max</span> option to <span class="br-option">archive-push-queue-max</span> to avoid confusion with the new <span class="br-option">archive-get-queue-max</span> option. The old option name will continue to be accepted.</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Make <span class="path">backup.history</span> sync more efficient. Only the <span class="path">backup.history/[year]</span> directory was being synced, so check if the <span class="path">backup.history</span> is newly created and sync it as well.</li><li class="list-unordered">Move async forking and more error handling to C. The Perl process was exiting directly when called but that interfered with proper locking for the forked async process. Now Perl returns results to the C process which handles all errors, including signals.</li><li class="list-unordered">Improved lock implementation written in C. Now only two types of locks can be taken: <span class="id">archive</span> and <span class="id">backup</span>. Most commands use one or the other but the <span class="cmd">stanza-*</span> commands acquire both locks. This provides better protection than the old command-based locking scheme.</li><li class="list-unordered">Storage object improvements. Convert all functions to variadic functions. Enforce read-only storage. Add <span class="id">storageLocalWrite()</span> helper function. Add <span class="id">storageCopy()</span>, <span class="id">storageExists()</span>, <span class="id">storageMove()</span>, <span class="id">storageNewRead()</span>/<span class="id">storageNewWrite()</span>, <span class="id">storagePathCreate()</span>, <span class="id">storagePathRemove()</span>, <span class="id">storagePathSync()</span>, and <span class="id">storageRemove()</span>. Add <span class="id">StorageFileRead</span> and <span class="id">StorageFileWrite</span> objects. Abstract Posix driver code into a separate module. Call <span class="id">storagePathRemove()</span> from the Perl Posix driver.</li><li class="list-unordered">Improve <span class="id">String</span> and <span class="id">StringList</span> objects. Add <span class="id">strUpper()</span>, <span class="id">strLower()</span>, <span class="id">strLstExists()</span>, <span class="id">strLstExistsZ()</span>, <span class="id">strChr()</span>, <span class="id">strSub()</span>, <span class="id">strSubN()</span>, and <span class="id">strTrunc()</span>. (<i>Contributed by Cynthia Shang, David Steele.</i>)</li><li class="list-unordered">Improve <span class="id">Buffer</span> object. Add <span class="id">bufNewC()</span>, <span class="id">bufEq()</span> and <span class="id">bufCat()</span>. Only reallocate buffer when the size has changed.</li><li class="list-unordered">Add <span class="id">pgControlInfo()</span> to read <span class="file">pg_control</span> and determine the <span class="postgres">PostgreSQL</span> version.</li><li class="list-unordered">Add <span class="id">walSegmentNext()</span> and <span class="id">walSegmentRange()</span>.</li><li class="list-unordered">Error handling improvments. Add <span class="id">THROWP_</span>* macro variants for error handling. These macros allow an <span class="id">ErrorType</span> pointer to be passed and are required for functions that may return different errors based on a parameter. Add <span class="id">_FMT</span> variants for all <span class="id">THROW</span> macros so format types are checked by the compiler.</li><li class="list-unordered">Split <span class="id">cfgLoad()</span> into multiple functions to make testing easier. Mainly this helps with unit tests that need to do log expect testing.</li><li class="list-unordered">Allow <span class="id">MemContext</span> objects to be copied to a new parent. This makes it easier to create objects and then copy them to another context when they are complete without having to worry about freeing them on error. Update <span class="id">List</span>, <span class="id">StringList</span>, and <span class="id">Buffer</span> to allow moves. Update <span class="id">Ini</span> and <span class="id">Storage</span> to take advantage of moves.</li><li class="list-unordered">Full branch coverage in C code.</li><li class="list-unordered">Refactor <span class="id">usec</span> to <span class="id">msec</span> in <span class="id">common/time.c</span>. The implementation provides <span class="id">usec</span> resolution but this is not needed in practice and it makes the interface more complicated due to the extra zeros.</li><li class="list-unordered">Replace <span class="id">THROW_ON_SYS_ERROR()</span> with <span class="id">THROW_SYS_ERROR()</span>. The former macro was hiding missing branch coverage for critical error handling.</li><li class="list-unordered">Start work on C handle io object and use it to output help.</li><li class="list-unordered">Don't copy <span class="id">CFGDEF_NAME_ALT</span> or <span class="id">CFGDEF_INHERIT</span> when processing config option inheritance.</li><li class="list-unordered">Split debug and assert code into separate headers. Assert can be used earlier because it only depends on the error-handler and not logging. Add <span class="id">ASSERT()</span> macro which is preserved in production builds.</li><li class="list-unordered">Cleanup C types. Remove <span class="id">typec.h</span>. Order all typdefs above local includes.</li><li class="list-unordered">Fix header exclusion defines that do not match the general pattern.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Update docs with 32-bit support and caveats. 32-bit support was added in <span class="host">v1.26</span>. (<i>Reported by Viorel Tabara.</i>)</li></ul><div class="section-body-text"><b>Documentation Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Add monitoring examples using <span class="postgres">PostgreSQL</span> and <span class="host">jq</span>. (<i>Suggested by Stephen Frost, Brian Faherty.</i>)</li><li class="list-unordered">Add example of command section usage to archiving configuration. (<i>Suggested by Christophe Courtois.</i>)</li><li class="list-unordered">Remove documentation describing <span class="id">info --output=json</span> as experimental.</li><li class="list-unordered">Update out-of-date description for the <span class="br-option">spool-path</span> option.</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Add logic to find the real oid of the <span class="id">test1</span> database during restore testing.</li><li class="list-unordered">Document build improvements. Perform <span class="id">apt-get update</span> to ensure packages are up to date before installing. Add <span class="id">-p</span> to the repository <span class="file">mkdir</span> so it won't fail if the directory already exists, handy for testing packages.</li></ul><div class="section-body-text"><b>Test Suite Features:</b></div><ul class="list-unordered"><li class="list-unordered">Use <span class="host">lcov</span> for C unit test coverage reporting. Switch from <span class="host">Devel::Cover</span> because it would not report on branch coverage for reports converted from <span class="host">gcov</span>. Incomplete branch coverage for a module now generates an error. Coverage of unit tests is not displayed in the report unless they are incomplete for either statement or branch coverage.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Move test definitions to <span class="file">test/define.yaml</span>. The location is better because it is no longer buried in the Perl test libs. Also, the data can be easily accessed from C.</li><li class="list-unordered">Move help/version integration tests to <span class="id">mock/all</span>. Help and version are covered by unit tests, so we really just to need to make sure there is output when called from the command line.</li><li class="list-unordered">Move <span class="id">archive-stop</span> and <span class="id">expire</span> tests to the <span class="id">mock</span> module. These are mock integration tests so they should be grouped with the other mock integration tests.</li><li class="list-unordered">Add <span class="id">harnessCfgLoad()</span> test function, which allows a new config to be loaded for unit testing without resetting log functions, opening a log file, or taking locks.</li><li class="list-unordered">Add <span class="id">HARNESS_FORK</span> macros for tests that require fork(). A standard pattern for tests makes fork() easier to use and should help prevent some common mistakes.</li><li class="list-unordered">Add <span class="id">TEST_ERROR_FMT</span> macro to simplify testing of formatted error messages.</li><li class="list-unordered">Generate code counts for all source files. The source files are also classified by type and purpose.</li><li class="list-unordered">Include VM type in <span class="id">gcov</span> path to avoid conflicts between VMs with different architectures.</li><li class="list-unordered">Improve logic for smart builds to include version changes. Skip version checks when testing in <span class="br-setting">--dev</span> mode.</li><li class="list-unordered">Use <span class="host">pip 9.03</span> in test VMs. <span class="host">pip 10</span> drops support for <span class="host">Python 2.6</span> which is still used by the older test VMs.</li><li class="list-unordered">Allow <span class="id">-DDEBUG_UNIT</span> to be suppressed to test how debug macros behave.</li><li class="list-unordered">Rename Perl tests so they don't conflict with their C counterparts.</li><li class="list-unordered">Divide tests into three types (<span class="id">unit</span>, <span class="id">integration</span>, <span class="id">performance</span>). Many options that were set per test can instead be inferred from the types, i.e. <span class="id">container</span>, <span class="id">c</span>, <span class="id">expect</span>, and <span class="id">individual</span>.</li><li class="list-unordered">Try tweaking time sync settings to prevent clock drift rather than restarting <span class="id">VBoxService</span> on every test run.</li></ul></div></div><div class="section2"><a id="2.01"></a><div class="section2-header"><div class="section2-title">v2.01 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Minor Bug Fixes and Improvements</div><div class="section2-subsubtitle">Released March 19, 2018</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fix <span class="br-option">--target-action</span> and <span class="br-option">--recovery-option</span> options being reported as invalid when restoring with <span class="br-option">--type=immediate</span>. (<i>Reported by Brad Nicholson.</i>)</li><li class="list-unordered">Immediately error when a secure option (e.g. <span class="br-option">repo1-s3-key</span>) is passed on the command line. Since <span class="backrest">pgBackRest</span> would not pass secure options on to sub-processes an obscure error was thrown. The new error is much clearer and provides hints about how to fix the problem. Update command documentation to omit secure options that cannot be specified on the command-line. (<i>Reported by Brad Nicholson.</i>)</li><li class="list-unordered">Fix issue passing <span class="br-option">--no-config</span> to embedded Perl. (<i>Reported by Ibrahim Edib Kokdemir.</i>)</li><li class="list-unordered">Fix issue where specifying <span class="br-setting">log-level-stderr</span> > <span class="id">warn</span> would cause a <span class="cmd">local</span>/<span class="cmd">remote</span> process to error on exit due to output found on stderr when none was expected. The max value for a <span class="cmd">local</span>/<span class="cmd">remote</span> process is now <span class="id">error</span> since there is no reason for these processes to emit warnings. (<i>Reported by Clinton Adams.</i>)</li><li class="list-unordered">Fix manifest test in the <span class="cmd">check</span> command when tablespaces are present. (<i>Fixed by Cynthia Shang. Reported by Thomas Flatley.</i>)</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Error when multiple arguments are set in the config file for an option that does not accept multiple arguments. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Remove extraneous sudo commands from <span class="file">src/Makefile</span>. (<i>Contributed by Adrian Vondendriesch.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Improve Perl configuration. Set config before <span class="id">Main::main()</span> call to avoid secrets being exposed in a stack trace. Move logic for setting defaults to C.</li><li class="list-unordered">Improve logging. Move command begin to C except when it must be called after another command in Perl (e.g. <span class="cmd">expire</span> after <span class="cmd">backup</span>). Command begin logs correctly for complex data types like hash and list. Specify which commands will log to file immediately and set the default log level for log messages that are common to all commands. File logging is initiated from C.</li><li class="list-unordered">Port most of <span class="id">Config::Config::configLoad()</span> from Perl to C. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Fix incorrect enum types in <span class="file">config.c</span> that throw warnings under clang. (<i>Suggested by Douglas J Hunley.</i>)</li><li class="list-unordered">Enable <span class="id">-Wswitch-enum</span>, <span class="id">-Wconversion</span>, <span class="id">-Wformat=2</span>, <span class="id">-Wformat-nonliteral</span>, and <span class="id">-Wformat-signedness</span> and silence new warnings.</li><li class="list-unordered">Improve code documentation in <span class="id">config</span> module.</li><li class="list-unordered">Improve debugging. Add <span class="id">ASSERT_DEBUG()</span> macro for debugging and replace all current <span class="id">assert()</span> calls except in tests that can't use the debug code. Replace remaining NDEBUG blocks with the more granular DEBUG_UNIT. Remove some debug <span class="id">memset()</span> calls in <span class="id">MemContext</span> since valgrind is more useful for these checks.</li><li class="list-unordered">Add <span class="id">cfgOptionTest()</span> and update <span class="id">cfgOption()</span> calls that are better implemented as <span class="id">cfgOptionTest()</span>. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Build with <span class="id">-DNDEBUG</span> by default but disable for testing.</li><li class="list-unordered">Check <span class="id">int</span> size in <span class="id">common/type.h</span>. This ensures that integers are at least 32-bits without having to run the test suite.</li><li class="list-unordered">Improve conversion of C exceptions to <span class="id">Exception</span> objects. Colons in the message would prevent all of the message from being loaded into the <span class="id">Exception</span> object.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Show index in examples for indexed options, i.e. <span class="id">repo-*</span>, <span class="id">pg-*</span>. (<i>Suggested by Stephen Frost.</i>)</li><li class="list-unordered">Simplify table of contents on command page by only listing commands. (<i>Suggested by Stephen Frost.</i>)</li><li class="list-unordered">Remove references to the C library being optional.</li></ul><div class="section-body-text"><b>Test Suite Features:</b></div><ul class="list-unordered"><li class="list-unordered">Add CentOS/RHEL package builds.</li><li class="list-unordered">Use clang for static code analysis. Nothing found initially except for some functions that should have been marked <span class="id">__noreturn__</span>.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Buld performance improvements. Improve bin and libc build performance. Improve code generation performance.</li><li class="list-unordered">Config test code writes secure options to a file instead of passing on the command-line.</li><li class="list-unordered">Disable console display of coverage for C files since <span class="id">Devel::Cover</span> does not handle it well.</li><li class="list-unordered">Add new test for <span class="id">Common::Io::Process</span> to show that output on stderr will raise an exception on <span class="id">close()</span> even if the exit code is 0.</li><li class="list-unordered">Update <span class="file">pip</span> before installing <span class="file">awscli</span>.</li><li class="list-unordered">Remove <span class="br-setting">--smart</span> from <span class="br-setting">--expect</span> tests. This ensures that new binaries are built before running the tests.</li><li class="list-unordered">Remove Debian package patch now that it has been merged upstream.</li></ul></div></div><div class="section2"><a id="2.00"></a><div class="section2-header"><div class="section2-title">v2.00 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Performance Improvements for Archive Push</div><div class="section2-subsubtitle">Released February 23, 2018</div><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">The <span class="cmd">archive-push</span> command is now partially coded in C which allows the <span class="postgres">PostgreSQL</span> <span class="file">archive_command</span> to run significantly faster when processing status messages from the asynchronous archive process. (<i>Reviewed by Cynthia Shang.</i>)</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Improve <span class="cmd">check</span> command to verify that the backup manifest can be built. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Improve performance of HTTPS client. Buffering now takes the <span class="id">pending</span> bytes on the socket into account (when present) rather than relying entirely on <span class="id">select()</span>. In some instances the final bytes would not be flushed until the connection was closed.</li><li class="list-unordered">Improve S3 delete performance. The constant <span class="id">S3_BATCH_MAX</span> had been replaced with a hard-coded value of 2, probably during testing.</li><li class="list-unordered">Allow any non-command-line option to be reset to default on the command-line. This allows options in <span class="file">pgbackrest.conf</span> to be reset to default which reduces the need to write new configuration files for specific needs.</li><li class="list-unordered">The C library is now required. This eliminates conditional loading and eases development of new library features.</li><li class="list-unordered">The <span class="file">pgbackrest</span> executable is now a C binary instead of Perl. This allows certain time-critical commands (like async <span class="cmd">archive-push</span>) to run more quickly.</li><li class="list-unordered">Rename <span class="id">db-*</span> options to <span class="id">pg-*</span> and <span class="id">backup-*</span> options to <span class="id">repo-*</span> to improve consistency. <span class="id">repo-*</span> options are now indexed although currently only one is allowed.</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Implement <span class="cmd">help</span> command in C.</li><li class="list-unordered">Implement <span class="cmd">version</span> command in C.</li><li class="list-unordered">Config parsing implemented in C and passed to Perl as JSON. (<i>Reviewed by Cynthia Shang.</i>)</li><li class="list-unordered">Add <span class="id">Buffer</span>, <span class="id">Ini</span>, <span class="id">KeyValue</span>, <span class="id">List</span>, <span class="id">RegExp</span>, <span class="id">Storage</span>, <span class="id">String</span>, <span class="id">StringList</span>, <span class="id">Variant</span>, <span class="id">VariantList</span>, and <span class="id">Wait</span> objects.</li><li class="list-unordered">Add <span class="id">command</span>, <span class="id">exit</span>, <span class="id">log</span>, and <span class="id">time</span> modules.</li><li class="list-unordered">Remove deprecated <span class="br-option">archive-max-mb</span> option.</li><li class="list-unordered">Improve <span class="id">MemContext</span> module. Add temporary context blocks and refactor allocation arrays to include allocation size.</li><li class="list-unordered">Improve <span class="id">error</span> module. Add functions to convert error codes to C errors and handle system errors.</li><li class="list-unordered">Create a master list of errors in <span class="file">build/error.yaml</span>. The C and Perl errors lists are created automatically by <span class="id">Build.pm</span> so they stay up to date.</li><li class="list-unordered">Move lock release later in exitSafe() to reduce the chance of a new process starting and acquiring a lock before the old process has exited.</li><li class="list-unordered">Add 30 second wait loop to lockAcquire() when fail on no lock enabled. This should help prevent processes that are shutting down from interfering with processes that are starting up.</li><li class="list-unordered">Replace <span class="id">cfgCommandTotal()</span>/<span class="id">cfgOptionTotal()</span> functions with constants. The constants are applicable in more cases and allow the compiler to optimize certain loops more efficiently.</li><li class="list-unordered">Cleanup usage of internal options. Apply internal to options that need to be read to determine locality but should not appear in the help.</li><li class="list-unordered">Refactor code to make valgrind happy.</li><li class="list-unordered">Fix non-compliant formatting for function declarations. (<i>Suggested by Cynthia Shang.</i>)</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Features:</b></div><ul class="list-unordered"><li class="list-unordered">All clusters in the documentation are initialized with checksums.</li></ul><div class="section-body-text"><b>Documentation Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">List deprecated option names in documentation and command-line help.</li><li class="list-unordered">Clarify that S3 buckets must be created by the user. (<i>Suggested by David Youatt.</i>)</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Add coding standards document.</li><li class="list-unordered">Improve section source feature to not require a title or content. The title will be pulled from the source document.</li><li class="list-unordered">Allow code blocks to have a type. Currently this is only rendered in Markdown.</li><li class="list-unordered">Add table render for Markdown format. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">PDF rendering improvements. Check both <span class="path">doc-path</span> and <span class="path">bin-path</span> for logo. Allow PDF to be output to a location other than the <span class="path">output</span> directory. Use PDF-specific version variable for more flexible formatting. Allow sections to be excluded from table of contents. More flexible replacements for titles and footers. Fill is now the default for table columns. Column width is specified as a percentage rather that using latex-specific notation. Fix missing variable replace for <span class="id">code-block</span> title.</li><li class="list-unordered">Add <span class="id">id</span> param for hosts created with <span class="id">host-add</span>. The <span class="id">host-*-ip</span> variable is created from the <span class="id">id</span> param so the <span class="id">name</span> param can be changed without affecting the <span class="id">host-*-ip</span> variable. If <span class="id">id</span> is not specified then it is copied from <span class="id">name</span>.</li><li class="list-unordered">Deploy historical documentation to <span class="path">prior</span> rather than the root directory.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Run valgrind on all C unit tests.</li><li class="list-unordered">Only build C binary/library for Perl unit/integration tests or C unit tests that require Perl.</li><li class="list-unordered">Improve speed of C unit tests. Preserve object files between tests and use a Makefile to avoid rebuilding object files.</li><li class="list-unordered">Report coverage errors via the console. This helps with debugging coverage issues on remote services like Travis.</li><li class="list-unordered">No longer run <span class="id">master</span> branch through CI. The <span class="id">integration</span> branch will be run through CI and then pushed to <span class="id">master</span> with github status checks.</li><li class="list-unordered">Rename Perl tests so they don't conflict with their C counterparts.</li><li class="list-unordered">Update URL for Debian package repository.</li></ul></div></div><div class="section2"><a id="1.29"></a><div class="section2-header"><div class="section2-title">v1.29 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Critical Bug Fix for Backup Resume</div><div class="section2-subsubtitle">Released July 5, 2018</div><div class="section-body-text"><b>IMPORTANT NOTE</b>: This release fixes a critical bug in the backup resume feature. All resumed backups prior to this release should be considered inconsistent. A backup will be resumed after a prior backup fails, unless <span class="br-option">resume=n</span> has been specified. A resumed backup can be identified by checking the backup log for the message <q>aborted backup of same type exists, will be cleaned to remove invalid files and resumed</q>. If the message exists, do not use this backup or any backup in the same set for a restore and check the restore logs to see if a resumed backup was restored. If so, there may be inconsistent data in the cluster.</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fix critical bug in resume that resulted in inconsistent backups. A regression in <span class="id">v0.82</span> removed the timestamp comparison when deciding which files from the aborted backup to keep on resume. See note above for more details. (<i>Reported by David Youatt, Yogesh Sharma, Stephen Frost.</i>)</li><li class="list-unordered">Fix non-compliant ISO-8601 timestamp format in S3 authorization headers. AWS and some gateways were tolerant of space rather than zero-padded hours while others were not. (<i>Fixed by Andrew Schwartz.</i>)</li><li class="list-unordered">Fix directory syncs running recursively when only the specified directory should be synced. (<i>Reported by Craig A. James.</i>)</li><li class="list-unordered">Fix <span class="br-option">--target-action</span> and <span class="br-option">--recovery-option</span> options being reported as invalid when restoring with <span class="br-option">--type=immediate</span>. (<i>Reported by Brad Nicholson.</i>)</li><li class="list-unordered">Fix <span class="br-option">archive-copy</span> throwing <q>path not found</q> error for incr/diff backups. (<i>Reported by yummyliu, Vitaliy Kukharik.</i>)</li><li class="list-unordered">Fix failure in manifest build when two or more files in <span class="id">PGDATA</span> are linked to the same directory. (<i>Reported by Vitaliy Kukharik.</i>)</li><li class="list-unordered">Fix delta restore failing when a linked file was missing.</li><li class="list-unordered">Fix error in selective restore when only one user database exists in the cluster. (<i>Fixed by Cynthia Shang. Reported by Nj Baliyan.</i>)</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Improve the HTTP client to set <span class="id">content-length</span> to 0 when not specified by the server. S3 (and gateways) always set <span class="id">content-length</span> or <span class="id">transfer-encoding</span> but <span class="id">HTTP 1.1</span> does not require it and proxies (e.g. <span class="host">HAProxy</span>) may not include either. (<i>Suggested by Adam K. Sumner.</i>)</li><li class="list-unordered">Improve performance of HTTPS client. Buffering now takes the <span class="id">pending</span> bytes on the socket into account (when present) rather than relying entirely on <span class="id">select()</span>. In some instances the final bytes would not be flushed until the connection was closed.</li><li class="list-unordered">Improve S3 delete performance. The constant <span class="id">S3_BATCH_MAX</span> had been replaced with a hard-coded value of 2, probably during testing.</li><li class="list-unordered">Make backup/restore path sync more efficient. Scanning the entire directory can be very expensive if there are a lot of small tables. The backup manifest contains the path list so use it to perform syncs instead of scanning the backup/restore path. Remove recursive path sync functionality since it is no longer used.</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Make <span class="path">backup.history</span> sync more efficient. Only the <span class="path">backup.history/[year]</span> directory was being synced, so check if the <span class="path">backup.history</span> is newly created and sync it as well.</li><li class="list-unordered">Add log-level-stderr option for stanza-* commands.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Update docs with 32-bit support and caveats. 32-bit support was added in <span class="host">v1.26</span>. (<i>Reported by Viorel Tabara.</i>)</li></ul><div class="section-body-text"><b>Documentation Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Clarify that S3 buckets must be created by the user. (<i>Suggested by David Youatt.</i>)</li><li class="list-unordered">Update out-of-date description for the <span class="br-option">spool-path</span> option.</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Remove call to <span class="file">lscpu</span> which can vary widely by build host.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Add new test for <span class="id">Common::Io::Process</span> to show that output on stderr will raise an exception on <span class="id">close()</span> even if the exit code is 0.</li><li class="list-unordered">Add zero-length file to <span class="id">mock</span>/<span class="id">all</span> test.</li><li class="list-unordered">Disable package build tests since <span class="id">v1</span> will no longer be packaged. Users installing packages should update to <span class="id">v2</span>. <span class="id">v1</span> builds are intended for users installing from source.</li><li class="list-unordered">Update SSL error message test on CentOS 7.</li><li class="list-unordered">Update URL for Debian package repository.</li><li class="list-unordered">Make <span class="file">ls</span> ordering deterministic in <span class="id">mock</span>/<span class="id">all</span> test.</li><li class="list-unordered">Change backup test user from <span class="id">backrest</span> to <span class="id">pgbackrest</span>.</li></ul></div></div><div class="section2"><a id="1.28"></a><div class="section2-header"><div class="section2-title">v1.28 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Stanza Delete</div><div class="section2-subsubtitle">Released February 1, 2018</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed inability to restore a single database contained in a tablespace using --db-include. (<i>Fixed by Cynthia Shang. Reported by Chiranjeevi Ravilla.</i>)</li><li class="list-unordered">Ensure latest <span class="id">db-id</span> is selected on when matching <span class="file">archive.info</span> to <span class="file">backup.info</span>. This provides correct matching in the event there are <span class="id">system-id</span> and <span class="id">db-version</span> duplicates (e.g. after reverting a <span class="id">pg_upgrade</span>). (<i>Fixed by Cynthia Shang. Reported by Adam K. Sumner.</i>)</li><li class="list-unordered">Fixed overly chatty error message when reporting an invalid command. (<i>Reported by Jason O'Donnell.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Add <span class="cmd">stanza-delete</span> command to cleanup unused stanzas. (<i>Contributed by Cynthia Shang. Suggested by Magnus Hagander.</i>)</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Improve <span class="cmd">stanza-create</span> command so that it does not error when the stanza already exists. (<i>Contributed by Cynthia Shang.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Minor changes to <span class="id">Manifest</span> module, mostly for test reproducibility. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Fix non-compliant formatting for function declarations. (<i>Suggested by Cynthia Shang.</i>)</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Update <span class="cmd">stanza-create --force</span> documentation to urge caution when using. (<i>Suggested by Jason O'Donnell.</i>)</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Add unit tests for the <span class="id">Manifest</span> module. (<i>Contributed by Cynthia Shang.</i>)</li></ul></div></div><div class="section2"><a id="1.27"></a><div class="section2-header"><div class="section2-title">v1.27 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Bug Fixes and Documentation</div><div class="section2-subsubtitle">Released December 19, 2017</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue that suppressed locality errors for <span class="cmd">backup</span> and <span class="cmd">restore</span>. When a backup host is present, backups should only be allowed on the backup host and restores should only be allowed on the database host unless an alternate configuration is created that ignores the remote host. (<i>Reported by Lardi&egrave;re S&eacute;bastien.</i>)</li><li class="list-unordered">Fixed an issue where WAL was not expired on <span class="postgres">PostgreSQL</span> 10. This was caused by a faulty regex that expected all <span class="postgres">PostgreSQL</span> major versions to be X.X. (<i>Reported by Adam Brusselback.</i>)</li><li class="list-unordered">Fixed an issue where the <span class="br-option">--no-config</span> option was not passed to child processes. This meant the child processes would still read the local config file and possibly cause unexpected behaviors.</li><li class="list-unordered">Fixed <span class="cmd">info</span> command to eliminate <span class="id">"db (prior)"</span> output if no backups or archives exist for a prior version of the cluster. (<i>Fixed by Cynthia Shang. Reported by Stephen Frost.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Add <span class="id">memGrowRaw()</span> to memory context module.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Features:</b></div><ul class="list-unordered"><li class="list-unordered">Document the relationship between the <span class="br-option">archive-copy</span> and <span class="br-option">archive-check</span> options. (<i>Suggested by Markus Nullmeier.</i>)</li><li class="list-unordered">Improve <span class="br-option">archive-copy</span> reference documentation.</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Relax permissions set by <span class="file">release.pl</span>.</li><li class="list-unordered">Split <q>refactor</q> sections into <q>improvements</q> and <q>development</q> in the release notes. Many development notes are not relevant to users and simply clutter the release notes, so they are no longer shown on the website.</li><li class="list-unordered">Allow internal options that do not show up in the documentation. Used for test options initially but other use cases are on the horizon.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Update CI branches to <span class="path">release/1</span> and <span class="path">release/1-integration</span>.</li><li class="list-unordered">No longer run <span class="id">release/1</span> branch through CI. The <span class="id">release/1-integration</span> branch will be run through CI and then pushed to <span class="id">release/1</span> with github status checks.</li><li class="list-unordered">Move restore test infrastructure to <span class="id">HostBackup.pm</span>. Required to test restores on the backup server, a fairly common scenario. Improve the restore function to accept optional parameters rather than a long list of parameters. In passing, clean up extraneous use of <span class="id">strType</span> and <span class="id">strComment</span> variables.</li><li class="list-unordered">Sync time to prevent build failures when running on VirtualBox.</li></ul></div></div><div class="section2"><a id="1.26"></a><div class="section2-header"><div class="section2-title">v1.26 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Repository Encryption</div><div class="section2-subsubtitle">Released November 21, 2017</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue that could cause copying large manifests to fail during restore. (<i>Reported by Craig A. James.</i>)</li><li class="list-unordered">Fixed incorrect WAL offset for 32-bit architectures. (<i>Fixed by Javier Wilson.</i>)</li><li class="list-unordered">Fixed an issue retrieving WAL for old database versions. After a <span class="cmd">stanza-upgrade</span> it should still be possible to restore backups from the previous version and perform recovery with <span class="cmd">archive-get</span>. However, archive-get only checked the most recent db version/id and failed. Also clean up some issues when the same db version/id appears multiple times in the history. (<i>Fixed by Cynthia Shang. Reported by Clinton Adams.</i>)</li><li class="list-unordered">Fixed an issue with invalid backup groups being set correctly on restore. If the backup cannot map a group to a name it stores the group in the manifest as <span class="id">false</span> then uses either the owner of $PGDATA to set the group during restore or failing that the group of the current user. This logic was not working correctly because the selected group was overwriting the user on restore leaving the group undefined and the user incorrectly set to the group. (<i>Reported by Jeff McCormick.</i>)</li><li class="list-unordered">Fixed an issue passing parameters to remotes. When more than one db was specified the path, port, and socket path would for db1 were passed no matter which db was actually being addressed. (<i>Reported by uspen.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Repository encryption support. (<i>Contributed by Cynthia Shang, David Steele.</i>)</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Disable gzip filter when <span class="br-option">--compress-level-network=0</span>. The filter was used with compress level set to 0 which added overhead without any benefit.</li><li class="list-unordered">Inflate performance improvement for gzip filter.</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Refactor protocol param generation into a new function. This allows the code to be tested more precisely and doesn't require executing a remote process.</li><li class="list-unordered">Add <span class="id">list</span> type for options. The <span class="id">hash</span> type was being used for lists with an additional flag (`value-hash`) to indicate that it was not really a hash.</li><li class="list-unordered">Remove configurable option hints. <span class="br-option">db-path</span> was the only option with a hint so the feature seemed wasteful. All missing stanza options now output the same hint without needing configuration.</li><li class="list-unordered">Convert configuration definitions from auto-generated functions to auto-generated data structures.</li><li class="list-unordered">Add <span class="id">eof</span> to S3 file driver (required for encryption support).</li><li class="list-unordered">Enable additional warnings for C builds.</li><li class="list-unordered">Simplify try..catch..finally names. Also wrap in a do...while loop to make sure that no random else is attached to the main if block.</li><li class="list-unordered">Improve base64 implementation. Different encoded strings could be generated based on compiler optimizations. Even though decoding was still successful the encoded strings did not match the standard.</li><li class="list-unordered">Disable <span class="id">-Wclobber</span> compiler warning because it is mostly useless but keep the rest of of <span class="id">-Wextra</span>.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Features:</b></div><ul class="list-unordered"><li class="list-unordered">Add template to improve initial information gathered for issue submissions. (<i>Contributed by Cynthia Shang.</i>)</li></ul><div class="section-body-text"><b>Documentation Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Clarify usage of the <span class="br-option">archive-timeout</span> option and describe how it is distinct from the <span class="postgres">PostgreSQL</span> <span class="pg-option">archive_timeout</span> setting. (<i>Contributed by Cynthia Shang. Suggested by Keith Fiske.</i>)</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Update <span class="file">release.pl</span> to push data to site repository.</li></ul><div class="section-body-text"><b>Test Suite Features:</b></div><ul class="list-unordered"><li class="list-unordered">Automated tests for 32-bit i386/i686 architecture.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Update Debian/Ubuntu containers to download latest version of <span class="file">pip</span>.</li><li class="list-unordered">Full unit test coverage for gzip filter.</li><li class="list-unordered">Only check expect logs on CentOS 7. Variations in distros cause false negatives in tests but don't add much value.</li><li class="list-unordered">Fix flapping protocol timeout test. It only matters that the correct error code is returned, so disable logging to prevent message ordering from failing the expect test.</li><li class="list-unordered">Designate a single distro (Ubuntu 16.04) for coverage testing. Running coverage testing on multiple distros takes time but doesn't add significant value. Also ensure that the distro designated to run coverage tests is one of the default test distros. For C tests, enable optimizations on the distros that don't do coverage testing.</li><li class="list-unordered">Automate generation of WAL and <span class="file">pg_control</span> test files. The existing static files would not work with 32-bit or big-endian systems so create functions to generate these files dynamically rather than creating a bunch of new static files.</li><li class="list-unordered">Refactor C unit test macros so they compile with <span class="id">-Wstrict-aliasing</span>.</li><li class="list-unordered">Refactor C page checksum unit test to compile with <span class="id">-Wstrict-aliasing</span>.</li></ul></div></div><div class="section2"><a id="1.25"></a><div class="section2-header"><div class="section2-title">v1.25 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">S3 Performance Improvements</div><div class="section2-subsubtitle">Released October 24, 2017</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fix custom settings for <span class="br-option">compress-level</span> option being ignored. (<i>Reported by Jens Wilke.</i>)</li><li class="list-unordered">Remove error when overlapping timelines are detected. Overlapping timelines are valid in many Point-in-Time-Recovery (PITR) scenarios. (<i>Reported by blogh.</i>)</li><li class="list-unordered">Fix instances where <span class="id">database-id</span> was not rendered as an integer in JSON info output. (<i>Fixed by Cynthia Shang. Reported by Jason O'Donnell.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Improve performance of list requests on S3. Any beginning literal portion of a filter expression is used to generate a search prefix which often helps keep the request small enough to avoid rate limiting. (<i>Suggested by Mihail Shvein.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Improve protocol error handling. In particular, <q>stop</q> errors are no longer reported as <q>unexpected</q>.</li><li class="list-unordered">Allow functions with sensitive options to be logged at debug level with redactions. Previously, functions with sensitive options had to be logged at trace level to avoid exposing them. Trace level logging may still expose secrets so use with caution.</li><li class="list-unordered">Replace dynamically built class hierarchies in I/O layer with fixed <span class="id">parent()</span> calls.</li><li class="list-unordered">Improve labeling for errors in helper processes.</li><li class="list-unordered">Update C naming conventions.</li><li class="list-unordered">Use <span class="id">int</span> datatype wherever possible.</li><li class="list-unordered">Better separation of C source from Perl interface.</li><li class="list-unordered">Add <span class="file">LibC.template.pm</span> to simplify LibC module generation.</li><li class="list-unordered">Add C error handler.</li><li class="list-unordered">Perl error handler recognizes errors thrown from the C library.</li><li class="list-unordered">Page checksum module uses new C error handler.</li><li class="list-unordered">Add C memory contexts.</li><li class="list-unordered">Add base64 encode/decode.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Test Suite Features:</b></div><ul class="list-unordered"><li class="list-unordered">Add I/O performance tests.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Add C unit test infrastructure.</li><li class="list-unordered">Add test macros for C results and errors.</li><li class="list-unordered">Warnings in C builds treated as errors.</li><li class="list-unordered">Run all tests on tempfs rather than local disk.</li><li class="list-unordered">Improve performance of test code. Wait when all tests have been assigned to reduce CPU load.</li><li class="list-unordered">Remove Debian test repo after PostgreSQL 10 release.</li><li class="list-unordered">Convert config and page checksum tests into C unit tests.</li><li class="list-unordered">Add <span class="postgres">PostgreSQL</span> versions to Debian VMs for testing.</li></ul></div></div><div class="section2"><a id="1.24"></a><div class="section2-header"><div class="section2-title">v1.24 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">New Backup Exclusions</div><div class="section2-subsubtitle">Released September 28, 2017</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where warnings were being emitted in place of lower priority log messages during backup from standby initialization. (<i>Reported by uspen.</i>)</li><li class="list-unordered">Fixed an issue where some <span class="id">db-*</span> options (e.g. <span class="br-option">db-port</span>) were not being passed to remotes. (<i>Reported by uspen.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Exclude contents of <span class="path">pg_snapshots</span>, <span class="path">pg_serial</span>, <span class="path">pg_notify</span>, and <span class="path">pg_dynshmem</span> from backup since they are rebuilt on startup.</li><li class="list-unordered">Exclude <span class="file">pg_internal.init</span> files from backup since they are rebuilt on startup.</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Open log file after async process is completely separated from the main process to prevent the main process from also logging to the file. (<i>Suggested by Jens Wilke.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Dynamically generate list of files for C library build.</li><li class="list-unordered">Break up <span class="file">LibC.xs</span> into separate module files.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Features:</b></div><ul class="list-unordered"><li class="list-unordered">Add passwordless SSH configuration.</li></ul><div class="section-body-text"><b>Documentation Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Rename <span class="host">master</span> to <span class="host">primary</span> in documentation to align with <span class="postgres">PostgreSQL</span> convention.</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Add full installation where required and remove doc containers that included parts of the installation.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Improve C library smart build by ignoring changes outside of <span class="path">/lib/pgBackRest/Config</span>.</li></ul></div></div><div class="section2"><a id="1.23"></a><div class="section2-header"><div class="section2-title">v1.23 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Multiple Standbys and PostgreSQL 10 Support</div><div class="section2-subsubtitle">Released September 3, 2017</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue that could cause compression to abort on growing files. (<i>Reported by Jesper St John, Aleksandr Rogozin.</i>)</li><li class="list-unordered">Fixed an issue with keep-alives not being sent to the remote from the local process. (<i>Reported by William Cox.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Up to seven standbys can be configured for backup from standby. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered"><span class="postgres">PostgreSQL</span> 10 support.</li><li class="list-unordered">Allow <span class="id">content-length</span> (in addition to chunked encoding) when reading XML data to improve compatibility with third-party S3 gateways. (<i>Suggested by Victor Gdalevich.</i>)</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Increase HTTP timeout for S3.</li><li class="list-unordered">Add HTTP retries to harden against transient S3 network errors.</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Configuration definitions are now pulled from the C library when present.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed document generation to include section summaries on the Configuration page. (<i>Fixed by Cynthia Shang.</i>)</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Move contributor list to the end of <span class="file">release.xml</span> for convenience.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Change log test order to ignore unimportant log errors while shutting down <span class="postgres">PostgreSQL</span>.</li><li class="list-unordered">Drain <span class="id">stderr</span> during test process execution as well as termination to prevent lockups if there is a lot of output.</li><li class="list-unordered">Update Docker build in <span class="file">Vagrantfile</span>.</li><li class="list-unordered">Update containers to support C library builds in the documentation.</li><li class="list-unordered">Simplify smart logic for C Library and package builds.</li></ul></div></div><div class="section2"><a id="1.22"></a><div class="section2-header"><div class="section2-title">v1.22 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Fixed S3 Retry</div><div class="section2-subsubtitle">Released August 9, 2017</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed authentication issue in S3 retry.</li></ul></div></div><div class="section2"><a id="1.21"></a><div class="section2-header"><div class="section2-title">v1.21 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Improved Info Output and SSH Port Option</div><div class="section2-subsubtitle">Released August 8, 2017</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">The <span class="path">archive_status</span> directory is now recreated on restore to support <span class="postgres">PostgreSQL</span> 8.3 which does not recreate it automatically like more recent versions do. (<i>Reported by Stephen Frost.</i>)</li><li class="list-unordered">Fixed an issue that could cause the empty archive directory for an old <span class="postgres">PostgreSQL</span> version to be left behind after a <span class="cmd">stanza-upgrade</span>. (<i>Fixed by Cynthia Shang.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Modified the <span class="cmd">info</span> command (both text and JSON output) to display the archive ID and minimum/maximum WAL currently present in the archive for the current and prior, if any, database cluster version. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Added <span class="br-option">--backup-ssh-port</span> and <span class="br-option">--db-ssh-port</span> options to support non-default SSH ports. (<i>Contributed by Cynthia Shang.</i>)</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Retry when S3 returns an internal error (500).</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Add <span class="id">bIgnoreMissing</span> parameter to <span class="id">Local->manifest()</span>.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fix description of <span class="br-option">--online</span> based on the command context.</li></ul><div class="section-body-text"><b>Documentation Features:</b></div><ul class="list-unordered"><li class="list-unordered">Add creation of <span class="file">/etc/pgbackrest.conf</span> to manual installation instructions.</li></ul><div class="section-body-text"><b>Documentation Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Move repository options into a separate section in command/command-line help. (<i>Suggested by Stephen Frost.</i>)</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Reduce log verbosity when building documentation by only logging sections that contain an execute list directly or in a child section.</li><li class="list-unordered">Debian/Ubuntu documentation now builds on Ubuntu 16.</li><li class="list-unordered">Remove vestigial repository options from <span class="cmd">backup</span> command.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Fix log checking after <span class="postgres">PostgreSQL</span> shuts down to include <span class="id">FATAL</span> messages and disallow immediate shutdowns which can throw <span class="id">FATAL</span> errors in the log.</li><li class="list-unordered">Use Google DNS in test environment for consistency.</li><li class="list-unordered">Use new Travis Trusty image.</li><li class="list-unordered">Generate global fake cert in containers for testing.</li><li class="list-unordered">Consolidate <span class="id">stanza-create</span> and <span class="id">stanza-upgrade</span> tests into new <span class="id">stanza</span> test. (<i>Contributed by Cynthia Shang.</i>)</li></ul></div></div><div class="section2"><a id="1.20"></a><div class="section2-header"><div class="section2-title">v1.20 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Critical 8.3/8.4 Bug Fix</div><div class="section2-subsubtitle">Released June 27, 2017</div><div class="section-body-text"><b>IMPORTANT NOTE</b>: <span class="postgres">PostgreSQL</span> <span class="host">8.3</span> and <span class="host">8.4</span> installations utilizing tablespaces should upgrade immediately from any <span class="host">v1</span> release and run a full backup. A bug prevented tablespaces from being backed up on these versions only. <span class="postgres">PostgreSQL</span> &ge; <span class="host">9.0</span> is not affected.</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue that prevented tablespaces from being backed up on <span class="postgres">PostgreSQL</span> &le; <span class="host">8.4</span>.</li><li class="list-unordered">Fixed missing flag in C library build that resulted in a mismatched binary on 32-bit systems. (<i>Reported by Adrian Vondendriesch.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Add <span class="br-option">s3-repo-ca-path</span> and <span class="br-option">s3-repo-ca-file</span> options to accommodate systems where CAs are not automatically found by <span class="id">IO::Socket::SSL</span>, i.e. <span class="host">RHEL7</span>, or to load custom CAs. (<i>Suggested by Scott Frazer.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Harden protocol handshake to handle race conditions.</li><li class="list-unordered">Fixed misleading error message when a file was opened for write in a missing directory.</li><li class="list-unordered">Change log level of hardlink logging to <span class="id">detail</span>.</li><li class="list-unordered">Cast size in S3 manifest to integer.</li><li class="list-unordered">Rename <span class="id">Archive</span> modules to remove redundancy.</li><li class="list-unordered">Improve <span class="host">S3</span> error reporting.</li><li class="list-unordered">Minor optimizations to package loads and ordering for <span class="cmd">archive-get</span> and <span class="cmd">archive-push</span> commands.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Remove exhaustive version list from Stable Releases TOC.</li><li class="list-unordered">Improve <span class="host">S3</span> server implementation in documentation.</li><li class="list-unordered">Update <span class="host">CentOS 6</span> documentation to build on <span class="postgres">PostgreSQL</span> 9.5.</li><li class="list-unordered">Remove <span class="id">mount</span> from host <span class="id">cache-key</span> because it can vary by system.</li></ul><div class="section-body-text"><b>Test Suite Features:</b></div><ul class="list-unordered"><li class="list-unordered">Add documentation builds to CI.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Fix timeouts in <span class="id">ExecuteTest</span> to speed multi-process testing.</li><li class="list-unordered">Remove patch directory before Debian package builds.</li><li class="list-unordered">Combine hardlink and non/compressed in synthetic tests to reduce test time and improve coverage.</li><li class="list-unordered">Split <span class="id">full</span> module into <span class="id">mock</span> and <span class="id">real</span> to allow better test combinations and save time in CI.</li><li class="list-unordered">Consolidate <span class="id">archive-push</span> and <span class="id">archive-get</span> tests into new <span class="id">archive</span> test.</li><li class="list-unordered">Eliminate redundancy in <span class="id">real</span> tests.</li><li class="list-unordered">Install <span class="id">sudo</span> in base containers rather than on demand.</li><li class="list-unordered">More optimized container suite that greatly improves build time.</li><li class="list-unordered">Added static Debian packages for <span class="id">Devel::Cover</span> to reduce build time.</li><li class="list-unordered">Add <span class="id">deprecated</span> state for containers. Deprecated containers may only be used to build packages.</li><li class="list-unordered">Remove <span class="host">Debian 8</span> from CI because it does not provide additional coverage over <span class="host">Ubuntu 12.04, 14.04, 16.04</span>.</li><li class="list-unordered">Add <span class="host">Debian 9</span> to test suite.</li><li class="list-unordered">Remove <span class="br-setting">process-max</span> option. Parallelism is now tested in a more targeted manner and the high level option is no longer needed.</li><li class="list-unordered">Balance database versions between VMs to minimize test duration.</li><li class="list-unordered">Automatically check that all supported <span class="postgres">PostgreSQL</span> versions are being tested on a single default VM.</li><li class="list-unordered">Add <span class="id">performance</span> module and basic performance test for <span class="cmd">archive-push</span>.</li></ul></div></div><div class="section2"><a id="1.19"></a><div class="section2-header"><div class="section2-title">v1.19 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">S3 Support</div><div class="section2-subsubtitle">Released June 12, 2017</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed the <span class="cmd">info</span> command so the WAL archive min/max displayed is for the current database version. (<i>Fixed by Cynthia Shang.</i>)</li><li class="list-unordered">Fixed the <span class="cmd">backup</span> command so the <span class="br-setting">backup-standby</span> option is reset (and the backup proceeds on the primary) if the standby is not configured and/or reachable. (<i>Fixed by Cynthia Shang.</i>)</li><li class="list-unordered">Fixed config warnings raised from a remote process causing errors in the master process. (<i>Fixed by Cynthia Shang.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered"><span class="host">Amazon S3</span> repository support. (<i>Reviewed by Cynthia Shang.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Refactor storage layer to allow for new repository filesystems using drivers. (<i>Reviewed by Cynthia Shang.</i>)</li><li class="list-unordered">Refactor IO layer to allow for new compression formats, checksum types, and other capabilities using filters. (<i>Reviewed by Cynthia Shang.</i>)</li><li class="list-unordered">Move modules in <span class="path">Protocol</span> directory in subdirectories.</li><li class="list-unordered">Move backup modules into <span class="path">Backup</span> directory.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Changed invalid <span class="br-setting">max-archive-mb</span> option in configuration reference to <span class="br-setting">archive-queue-max</span>.</li><li class="list-unordered">Fixed missing <span class="id">sudo</span> in installation section. (<i>Fixed by L&aelig;titia.</i>)</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an undefined variable when a module had no uncoverable code exceptions.</li><li class="list-unordered">Fixed issue with <span class="br-setting">--dry-run</span> requiring <span class="br-setting">--vm-out</span> to work properly.</li><li class="list-unordered">Moved test and env modules to new directories to avoid namespace conflicts with common tests.</li><li class="list-unordered">Set <span class="br-setting">--vm-max=2</span> for CI.</li><li class="list-unordered">Remove flapping protocol timeout test that will be replaced in the upcoming storage patch.</li></ul></div></div><div class="section2"><a id="1.18"></a><div class="section2-header"><div class="section2-title">v1.18 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Stanza Upgrade, Refactoring, and Locking Improvements</div><div class="section2-subsubtitle">Released April 12, 2017</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where read-only operations that used local worker processes (i.e. <span class="cmd">restore</span>) were creating write locks that could interfere with parallel <span class="cmd">archive-push</span>. (<i>Reported by Jens Wilke.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Added the stanza-upgrade command to provide a mechanism for upgrading a stanza after upgrading to a new major version of <span class="postgres">PostgreSQL</span>. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Added validation of <span class="br-setting">pgbackrest.conf</span> to display warnings if options are not valid or are not in the correct section. (<i>Contributed by Cynthia Shang.</i>)</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Simplify locking scheme. Now, only the master process will hold write locks (for <span class="cmd">archive-push</span> and <span class="cmd">backup</span> commands) and not all local and remote worker processes as before.</li><li class="list-unordered">Do not set timestamps of files in the backup directories to match timestamps in the cluster directory. This was originally done to enable backup resume, but that process is now implemented with checksums.</li><li class="list-unordered">Improved error message when the <span class="cmd">restore</span> command detects the presence of <span class="file">postmaster.pid</span>. (<i>Suggested by Yogesh Sharma.</i>)</li><li class="list-unordered">Renumber return codes between 25 and 125 to avoid PostgreSQL interpreting some as fatal signal exceptions. (<i>Suggested by Yogesh Sharma.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Refactor <span class="id">Ini.pm</span> to facilitate testing.</li><li class="list-unordered">The <span class="cmd">backup</span> and <span class="cmd">restore</span> commands no longer copy via temp files. In both cases the files are checksummed on resume so there's no danger of partial copies.</li><li class="list-unordered">Allow functions to accept optional parameters as a hash.</li><li class="list-unordered">Refactor <span class="id">File->list()</span> and <span class="id">fileList()</span> to accept optional parameters.</li><li class="list-unordered">Refactor <span class="id">backupLabel()</span> and add unit tests.</li><li class="list-unordered">Silence some perl critic warnings. (<i>Contributed by Cynthia Shang.</i>)</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Update wording for release note sections.</li><li class="list-unordered">Ignore clock skew in container libc/package builds using make. It is common for containers to have clock skew so the build process takes care of this issue independently.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Complete statement/branch coverage for <span class="id">Ini.pm</span>.</li><li class="list-unordered">Improved functions used to test/munge manifest and info files.</li><li class="list-unordered">Coverage testing always enabled on Debian-based containers.</li><li class="list-unordered">Require description in every call to <span class="id">testResult()</span>.</li><li class="list-unordered">Make <span class="id">iWaitSeconds</span> an optional parameter for <span class="id">testResult()</span>.</li><li class="list-unordered">Updated vagrant to new version and image.</li><li class="list-unordered">Fixed flapping archive stop tests.</li><li class="list-unordered">Added ability to test warning messages. (<i>Contributed by Cynthia Shang.</i>)</li></ul></div></div><div class="section2"><a id="1.17"></a><div class="section2-header"><div class="section2-title">v1.17 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Page Checksum Bug Fix</div><div class="section2-subsubtitle">Released March 13, 2017</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where newly initialized (but unused) pages would cause page checksum warnings. (<i>Reported by Stephen Frost.</i>)</li></ul></div></div><div class="section2"><a id="1.16"></a><div class="section2-header"><div class="section2-title">v1.16 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Page Checksum Improvements, CI, and Package Testing</div><div class="section2-subsubtitle">Released March 2, 2017</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where tables over 1GB would report page checksum warnings after the first segment. (<i>Reported by Stephen Frost.</i>)</li><li class="list-unordered">Fixed an issue where databases created with a non-default tablespace would raise bogus warnings about <span class="file">pg_filenode.map</span> and <span class="file">pg_internal.init</span> not being page aligned. (<i>Reported by blogh.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Improved the code and tests for <span class="id">fileManifest()</span> to prevent a possible race condition when files are removed by the database while the manifest is being built.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Container executions now load the user's environment.</li></ul><div class="section-body-text"><b>Test Suite Features:</b></div><ul class="list-unordered"><li class="list-unordered">Continuous integration using <span class="id">travis-ci</span>.</li><li class="list-unordered">Automated builds of Debian packages for all supported distributions.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Added <span class="br-setting">--dev</span> option to aggregate commonly used dev options.</li><li class="list-unordered">Added <span class="br-setting">--retry</span> option.</li><li class="list-unordered">Added <span class="br-setting">--no-package</span> option to skip package builds.</li><li class="list-unordered">C library and packages are built by default, added <span class="br-setting">-smart</span> option to rebuild only when file changes are detected.</li><li class="list-unordered">The <span class="br-setting">--libc-only</span> option has been changed to <span class="br-setting">--build-only</span> now that packages builds have been added.</li><li class="list-unordered">Improved formatting of <span class="id">testResult()</span> output.</li><li class="list-unordered">Improved truncation when outputting errors logs in the <span class="id">ExecuteTest</span> module.</li><li class="list-unordered">Fixed flapping archive-stop test with <span class="id">testResult()</span> retries.</li><li class="list-unordered">Added final test of archive contents to archive-push test.</li><li class="list-unordered">Temporarily disable flapping keep-alive test.</li></ul></div></div><div class="section2"><a id="1.15"></a><div class="section2-header"><div class="section2-title">v1.15 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Refactoring and Bug Fixes</div><div class="section2-subsubtitle">Released February 13, 2017</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed a regression introduced in <span class="host">v1.13</span> that could cause backups to fail if files were removed (e.g. tables dropped) while the manifest was being built. (<i>Reported by Navid Golpayegani.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Refactor <span class="id">FileCommon::fileManifest()</span> and <span class="id">FileCommon::fileStat</span> to be more modular to allow complete branch/statement level coverage testing.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Complete branch/statement level coverage testing for <span class="id">FileCommon::fileManifest()</span> and <span class="id">FileCommon::fileStat</span> functions and helper functions.</li></ul></div></div><div class="section2"><a id="1.14"></a><div class="section2-header"><div class="section2-title">v1.14 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Refactoring and Bug Fixes</div><div class="section2-subsubtitle">Released February 13, 2017</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where an archive-push error would not be retried and would instead return errors to <span class="postgres">PostgreSQL</span> indefinitely (unless the <span class="file">.error</span> file was manually deleted). (<i>Reported by Jens Wilke.</i>)</li><li class="list-unordered">Fixed a race condition in parallel archiving where creation of new paths generated an error when multiple processes attempted to do so at the same time. (<i>Reported by Jens Wilke.</i>)</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Improved performance of <span class="id">wal archive min/max</span> provided by the <span class="cmd">info</span> command. (<i>Suggested by Jens Wilke.</i>)</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Features:</b></div><ul class="list-unordered"><li class="list-unordered">Updated async archiving documentation to more accurately describe how the new method works and how it differs from the old method. (<i>Suggested by Jens Wilke.</i>)</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Documentation can now be built with reusable blocks to reduce duplication.</li><li class="list-unordered">Improved support for <span class="br-setting">--require</span> option and section depends now default to the previous section.</li><li class="list-unordered">Added ability to pass options to containers within the documentation.</li><li class="list-unordered">Add <span class="id">proper</span> tag to slightly emphasize proper nouns.</li></ul></div></div><div class="section2"><a id="1.13"></a><div class="section2-header"><div class="section2-title">v1.13 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Parallel Archiving, Stanza Create, Improved Info and Check</div><div class="section2-subsubtitle">Released February 5, 2017</div><div class="section-body-text"><b>IMPORTANT NOTE</b>: The new implementation of asynchronous archiving no longer copies WAL to a separate queue. If there is any WAL left over in the old queue after upgrading to <span class="id">1.13</span>, it will be abandoned and <b>not</b> pushed to the repository.<br/>
<br/>
To prevent this outcome, stop archiving by setting <span class="br-setting">archive_command = false</span>. Next, drain the async queue by running <span class="id">pgbackrest --stanza=[stanza-name] archive-push</span> and wait for the process to complete. Check that the queue in <span class="path">[spool-path]/archive/[stanza-name]/out</span> is empty. Finally, install <span class="id">1.13</span> and restore the original <span class="br-setting">archive_command</span>.<br/>
<br/>
<b>IMPORTANT NOTE</b>: The <span class="cmd">stanza-create</span> command is not longer optional and must be executed before backup or archiving can be performed on a <b>new</b> stanza. Pre-existing stanzas do not require <span class="cmd">stanza-create</span> to be executed.</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed const assignment giving compiler warning in C library. (<i>Fixed by Adrian Vondendriesch.</i>)</li><li class="list-unordered">Fixed a few directory syncs that were missed for the <span class="br-option">--repo-sync</span> option.</li><li class="list-unordered">Fixed an issue where a missing user/group on restore could cause an <q>uninitialized value</q> error in <span class="id">File->owner()</span>. (<i>Reported by Leonardo GG Avellar.</i>)</li><li class="list-unordered">Fixed an issue where protocol mismatch errors did not output the expected value.</li><li class="list-unordered">Fixed a spurious <span class="cmd">archive-get</span> log message that indicated an exit code of 1 was an abnormal termination.</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Improved, multi-process implementation of asynchronous archiving.</li><li class="list-unordered">Improved <span class="cmd">stanza-create</span> command so that it can repair broken repositories in most cases and is robust enough to be made mandatory. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Improved <span class="cmd">check</span> command to run on a standby, though only basic checks are done because <span class="id">pg_switch_xlog()</span> cannot be executed on a replica. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Added archive and backup WAL ranges to the <span class="cmd">info</span> command.</li><li class="list-unordered">Added warning to update <span class="id">pg_tablespace.spclocation</span> when remapping tablespaces in <span class="postgres">PostgreSQL</span> < 9.2. (<i>Contributed by blogh.</i>)</li><li class="list-unordered">Remove remote lock requirements for the <span class="cmd">archive-get</span>, <span class="cmd">restore</span>, <span class="cmd">info</span>, and <span class="cmd">check</span> commands since they are read-only operations. (<i>Suggested by Michael Vitale.</i>)</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Log file banner is not output until the first log entry is written. (<i>Suggested by Jens Wilke.</i>)</li><li class="list-unordered">Reduced the likelihood of torn pages causing a false positive in page checksums by filtering on start backup LSN.</li><li class="list-unordered">Remove Intel-specific optimization from C library build flags. (<i>Contributed by Adrian Vondendriesch.</i>)</li><li class="list-unordered">Remove <span class="br-option">--lock</span> option. This option was introduced before the lock directory could be located outside the repository and is now obsolete.</li><li class="list-unordered">Added <span class="br-option">--log-timestamp</span> option to allow timestamps to be suppressed in logging. This is primarily used to avoid filters in the automated documentation.</li><li class="list-unordered">Return proper error code when unable to convert a relative path to an absolute path. (<i>Suggested by Yogesh Sharma.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Refactor <span class="id">File</span> and <span class="id">BackupCommon</span> modules to improve test coverage.</li><li class="list-unordered">Moved <span class="id">File->manifest()</span> into the <span class="id">FileCommon.pm</span> module.</li><li class="list-unordered">Moved the <span class="id">Archive</span> modules to the <span class="path">Archive</span> directory and split the <span class="cmd">archive-get</span> and <span class="cmd">archive-push</span> commands into separate modules.</li><li class="list-unordered">Split the <span class="cmd">check</span> command out of the <span class="id">Archive.pm</span> module.</li><li class="list-unordered">Allow logging to be suppressed via <span class="id">logDisable()</span> and <span class="id">logEnable()</span>.</li><li class="list-unordered">Allow for locks to be taken more than once in the same process without error.</li><li class="list-unordered">Lock directories can be created when more than one directory level is required.</li><li class="list-unordered">Clean up <span class="id">optionValid()</span>/<span class="id">optionTest()</span> logic in <span class="id">Lock.pm</span>.</li><li class="list-unordered">Added <span class="id">Exception::exceptionCode()</span> and <span class="id">Exception::exceptionMessage()</span> to simplify error handling logic.</li><li class="list-unordered">Represent <span class="file">.gz</span> extension with a constant.</li><li class="list-unordered">Allow empty files to be created with <span class="id">FileCommon::fileStringWrite()</span> and use temp files to avoid partial reads.</li><li class="list-unordered">Refactor process IO and process master/minion code out from the common protocol code.</li><li class="list-unordered">Fixed alignment issues with multiline logging.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Features:</b></div><ul class="list-unordered"><li class="list-unordered">Added documentation to the User Guide for the <span class="br-option">process-max</span> option. (<i>Contributed by Cynthia Shang.</i>)</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Update LICENSE.txt for 2017.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed <span class="br-option">--no-online</span> tests to suppress expected errors.</li><li class="list-unordered">Added integration for testing coverage with <span class="id">Devel::Cover</span>.</li><li class="list-unordered">Added unit tests for low-level functions in the <span class="id">File</span> and <span class="id">BackupCommon</span> modules.</li><li class="list-unordered">C Library builds only run when C library has actually changed.</li><li class="list-unordered">Added more flexibility in initializing and cleaning up after modules and tests.</li><li class="list-unordered"><span class="id">testResult()</span> suppresses logging and reports exceptions.</li><li class="list-unordered"><span class="id">testException()</span> allows messages to be matched with regular expressions.</li><li class="list-unordered">Split test modules into separate files to make the code more maintainable. Tests are dynamically loaded by name rather than requiring an if-else block.</li><li class="list-unordered">Allow multiple <span class="br-setting">--module</span>, <span class="br-setting">--test</span>, and <span class="br-setting">--run</span> options to be used for <span class="file">test.pl</span>.</li><li class="list-unordered">Added expect log expression to replace year subdirectories in <span class="path">backup.history</span>.</li><li class="list-unordered">Refactor name/locations of common modules that setup test environments.</li></ul></div></div><div class="section2"><a id="1.12"></a><div class="section2-header"><div class="section2-title">v1.12 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Page Checksums, Configuration, and Bug Fixes</div><div class="section2-subsubtitle">Released December 12, 2016</div><div class="section-body-text"><b>IMPORTANT NOTE</b>: In prior releases it was possible to specify options on the command-line that were invalid for the current command without getting an error. An error will now be generated for invalid options so it is important to carefully check command-line options in your environment to prevent disruption.</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where options that were invalid for the specified command could be provided on the command-line without generating an error. The options were ignored and did not cause any change in behavior, but it did lead to some confusion. Invalid options will now generate an error. (<i>Reported by Nikhilchandra Kulkarni.</i>)</li><li class="list-unordered">Fixed an issue where internal symlinks were not being created for tablespaces in the repository. This issue was only apparent when trying to bring up clusters in-place manually using filesystem snapshots and did not affect normal backup and restore.</li><li class="list-unordered">Fixed an issue that prevented errors from being output to the console before the logging system was initialized, i.e. while parsing options. Error codes were still being returned accurately so this would not have made a process look like it succeeded when it did not. (<i>Reported by Adrian Vondendriesch.</i>)</li><li class="list-unordered">Fixed an issue where the <span class="br-option">db-port</span> option specified on the backup server would not be properly passed to the remote unless it was from the first configured database. (<i>Reported by Michael Vitale.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Added the <span class="br-option">--checksum-page</span> option to allow pgBackRest to validate page checksums in data files when checksums are enabled on <span class="postgres">PostgreSQL</span> >= 9.3. Note that this functionality requires a C library which may not initially be available in OS packages. The option will automatically be enabled when the library is present and checksums are enabled on the cluster. (<i>Suggested by Stephen Frost.</i>)</li><li class="list-unordered">Added the <span class="br-option">--repo-link</span> option to allow internal symlinks to be suppressed when the repository is located on a filesystem that does not support symlinks. This does not affect any <span class="backrest">pgBackRest</span> functionality, but the convenience link <span class="path">latest</span> will not be created and neither will internal tablespace symlinks, which will affect the ability to bring up clusters in-place manually using filesystem snapshots.</li><li class="list-unordered">Added the <span class="br-option">--repo-sync</span> option to allow directory syncs in the repository to be disabled for file systems that do not support them, e.g. NTFS.</li><li class="list-unordered">Added a predictable log entry to signal that a command has completed successfully. For example a backup ends successfully with: <span class="id">INFO: backup command end: completed successfully</span>. (<i>Suggested by Jens Wilke.</i>)</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">For simplicity, the <span class="file">pg_control</span> file is now copied with the rest of the files instead of by itself of at the end of the process. The <span class="cmd">backup</span> command does not require this behavior and the <span class="cmd">restore</span> copies to a temporary file which is renamed at the end of the restore.</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Abstracted code to determine which database cluster is the primary and which are standbys. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Improved consistency and flexibility of the protocol layer by using JSON for all messages.</li><li class="list-unordered">File copy protocol now accepts a function that can do additional processing on the copy buffers and return a result to the calling process.</li><li class="list-unordered">Improved <span class="id">IO->bufferRead</span> to always return requested number of bytes until EOF.</li><li class="list-unordered">Simplified the result hash of <span class="id">File->manifest()</span>, <span class="id">Db->tablespaceMapGet()</span>, and <span class="id">Db->databaseMapGet()</span>.</li><li class="list-unordered">Improved errors returned from child processes by removing redundant error level and code.</li><li class="list-unordered">Code cleanup in preparation for improved <span class="cmd">stanza-create</span> command. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Improved parameter/result logging in debug/trace functions.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue that suppressed exceptions in PDF builds.</li><li class="list-unordered">Fixed regression in section links introduced in <span class="host">v1.10</span>.</li></ul><div class="section-body-text"><b>Documentation Features:</b></div><ul class="list-unordered"><li class="list-unordered">Added Retention to QuickStart section.</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Allow a source to be included as a section so large documents can be broken up.</li><li class="list-unordered">Added section link support to Markdown output.</li><li class="list-unordered">Added list support to PDF output.</li><li class="list-unordered">Added <span class="br-setting">include</span> option to explicitly build sources (complements the <span class="br-setting">exclude</span> option though both cannot be used in the same invocation).</li><li class="list-unordered">Added <span class="br-setting">keyword-add</span> option to add keywords without overriding the <span class="id">default</span> keyword.</li><li class="list-unordered">Added <span class="br-setting">debug</span> option to <span class="file">doc.pl</span> to easily add the <span class="id">debug</span> keyword to documentation builds.</li><li class="list-unordered">Added <span class="br-setting">pre</span> option to <span class="file">doc.pl</span> to easily add the <span class="id">pre</span> keyword to documentation builds.</li><li class="list-unordered">Builds in <span class="file">release.pl</span> now remove all docker containers to get consistent IP address assignments.</li><li class="list-unordered">Improvements to markdown rendering.</li><li class="list-unordered">Remove code dependency on <span class="id">project</span> variable, instead use <span class="id">title</span> param.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Removed erroneous <span class="br-option">--no-config</span> option in <span class="id">help</span> test module.</li><li class="list-unordered">Update control and WAL test files to <span class="id">9.4</span> with matching system identifiers. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Improved exception handling in file unit tests.</li><li class="list-unordered">Changed the <span class="br-option">--no-fork</span> test option to <span class="br-option">--fork</span> with negation to match all other boolean parameters.</li><li class="list-unordered">Various improvements to validation of backup and restore.</li><li class="list-unordered">Add more realistic data files to synthetic backup and restore tests.</li></ul></div></div><div class="section2"><a id="1.11"></a><div class="section2-header"><div class="section2-title">v1.11 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Bug Fix for Asynchronous Archiving Efficiency</div><div class="section2-subsubtitle">Released November 17, 2016</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where asynchronous archiving was transferring one file per execution instead of transferring files in batches. This regression was introduced in <span class="host">v1.09</span> and affected efficiency only, all WAL segments were correctly archived in asynchronous mode. (<i>Reported by Stephen Frost.</i>)</li></ul></div></div><div class="section2"><a id="1.10"></a><div class="section2-header"><div class="section2-title">v1.10 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Stanza Creation and Minor Bug Fixes</div><div class="section2-subsubtitle">Released November 8, 2016</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where a backup could error if no changes were made to a database between backups and only <span class="file">pg_control</span> changed.</li><li class="list-unordered">Fixed an issue where tablespace paths with the same prefix would cause an invalid link error. (<i>Reported by Nikhilchandra Kulkarni.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Added the <span class="cmd">stanza-create</span> command to formalize creation of stanzas in the repository. (<i>Contributed by Cynthia Shang.</i>)</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Removed extraneous <span class="id">use lib</span> directives from Perl modules. (<i>Suggested by Devrim G&uuml;nd&uuml;z.</i>)</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed missing variable replacements.</li><li class="list-unordered">Removed hard-coded host names from configuration file paths.</li><li class="list-unordered">Allow command-line length to be configured using <span class="id">cmd-line-len</span> param.</li><li class="list-unordered">Added <span class="id">compact</span> param to allow CSS to be embedded in HTML file.</li><li class="list-unordered">Added <span class="id">pretty</span> param to produce HTML with proper indenting.</li><li class="list-unordered">Only generate HTML menu when required and don't require index page.</li><li class="list-unordered">Assign numbers to sections by default.</li><li class="list-unordered">VM mount points are now optional.</li></ul></div></div><div class="section2"><a id="1.09"></a><div class="section2-header"><div class="section2-title">v1.09 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">9.6 Support, Configurability, and Bug Fixes</div><div class="section2-subsubtitle">Released October 10, 2016</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed the <span class="cmd">check</span> command to prevent an error message from being logged if the backup directory does not exist. (<i>Fixed by Cynthia Shang.</i>)</li><li class="list-unordered">Fixed error message to properly display the archive command when an invalid archive command is detected. (<i>Reported by Jason O'Donnell.</i>)</li><li class="list-unordered">Fixed an issue where the async archiver would not be started if <span class="cmd">archive-push</span> did not have enough space to queue a new WAL segment. This meant that the queue would never be cleared without manual intervention (such as calling <span class="cmd">archive-push</span> directly). <span class="postgres">PostgreSQL</span> now receives errors when there is not enough space to store new WAL segments but the async process will still be started so that space is eventually freed. (<i>Reported by Jens Wilke.</i>)</li><li class="list-unordered">Fixed a remote timeout that occurred when a local process generated checksums (during resume or restore) but did not copy files, allowing the remote to go idle. (<i>Reported by Jens Wilke.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Non-exclusive backups will automatically be used on <span class="postgres">PostgreSQL</span> 9.6.</li><li class="list-unordered">Added the <span class="br-option">cmd-ssh</span> option to allow the ssh client to be specified. (<i>Suggested by Jens Wilke.</i>)</li><li class="list-unordered">Added the <span class="br-option">log-level-stderr</span> option to control whether console log messages are sent to <span class="id">stderr</span> or <span class="id">stdout</span>. By default this is set to <span class="br-setting">warn</span> which represents a change in behavior from previous versions, even though it may be more intuitive. Setting <span class="br-option">log-level-stderr=off</span> will preserve the old behavior. (<i>Suggested by Sascha Biberhofer.</i>)</li><li class="list-unordered">Set <span class="id">application_name</span> to <span class="id">"pgBackRest [command]"</span> for database connections. (<i>Suggested by Jens Wilke.</i>)</li><li class="list-unordered">Check that archive_mode is enabled when <span class="br-option">archive-check</span> option enabled.</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Clarified error message when unable to acquire <span class="backrest">pgBackRest</span> advisory lock to make it clear that it is not a <span class="postgres">PostgreSQL</span> backup lock. (<i>Suggested by Jens Wilke.</i>)</li><li class="list-unordered"><span class="backrest">pgBackRest</span> version number included in command start INFO log output.</li><li class="list-unordered">Process ID logged for local process start/stop INFO log output.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Features:</b></div><ul class="list-unordered"><li class="list-unordered">Added <span class="br-option">archive-timeout</span> option documentation to the user guide. (<i>Contributed by Cynthia Shang.</i>)</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Added <span class="br-setting">dev</span> option to <span class="file">doc.pl</span> to easily add the <span class="id">dev</span> keyword to documentation builds.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Update CentOS/Debian package definitions.</li><li class="list-unordered">Fixed missing expect output for help module.</li><li class="list-unordered">Fixed broken <span class="id">vm-max</span> option in <span class="file">test.pl</span>.</li><li class="list-unordered">Regression tests can now be run as any properly-configured user, not just vagrant.</li><li class="list-unordered">Miminize TeXLive package list to save time during VM builds.</li></ul></div></div><div class="section2"><a id="1.08"></a><div class="section2-header"><div class="section2-title">v1.08 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Bug Fixes and Log Improvements</div><div class="section2-subsubtitle">Released September 14, 2016</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where local processes were not disconnecting when complete and could later timeout. (<i>Reported by Todd Vernick.</i>)</li><li class="list-unordered">Fixed an issue where the protocol layer could timeout while waiting for WAL segments to arrive in the archive. (<i>Reported by Todd Vernick.</i>)</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Cache file log output until the file is created to create a more complete log.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Show Process ID in output instead of filtering it out with the timestamp.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Suppress <q>dpkg-reconfigure: unable to re-open stdin: No file or directory</q> warning in Vagrant VM build. (<i>Contributed by John Harvey.</i>)</li><li class="list-unordered">Show Process ID in expect logs instead of filtering it out with the timestamp.</li></ul></div></div><div class="section2"><a id="1.07"></a><div class="section2-header"><div class="section2-title">v1.07 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Thread to Process Conversion and Bug Fixes</div><div class="section2-subsubtitle">Released September 7, 2016</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where tablespaces were copied from the primary during standby backup.</li><li class="list-unordered">Fixed the <span class="cmd">check</span> command so backup info is checked remotely and not just locally. (<i>Fixed by Cynthia Shang.</i>)</li><li class="list-unordered">Fixed an issue where <span class="br-option">retention-archive</span> was not automatically being set when <span class="br-option">retention-archive-type=diff</span>, resulting in a less aggressive than intended expiration of archive. (<i>Fixed by Cynthia Shang.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Converted Perl threads to processes to improve compatibility and performance.</li><li class="list-unordered">Exclude contents of <span class="path">$PGDATA/pg_replslot</span> directory so that replication slots on the primary do not become part of the backup.</li><li class="list-unordered">The <span class="br-setting">archive-start</span> and <span class="br-setting">archive-stop</span> settings are now filled in <span class="file">backup.manifest</span> even when <span class="br-option">archive-check=n</span>. (<i>Suggested by Jens Wilke.</i>)</li><li class="list-unordered">Additional warnings when archive retention settings may not have the intended effect or would allow indefinite retention. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Experimental support for non-exclusive backups in <span class="postgres">PostgreSQL</span> 9.6 rc1. Changes to the control/catalog/WAL versions in subsequent release candidates may break compatibility but <span class="backrest">pgBackRest</span> will be updated with each release to keep pace.</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Refactor of protocol minions in preparation for the new local minion.</li><li class="list-unordered">Remove obsolete thread index variable from <span class="id">File()</span> module.</li><li class="list-unordered">Changed temporary file names to consistently use the <span class="file">.pgbackrest.tmp</span> extension even if the destination file is compressed or has an appended checksum.</li><li class="list-unordered">Improve ASSERT error handling, safely check eval blocks, and convert <span class="id">$@</span> to <span class="id">$EVAL_ERROR</span>.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed minor documentation reproducibility issues related to binary paths.</li></ul><div class="section-body-text"><b>Documentation Features:</b></div><ul class="list-unordered"><li class="list-unordered">Documentation for archive retention. (<i>Contributed by Cynthia Shang.</i>)</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Suppress TOC for unsupported versions of <span class="backrest">pgBackRest</span>.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">New vagrant base box and make uid/gid selection for containers dynamic.</li></ul></div></div><div class="section2"><a id="1.06"></a><div class="section2-header"><div class="section2-title">v1.06 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Backup from Standby and Bug Fixes</div><div class="section2-subsubtitle">Released August 25, 2016</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where a tablespace link that referenced another link would not produce an error, but instead skip the tablespace entirely. (<i>Reported by Michael Vitale.</i>)</li><li class="list-unordered">Fixed an issue where options that should not allow multiple values could be specified multiple times in <span class="file">pgbackrest.conf</span> without an error being raised. (<i>Reported by Michael Vitale.</i>)</li><li class="list-unordered">Fixed an issue where the <span class="br-option">protocol-timeout</span> option was not automatically increased when the <span class="br-option">db-timeout</span> option was increased. (<i>Reported by Todd Vernick.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Backup from a standby cluster. A connection to the primary cluster is still required to start/stop the backup and copy files that are not replicated, but the vast majority of files are copied from the standby in order to reduce load on the primary.</li><li class="list-unordered">More flexible configuration for databases. Master and standby can both be configured on the backup server and <span class="backrest">pgBackRest</span> will automatically determine which is the primary. This means no configuration changes for backup are required after failing over from a primary to standby when a separate backup server is used.</li><li class="list-unordered">Exclude directories during backup that are cleaned, recreated, or zeroed by <span class="postgres">PostgreSQL</span> at startup. These include <span class="path">pgsql_tmp</span> and <span class="path">pg_stat_tmp</span>. The <span class="file">postgresql.auto.conf.tmp</span> file is now excluded in addition to files that were already excluded: <span class="file">backup_label.old</span>, <span class="file">postmaster.opts</span>, <span class="file">postmaster.pid</span>, <span class="file">recovery.conf</span>, <span class="file">recovery.done</span>.</li><li class="list-unordered">Experimental support for non-exclusive backups in <span class="postgres">PostgreSQL</span> 9.6 beta4. Changes to the control/catalog/WAL versions in subsequent betas may break compatibility but <span class="backrest">pgBackRest</span> will be updated with each release to keep pace.</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Improve error message for links that reference links in manifest build.</li><li class="list-unordered">Added hints to error message when relative paths are detected in <span class="cmd">archive-push</span> or <span class="cmd">archive-get</span>.</li><li class="list-unordered">Improve backup log messages to indicate which host the files are being copied from.</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Simplify protocol creation and identifying which host is local/remote.</li><li class="list-unordered">Removed all <span class="id">OP_*</span> function constants that were used only for debugging, not in the protocol, and replaced with <span class="id">__PACKAGE__</span>.</li><li class="list-unordered">Improvements in <span class="id">Db</span> module: separated out <span class="id">connect()</span> function, allow <span class="id">executeSql()</span> calls that do not return data, and improve error handling.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Improve host tag rendering.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Refactor db version constants into a separate module.</li><li class="list-unordered">Update synthetic backup tests to <span class="postgres">PostgreSQL</span> 9.4.</li></ul></div></div><div class="section2"><a id="1.05"></a><div class="section2-header"><div class="section2-title">v1.05 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Bug Fix for Tablespace Link Checking</div><div class="section2-subsubtitle">Released August 9, 2016</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where tablespace paths that had $PGDATA as a substring would be identified as a subdirectories of $PGDATA even when they were not. Also hardened relative path checking a bit. (<i>Reported by Chris Fort.</i>)</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Features:</b></div><ul class="list-unordered"><li class="list-unordered">Added documentation for scheduling backups with cron. (<i>Contributed by Cynthia Shang.</i>)</li></ul><div class="section-body-text"><b>Documentation Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Moved the backlog from the <span class="backrest">pgBackRest</span> website to the GitHub repository wiki. (<i>Contributed by Cynthia Shang.</i>)</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Improved rendering of spaces in code blocks.</li></ul></div></div><div class="section2"><a id="1.04"></a><div class="section2-header"><div class="section2-title">v1.04 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Various Bug Fixes</div><div class="section2-subsubtitle">Released July 30, 2016</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue an where an extraneous remote was created causing threaded backup/restore to possibly timeout and/or throw a lock conflict. (<i>Reported by Michael Vitale.</i>)</li><li class="list-unordered">Fixed an issue where db-path was not required for the <span class="cmd">check</span> command so an assert was raised when it was missing rather than a polite error message. (<i>Reported by Michael Vitale.</i>)</li><li class="list-unordered">Fixed <span class="cmd">check</span> command to throw an error when database version/id does not match that of the archive. (<i>Fixed by Cynthia Shang.</i>)</li><li class="list-unordered">Fixed an issue where a remote could try to start its own remote when the <span class="br-option">backup-host</span> option was not present in <span class="file">pgbackrest.conf</span> on the database server. (<i>Reported by Lardi&egrave;re S&eacute;bastien.</i>)</li><li class="list-unordered">Fixed an issue where the contents of <span class="path">pg_xlog</span> were being backed up if the directory was symlinked. This didn't cause any issues during restore but was a waste of space.</li><li class="list-unordered">Fixed an invalid <span class="id">log()</span> call in lock routines.</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Experimental support for non-exclusive backups in <span class="postgres">PostgreSQL</span> 9.6 beta3. Changes to the control/catalog/WAL versions in subsequent betas may break compatibility but <span class="backrest">pgBackRest</span> will be updated with each release to keep pace.</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Suppress banners on SSH protocol connections.</li><li class="list-unordered">Improved remote error messages to identify the host where the error was raised.</li><li class="list-unordered">All remote types now take locks. The exceptions date to when the test harness and <span class="backrest">pgBackRest</span> were running in the same VM and no longer apply.</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Enhancements to the protocol layer for improved reliability and error handling.</li><li class="list-unordered">Exceptions are now passed back from threads as messages when possible rather than raised directly.</li><li class="list-unordered">Temp files created during backup are now placed in the same directory as the target file.</li><li class="list-unordered">Output lock file name when a lock cannot be acquired to aid in debugging.</li><li class="list-unordered">Reduce calls to <span class="id">protocolGet()</span> in backup/restore.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Features:</b></div><ul class="list-unordered"><li class="list-unordered">Added clarification on why the default for the <span class="br-option">backrest-user</span> option is <span class="id">backrest</span>. (<i>Suggested by Michael Vitale.</i>)</li><li class="list-unordered">Updated information about package availability on supported platforms. (<i>Suggested by Michael Vitale.</i>)</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Added <span class="file">release.pl</span> to make releases reproducible. For now this only includes building and deploying documentation.</li><li class="list-unordered">HTML footer dates are statically created in English in order to be reproducible. (<i>Suggested by Adrian Vondendriesch.</i>)</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed a version checking issue in <span class="file">test.pl</span>.</li><li class="list-unordered">Fixed an issue where multi-threaded tests were not being run when requested.</li><li class="list-unordered">Reduce the frequency that certain tests are run to save time in regression.</li><li class="list-unordered">Disable control master for older OS versions where it is less stable.</li></ul></div></div><div class="section2"><a id="1.03"></a><div class="section2-header"><div class="section2-title">v1.03 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Check Command and Bug Fixes</div><div class="section2-subsubtitle">Released July 2, 2016</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where <span class="id">keep-alives</span> could be starved out by lots of small files during multi-threaded <span class="cmd">backup</span>. They were also completely absent from single/multi-threaded <span class="cmd">backup</span> resume and <span class="cmd">restore</span> checksumming. (<i>Reported by Janice Parkinson, Chris Barber.</i>)</li><li class="list-unordered">Fixed an issue where the <span class="cmd">expire</span> command would refuse to run when explicitly called from the command line if the <span class="br-option">db-host</span> option was set. This was not an issue when <span class="cmd">expire</span> was run automatically after a <span class="cmd">backup</span> (<i>Reported by Chris Barber.</i>)</li><li class="list-unordered">Fixed an issue where validation was being running on <span class="pg-setting">archive_command</span> even when the <span class="br-option">archive-check</span> option was disabled.</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Added <span class="cmd">check</span> command to validate that <span class="backrest">pgBackRest</span> is configured correctly for archiving and backups. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Added the <span class="br-option">protocol-timeout</span> option. Previously <span class="br-option">protocol-timeout</span> was set as <span class="br-option">db-timeout</span> + 30 seconds.</li><li class="list-unordered">Failure to shutdown remotes at the end of the backup no longer throws an exception. Instead a warning is generated that recommends a higher <span class="br-option">protocol-timeout</span>.</li><li class="list-unordered">Experimental support for non-exclusive backups in <span class="postgres">PostgreSQL</span> 9.6 beta2. Changes to the control/catalog/WAL versions in subsequent betas may break compatibility but <span class="backrest">pgBackRest</span> will be updated with each release to keep pace.</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Improved handling of users/groups captured during backup that do not exist on the restore host. Also explicitly handle the case where user/group is not mapped to a name.</li><li class="list-unordered">Option handling is now far more strict. Previously it was possible for a command to use an option that was not explicitly assigned to it. This was especially true for the <span class="br-option">backup-host</span> and <span class="br-option">db-host</span> options which are used to determine locality.</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">The <span class="id">pg_xlogfile_name()</span> function is no longer used to construct WAL filenames from LSNs. While this function is convenient it is not available on a standby. Instead, the archive is searched for the LSN in order to find the timeline. If due to some misadventure the LSN appears on multiple timelines then an error will be thrown, whereas before this condition would have passed unnoticed.</li><li class="list-unordered">Changed version variable to a constant. It had originally been designed to play nice with a specific packaging tool but that tool was never used.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Allow a static date to be used for documentation to generate reproducible builds. (<i>Suggested by Adrian Vondendriesch.</i>)</li><li class="list-unordered">Added documentation for asynchronous archiving to the user guide. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Recommended install location for <span class="backrest">pgBackRest</span> modules is now <span class="path">/usr/share/perl5</span> since <span class="path">/usr/lib/perl5</span> has been removed from the search path in newer versions of Perl.</li><li class="list-unordered">Added instructions for removing prior versions of <span class="backrest">pgBackRest</span>.</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed DTD search path that did not work properly when <span class="br-setting">--doc-path</span> was used.</li><li class="list-unordered">Fixed <span class="backrest">pgBackRest</span>-specific xml that was loaded for non-<span class="backrest">pgBackRest</span> projects.</li><li class="list-unordered">Fixed section names being repeated in the info output when multiple <span class="br-option">--require</span> options depended on the same sections.</li><li class="list-unordered">Fixed <span class="backrest">pgBackRest</span> config sections being blank in the output when not loaded from cache.</li><li class="list-unordered">Allow hidden options to be added to a command. This allows certain commands (like <span class="id">apt-get</span>) to be forced during the build without making that a part of the documentation.</li><li class="list-unordered">Allow command summaries to be inserted anywhere in the documentation to avoid duplication.</li><li class="list-unordered">Update TeX Live to 2016 version.</li><li class="list-unordered">New, consolidated implementation for link rendering.</li><li class="list-unordered"><span class="postgres">PostgreSQL</span> version is now a variable to allow multi-version documentation.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Obsolete containers are removed by the <span class="br-option">--vm-force</span> option.</li><li class="list-unordered">Major refactor of the test suite to make it more modular and object-oriented. Multiple Docker containers can now be created for a single test to simulate more realistic environments. Tests paths have been renamed for clarity.</li><li class="list-unordered">Greatly reduced the quantity of Docker containers built by default. Containers are only built for <span class="postgres">PostgreSQL</span> versions specified in <span class="id">db-minimal</span> and those required to build documentation. Additional containers can be built with <span class="br-option">--db-version=all</span> or by specifying a version, e.g. <span class="br-option">--db-version=9.4</span>.</li></ul></div></div><div class="section2"><a id="1.02"></a><div class="section2-header"><div class="section2-title">v1.02 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Bug Fix for Perl 5.22</div><div class="section2-subsubtitle">Released June 2, 2016</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fix usage of sprintf() due to new constraints in Perl 5.22. Parameters not referenced in the format string are no longer allowed. (<i>Fixed by Adrian Vondendriesch.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Log directory create and file open now using FileCommon functions which produce more detailed error messages on failure.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed syntax that was not compatible with Perl 5.2X. (<i>Fixed by Christoph Berg, Adrian Vondendriesch.</i>)</li><li class="list-unordered">Fixed absolute paths that were used for the PDF logo. (<i>Reported by Adrian Vondendriesch.</i>)</li></ul><div class="section-body-text"><b>Documentation Features:</b></div><ul class="list-unordered"><li class="list-unordered">Release notes are now broken into sections so that bugs, features, and refactors are clearly delineated. An <q>Additional Notes</q> section has been added for changes to documentation and the test suite that do not affect the core code.</li><li class="list-unordered">Added man page generation. (<i>Contributed by Adrian Vondendriesch, David Steele.</i>)</li><li class="list-unordered">The change log was the last piece of documentation to be rendered in Markdown only. Wrote a converter so the document can be output by the standard renderers. The change log will now be located on the website and has been renamed to <q>Releases</q>. (<i>Contributed by Cynthia Shang.</i>)</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Added an execution cache so that documentation can be generated without setting up the full container environment. This is useful for packaging, keeps the documentation consistent for a release, and speeds up generation when no changes are made in the execution list.</li><li class="list-unordered">Remove function constants and pass strings directly to logDebugParam(). The function names were only used once so creating constants for them was wasteful.</li><li class="list-unordered">Lists can now be used outside of <span class="id">p</span> and <span class="id">text</span> tags for more flexible document structuring.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Replaced overzealous <span class="id">perl -cW</span> check which failed on Perl 5.22 with <span class="id">perl -cw</span>.</li><li class="list-unordered">Added Ubuntu 16.04 (Xenial) and Debian 8 (Jessie) to the regression suite.</li><li class="list-unordered">Upgraded doc/test VM to Ubuntu 16.04. This will help catch Perl errors in the doc code since it is not run across multiple distributions like the core and test code. It is also to be hoped that a newer kernel will make Docker more stable.</li><li class="list-unordered">Test release version against the executable using <span class="file">change-log.xml</span> instead of <span class="file">CHANGELOG.md</span>.</li></ul></div></div><div class="section2"><a id="1.01"></a><div class="section2-header"><div class="section2-title">v1.01 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Enhanced Info, Selective Restore, and 9.6 Support</div><div class="section2-subsubtitle">Released May 17, 2016</div><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Enhanced text output of <span class="cmd">info</span> command to include timestamps, sizes, and the reference list for all backups. (<i>Contributed by Cynthia Shang.</i>)</li><li class="list-unordered">Allow selective restore of databases from a cluster backup. This feature can result in major space and time savings when only specific databases are restored. Unrestored databases will not be accessible but must be manually dropped before they will be removed from the shared catalogue. (<i>Reviewed by Cynthia Shang, Greg Smith, Stephen Frost. Suggested by Stephen Frost.</i>)</li><li class="list-unordered">Experimental support for non-exclusive backups in <span class="postgres">PostgreSQL</span> 9.6 beta1. Changes to the control/catalog/WAL versions in subsequent betas may break compatibility but <span class="backrest">pgBackRest</span> will be updated with each release to keep pace. (<i>Reviewed by Cynthia Shang.</i>)</li></ul></div></div><div class="section2"><a id="1.00"></a><div class="section2-header"><div class="section2-title">v1.00 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">New Repository Format and Configuration Scheme, Link Support</div><div class="section2-subsubtitle">Released April 14, 2016</div><div class="section-body-text"><b>IMPORTANT NOTE</b>: This flag day release breaks compatibility with older versions of <span class="backrest">pgBackRest</span>. The manifest format, on-disk structure, configuration scheme, and the exe/path names have all changed. You must create a new repository to hold backups for this version of <span class="backrest">pgBackRest</span> and keep your older repository for a time in case you need to do a restore. Restores from the prior repository will require the prior version of <span class="backrest">pgBackRest</span> but because of name changes it is possible to have <span class="id">1.00</span> and a prior version of <span class="backrest">pgBackRest</span> installed at the same time. See the notes below for more detailed information on what has changed.</div><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Implemented a new configuration scheme which should be far simpler to use. See the User Guide and Configuration Reference for details but for a simple configuration all options can now be placed in the <span class="br-setting">stanza</span> section. Options that are shared between stanzas can be placed in the <span class="br-setting">[global]</span> section. More complex configurations can still make use of command sections though this should be a rare use case. (<i>Suggested by Michael Renner.</i>)</li><li class="list-unordered">The <span class="br-setting">repo-path</span> option now always refers to the repository where backups and archive are stored, whether local or remote, so the <span class="br-setting">repo-remote-path</span> option has been removed. The new <span class="br-setting">spool-path</span> option can be used to define a location for queueing WAL segments when archiving asynchronously. A local repository is no longer required.</li><li class="list-unordered">The default configuration filename is now <span class="file">pgbackrest.conf</span> instead of <span class="file">pg_backrest.conf</span>. This was done for consistency with other naming changes but also to prevent old config files from being loaded accidentally when migrating to <span class="id">1.00</span>. (<i>Suggested by Michael Renner, Stephen Frost.</i>)</li><li class="list-unordered">The default repository name was changed from <span class="path">/var/lib/backup</span> to <span class="path">/var/lib/pgbackrest</span>. (<i>Suggested by Michael Renner, Stephen Frost.</i>)</li><li class="list-unordered">Lock files are now stored in <span class="path">/tmp/pgbackrest</span> by default. These days <span class="path">/run/pgbackrest</span> is the preferred location but that would require init scripts which are not part of this release. The <span class="br-setting">lock-path</span> option can be used to configure the lock directory.</li><li class="list-unordered">Log files are now stored in <span class="path">/var/log/pgbackrest</span> by default and no longer have the date appended so they can be managed with <span class="id">logrotate</span>. The <span class="br-setting">log-path</span> option can be used to configure the lock directory. (<i>Suggested by Stephen Frost.</i>)</li><li class="list-unordered">Executable filename changed from <span class="file">pg_backrest</span> to <span class="file">pgbackrest</span>. (<i>Suggested by Michael Renner, Stephen Frost.</i>)</li><li class="list-unordered">All files and directories linked from PGDATA are now included in the backup. By default links will be restored directly into PGDATA as files or directories. The <span class="br-setting">--link-all</span> option can be used to restore all links to their original locations. The <span class="br-setting">--link-map</span> option can be used to remap a link to a new location.</li><li class="list-unordered">Removed <span class="br-setting">--tablespace</span> option and replaced with <span class="br-setting">--tablespace-map-all</span> option which should more clearly indicate its function.</li><li class="list-unordered">Added <span class="id">detail</span> log level which will output more information than <span class="id">info</span> without being as verbose as <span class="id">debug</span>.</li></ul></div></div></div></div><div class="section1"><a id="unsupported"></a><div class="section1-header"><div class="section1-title">Pre-Stable Releases</div></div><div class="section-body"><div class="section2"><a id="0.92"></a><div class="section2-header"><div class="section2-title">v0.92 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Command-line Repository Path Fix</div><div class="section2-subsubtitle">Released April 6, 2016</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where the master process was passing <span class="br-setting">--repo-remote-path</span> instead of <span class="br-setting">--repo-path</span> to the remote and causing the lock files to be created in the default repository directory (<span class="path">/var/lib/backup</span>), generally ending in failure. This was only an issue when <span class="br-setting">--repo-remote-path</span> was defined on the command line rather than in <span class="file">pg_backrest.conf</span>. (<i>Reported by Jan Wieck.</i>)</li></ul></div></div><div class="section2"><a id="0.91"></a><div class="section2-header"><div class="section2-title">v0.91 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Tablespace Bug Fix and Minor Enhancements</div><div class="section2-subsubtitle">Released March 22, 2016</div><div class="section-body-text"><b>IMPORTANT BUG FIX FOR TABLESPACES</b>: A change to the repository format was accidentally introduced in 0.90 which means the on-disk backup was no longer a valid <span class="postgres">PostgreSQL</span> cluster when the backup contained tablespaces. This only affected users who directly copied the backups to restore <span class="postgres">PostgreSQL</span> clusters rather than using the restore command. However, the fix breaks compatibility with older backups that contain tablespaces no matter how they are being restored (<span class="backrest">pgBackRest</span> will throw errors and refuse to restore). New full backups should be taken immediately after installing version 0.91 for any clusters that contain tablespaces. If older backups need to be restored then use a version of <span class="backrest">pgBackRest</span> that matches the backup version.</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed repository incompatibility introduced in <span class="backrest">pgBackRest</span> 0.90. (<i>Reported by Evan Benoit.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Copy <span class="file">global/pg_control</span> last during backups.</li><li class="list-unordered">Write <span class="id">.info</span> and <span class="id">.manifest</span> files to temp before moving them to their final locations and fsync'ing.</li><li class="list-unordered">Rename <span class="br-setting">--no-start-stop</span> option to <span class="br-setting">--no-online</span>.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Test Suite Features:</b></div><ul class="list-unordered"><li class="list-unordered">Static source analysis using Perl-Critic, currently passes on gentle.</li></ul></div></div><div class="section2"><a id="0.90"></a><div class="section2-header"><div class="section2-title">v0.90 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">9.5 Support, Various Enhancements, and Minor Bug Fixes</div><div class="section2-subsubtitle">Released February 7, 2016</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where specifying <span class="br-setting">--no-archive-check</span> would throw a configuration error. (<i>Reported by Jason O'Donnell.</i>)</li><li class="list-unordered">Fixed an issue where a temp WAL file left over after a well-timed system crash could cause the next <span class="cmd">archive-push</span> to fail.</li><li class="list-unordered">The <span class="br-setting">retention-archive</span> option can now be be safely set to less than backup retention (<span class="br-setting">retention-full</span> or <span class="br-setting">retention-diff</span>) without also specifying <span class="br-setting">archive-copy=n</span>. The WAL required to make the backups that fall outside of archive retention consistent will be preserved in the archive. However, in this case PITR will not be possible for the backups that fall outside of archive retention.</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">When backing up and restoring tablespaces <span class="backrest">pgBackRest</span> only operates on the subdirectory created for the version of <span class="postgres">PostgreSQL</span> being run against. Since multiple versions can live in a tablespace (especially during a binary upgrade) this prevents too many files from being copied during a backup and other versions possibly being wiped out during a restore. This only applies to <span class="postgres">PostgreSQL</span> >= 9.0 &mdash; prior versions of <span class="postgres">PostgreSQL</span> could not share a tablespace directory.</li><li class="list-unordered">Generate an error when <span class="br-setting">archive-check=y</span> but <span class="br-setting">archive_command</span> does not execute <span class="file">pg_backrest</span>. (<i>Contributed by Jason O'Donnell.</i>)</li><li class="list-unordered">Improved error message when <span class="br-setting">repo-path</span> or <span class="br-setting">repo-remote-path</span> does not exist.</li><li class="list-unordered">Added checks for <span class="br-setting">--delta</span> and <span class="br-setting">--force</span> restore options to ensure that the destination is a valid $PGDATA directory. <span class="backrest">pgBackRest</span> will check for the presence of <span class="file">PG_VERSION</span> or <span class="file">backup.manifest</span> (left over from an aborted restore). If neither file is found then <span class="br-setting">--delta</span> and <span class="br-setting">--force</span> will be disabled but the restore will proceed unless there are files in the $PGDATA directory (or any tablespace directories) in which case the operation will be aborted.</li><li class="list-unordered">When restore <span class="br-setting">--set=latest</span> (the default) the actual backup restored will be output to the log.</li><li class="list-unordered">Support for <span class="postgres">PostgreSQL</span> 9.5 partial WAL segments and <span class="br-setting">recovery_target_action</span> setting. The <span class="br-setting">archive_mode = 'always'</span> setting is not yet supported.</li><li class="list-unordered">Support for <span class="br-setting">recovery_target = 'immediate'</span> recovery setting introduced in <span class="postgres">PostgreSQL</span> 9.4.</li><li class="list-unordered">The following tablespace checks have been added: paths or files in pg_tblspc, relative links in pg_tblspc, tablespaces in $PGDATA. All three will generate errors.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where document generation failed because some OSs are not tolerant of having multiple installed versions of <span class="postgres">PostgreSQL</span>. A separate VM is now created for each version. Also added a sleep after database starts during document generation to ensure the database is running before the next command runs. (<i>Suggested by John Harvey.</i>)</li></ul></div></div><div class="section2"><a id="0.89"></a><div class="section2-header"><div class="section2-title">v0.89 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Timeout Bug Fix and Restore Read-Only Repositories</div><div class="section2-subsubtitle">Released December 24, 2015</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where longer-running backups/restores would timeout when remote and threaded. Keepalives are now used to make sure the remote for the main process does not timeout while the thread remotes do all the work. The error message for timeouts was also improved to make debugging easier. (<i>Reported by Stephen Frost.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Allow restores to be performed on a read-only repository by using <span class="br-setting">--no-lock</span> and <span class="br-setting">--log-level-file=off</span>. The <span class="br-setting">--no-lock</span> option can only be used with restores.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Minor styling changes, clarifications and rewording in the user guide.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">The dev branch has been renamed to master and for the time being the master branch has renamed to release, though it will probably be removed at some point -- thus ends the gitflow experiment for <span class="backrest">pgBackRest</span>. It is recommended that any forks get re-forked and clones get re-cloned.</li></ul></div></div><div class="section2"><a id="0.88"></a><div class="section2-header"><div class="section2-title">v0.88 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Documentation and Minor Bug Fixes</div><div class="section2-subsubtitle">Released November 22, 2015</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where the <span class="cmd">start</span>/<span class="cmd">stop</span> commands required the <span class="br-setting">--config</span> option. (<i>Reported by Dmitry Didovicher.</i>)</li><li class="list-unordered">Fixed an issue where log files were being overwritten instead of appended. (<i>Reported by Stephen Frost, Dmitry Didovicher.</i>)</li><li class="list-unordered">Fixed an issue where <span class="br-setting">backup-user</span> was not optional.</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Symlinks are no longer created in backup directories in the repository. These symlinks could point virtually anywhere and potentially be dangerous. Symlinks are still recreated during a restore. (<i>Suggested by Stephen Frost.</i>)</li><li class="list-unordered">Added better messaging for backup expiration. Full and differential backup expirations are logged on a single line along with a list of all dependent backups expired.</li><li class="list-unordered">Archive retention is automatically set to full backup retention if not explicitly configured.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Features:</b></div><ul class="list-unordered"><li class="list-unordered">Added documentation in the user guide for delta restores, expiration, dedicated backup hosts, starting and stopping <span class="backrest">pgBackRest</span>, and replication.</li></ul></div></div><div class="section2"><a id="0.87"></a><div class="section2-header"><div class="section2-title">v0.87 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Website and User Guide</div><div class="section2-subsubtitle">Released October 28, 2015</div><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">The <span class="file">backup_label.old</span> and <span class="file">recovery.done</span> files are now excluded from backups.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Features:</b></div><ul class="list-unordered"><li class="list-unordered">Added a new user guide that covers <span class="backrest">pgBackRest</span> basics and some advanced topics including PITR. Much more to come, but it's a start. (<i>Contributed by David Steele, Stephen Frost. Reviewed by Michael Renner, Cynthia Shang, Eric Radman, Dmitry Didovicher.</i>)</li></ul><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">The website, markdown, and command-line help are now all generated from the same XML source.</li></ul></div></div><div class="section2"><a id="0.85"></a><div class="section2-header"><div class="section2-title">v0.85 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Start/Stop Commands and Minor Bug Fixes</div><div class="section2-subsubtitle">Released October 8, 2015</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where an error could be returned after a backup or restore completely successfully.</li><li class="list-unordered">Fixed an issue where a resume would fail if temp files were left in the root backup directory when the backup failed. This scenario was likely if the backup process got terminated during the copy phase.</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Added <span class="cmd">stop</span> and <span class="cmd">start</span> commands to prevent <span class="backrest">pgBackRest</span> processes from running on a system where <span class="postgres">PostgreSQL</span> is shutdown or the system needs to be quiesced for some other reason.</li><li class="list-unordered">Experimental support for <span class="postgres">PostgreSQL</span> 9.5 beta1. This may break when the control version or WAL magic changes in future versions but will be updated in each <span class="backrest">pgBackRest</span> release to keep pace. All regression tests pass except for <span class="br-setting">--target-resume</span> tests (this functionality has changed in 9.5) and there is no testing yet for <span class="file">.partial</span> WAL segments.</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Removed dependency on <span class="id">IO::String</span> module.</li></ul></div></div><div class="section2"><a id="0.82"></a><div class="section2-header"><div class="section2-title">v0.82 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Refactoring, Command-line Help, and Minor Bug Fixes</div><div class="section2-subsubtitle">Released September 14, 2015</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where resumed compressed backups were not preserving existing files.</li><li class="list-unordered">Fixed an issue where resume and incr/diff would not ensure that the prior backup had the same compression and hardlink settings.</li><li class="list-unordered">Fixed an issue where a cold backup using <span class="br-setting">--no-start-stop</span> could be started on a running <span class="postgres">PostgreSQL</span> cluster without <span class="br-setting">--force</span> specified.</li><li class="list-unordered">Fixed an issue where a thread could be started even when none were requested.</li><li class="list-unordered">Fixed an issue where the <span class="backrest">pgBackRest</span> version number was not being updated in <span class="file">backup.info</span> and <span class="file">archive.info</span> after an upgrade/downgrade.</li><li class="list-unordered">Fixed an issue where the <span class="cmd">info</span> command was throwing an exception when the repository contained no stanzas. (<i>Reported by Stephen Frost.</i>)</li><li class="list-unordered">Fixed an issue where the <span class="postgres">PostgreSQL</span> <span class="id">pg_stop_backup()</span> NOTICEs were being output to <span class="id">stderr</span>. (<i>Reported by Stephen Frost.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Experimental support for <span class="postgres">PostgreSQL</span> 9.5 alpha2. This may break when the control version or WAL magic changes in future versions but will be updated in each <span class="backrest">pgBackRest</span> release to keep pace. All regression tests pass except for <span class="br-setting">--target-resume</span> tests (this functionality has changed in 9.5) and there is no testing yet for <span class="file">.partial</span> WAL segments.</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Renamed <span class="br-setting">recovery-setting</span> option and section to <span class="br-setting">recovery-option</span> to be more consistent with <span class="backrest">pgBackRest</span> naming conventions.</li><li class="list-unordered">Added dynamic module loading to speed up commands, especially asynchronous archiving.</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Code cleanup and refactoring to standardize on patterns that have evolved over time.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Features:</b></div><ul class="list-unordered"><li class="list-unordered">Command-line help is now extracted from the same XML source that is used for the other documentation and includes much more detail.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">Expiration tests are now synthetic rather than based on actual backups. This will allow development of more advanced expiration features.</li></ul></div></div><div class="section2"><a id="0.80"></a><div class="section2-header"><div class="section2-title">v0.80 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">DBI Support, Stability, and Convenience Features</div><div class="section2-subsubtitle">Released August 9, 2015</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue that caused the formatted timestamp for both the oldest and newest backups to be reported as the current time by the <span class="cmd">info</span> command. Only <span class="id">text</span> output was affected -- <span class="id">json</span> output reported the correct epoch values. (<i>Reported by Michael Renner.</i>)</li><li class="list-unordered">Fixed protocol issue that was preventing ssh errors (especially on connection) from being logged.</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">The repository is now created and updated with consistent directory and file modes. By default <span class="id">umask</span> is set to <span class="id">0000</span> but this can be disabled with the <span class="br-setting">neutral-umask</span> setting. (<i>Suggested by Cynthia Shang.</i>)</li><li class="list-unordered">Added the <span class="br-option">stop-auto</span> option to allow failed backups to automatically be stopped when a new backup starts.</li><li class="list-unordered">Added the <span class="br-option">db-timeout</span> option to limit the amount of time <span class="backrest">pgBackRest</span> will wait for <span class="id">pg_start_backup()</span> and <span class="id">pg_stop_backup()</span> to return.</li><li class="list-unordered">Remove <span class="file">pg_control</span> file at the beginning of the restore and copy it back at the very end. This prevents the possibility that a partial restore can be started by <span class="postgres">PostgreSQL</span>.</li><li class="list-unordered">Added checks to be sure the <span class="br-setting">db-path</span> setting is consistent with <span class="br-setting">db-port</span> by comparing the <span class="br-setting">data_directory</span> as reported by the cluster against the <span class="br-setting">db-path</span> setting and the version as reported by the cluster against the value read from <span class="file">pg_control</span>. The <span class="br-setting">db-socket-path</span> setting is checked to be sure it is an absolute path.</li><li class="list-unordered">Experimental support for <span class="postgres">PostgreSQL</span> 9.5 alpha1. This may break when the control version or WAL magic changes in future versions but will be updated in each <span class="backrest">pgBackRest</span> release to keep pace. All regression tests pass except for <span class="br-setting">--target-resume</span> tests (this functionality has changed in 9.5) and there is no testing yet for <span class="file">.partial</span> WAL segments.</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Now using Perl <span class="id">DBI</span> and <span class="id">DBD::Pg</span> for connections to <span class="postgres">PostgreSQL</span> rather than <span class="cmd">psql</span>. The <span class="br-setting">cmd-psql</span> and <span class="br-setting">cmd-psql-option</span> settings have been removed and replaced with <span class="br-setting">db-port</span> and <span class="br-setting">db-socket-path</span>. Follow the instructions in the Installation Guide to install <span class="id">DBD::Pg</span> on your operating system.</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Major refactoring of the protocol layer to support future development.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Development:</b></div><ul class="list-unordered"><li class="list-unordered">Split most of <span class="file">README.md</span> out into <span class="file">USERGUIDE.md</span> and <span class="file">CHANGELOG.md</span> because it was becoming unwieldy. Changed most references to <q>database</q> in the user guide to <q>database cluster</q> for clarity.</li><li class="list-unordered">Changed most references to <q>database</q> in the user guide to <q>database cluster</q> for clarity.</li></ul><div class="section-body-text"><b>Test Suite Features:</b></div><ul class="list-unordered"><li class="list-unordered">Added vagrant test configurations for Ubuntu 14.04 and CentOS 7.</li></ul></div></div><div class="section2"><a id="0.78"></a><div class="section2-header"><div class="section2-title">v0.78 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Remove CPAN Dependencies, Stability Improvements</div><div class="section2-subsubtitle">Released July 13, 2015</div><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Removed dependency on CPAN packages for multi-threaded operation. While it might not be a bad idea to update the <span class="id">threads</span> and <span class="id">Thread::Queue</span> packages, it is no longer necessary.</li><li class="list-unordered">Modified wait backoff to use a Fibonacci rather than geometric sequence. This will make wait time grow less aggressively while still giving reasonable values.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Test Suite Features:</b></div><ul class="list-unordered"><li class="list-unordered">Added vagrant test configurations for Ubuntu 12.04 and CentOS 6.</li></ul><div class="section-body-text"><b>Test Suite Development:</b></div><ul class="list-unordered"><li class="list-unordered">More options for regression tests and improved code to run in a variety of environments.</li></ul></div></div><div class="section2"><a id="0.77"></a><div class="section2-header"><div class="section2-title">v0.77 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">CentOS/RHEL 6 Support and Protocol Improvements</div><div class="section2-subsubtitle">Released June 30, 2015</div><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Added file and directory syncs to the <span class="id">File</span> object for additional safety during backup/restore and archiving. (<i>Suggested by Andres Freund.</i>)</li><li class="list-unordered">Added support for Perl 5.10.1 and OpenSSH 5.3 which are default for CentOS/RHEL 6. (<i>Suggested by Eric Radman.</i>)</li><li class="list-unordered">Improved error message when backup is run without <span class="br-setting">archive_command</span> set and without <span class="br-setting">--no-archive-check</span> specified. (<i>Suggested by Eric Radman.</i>)</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Removed <span class="file">pg_backrest_remote</span> and added the functionality to <span class="file">pg_backrest</span> as the <span class="cmd">remote</span> command.</li><li class="list-unordered">Moved version number out of the <span class="file">VERSION</span> file to <span class="file">Version.pm</span> to better support packaging. (<i>Suggested by Michael Renner.</i>)</li><li class="list-unordered">Replaced <span class="id">IPC::System::Simple</span> and <span class="id">Net::OpenSSH</span> with <span class="id">IPC::Open3</span> to eliminate CPAN dependency for multiple operating systems.</li></ul></div></div><div class="section2"><a id="0.75"></a><div class="section2-header"><div class="section2-title">v0.75 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">New Repository Format, Info Command and Experimental 9.5 Support</div><div class="section2-subsubtitle">Released June 14, 2015</div><div class="section-body-text"><b>IMPORTANT NOTE</b>: This flag day release breaks compatibility with older versions of <span class="backrest">pgBackRest</span>. The manifest format, on-disk structure, and the binary names have all changed. You must create a new repository to hold backups for this version of <span class="backrest">pgBackRest</span> and keep your older repository for a time in case you need to do a restore. The <span class="file">pg_backrest.conf</span> file has not changed but you'll need to change any references to <span class="file">pg_backrest.pl</span> in cron (or elsewhere) to <span class="file">pg_backrest</span> (without the <span class="file">.pl</span> extension).</div><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Added the <span class="cmd">info</span> command.</li><li class="list-unordered">Logging now uses unbuffered output. This should make log files that are being written by multiple threads less chaotic. (<i>Suggested by Michael Renner.</i>)</li><li class="list-unordered">Experimental support for <span class="postgres">PostgreSQL</span> 9.5. This may break when the control version or WAL magic changes but will be updated in each release.</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">More efficient file ordering for <span class="cmd">backup</span>. Files are copied in descending size order so a single thread does not end up copying a large file at the end. This had already been implemented for <span class="cmd">restore</span>.</li></ul></div></div><div class="section2"><a id="0.70"></a><div class="section2-header"><div class="section2-title">v0.70 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Stability Improvements for Archiving, Improved Logging and Help</div><div class="section2-subsubtitle">Released June 1, 2015</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where <span class="cmd">archive-copy</span> would fail on an incr/diff backup when <span class="br-setting">hardlink=n</span>. In this case the <span class="path">pg_xlog</span> path does not already exist and must be created. (<i>Reported by Michael Renner.</i>)</li><li class="list-unordered">Fixed an issue in async archiving where <span class="cmd">archive-push</span> was not properly returning 0 when <span class="br-setting">archive-max-mb</span> was reached and moved the async check after transfer to avoid having to remove the stop file twice. Also added unit tests for this case and improved error messages to make it clearer to the user what went wrong. (<i>Reported by Michael Renner.</i>)</li><li class="list-unordered">Fixed a locking issue that could allow multiple operations of the same type against a single stanza. This appeared to be benign in terms of data integrity but caused spurious errors while archiving and could lead to errors in backup/restore. (<i>Reported by Michael Renner.</i>)</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Allow duplicate WAL segments to be archived when the checksum matches. This is necessary for some recovery scenarios.</li><li class="list-unordered">Allow comments/disabling in <span class="file">pg_backrest.conf</span> using the <span class="id">#</span> character. Only <span class="id">#</span> characters in the forst character of the line are honored. (<i>Suggested by Michael Renner.</i>)</li><li class="list-unordered">Better logging before <span class="id">pg_start_backup()</span> to make it clear when the backup is waiting on a checkpoint. (<i>Suggested by Michael Renner.</i>)</li><li class="list-unordered">Various command behavior and logging fixes. (<i>Reviewed by Michael Renner. Suggested by Michael Renner.</i>)</li></ul><div class="section-body-text"><b> Improvements:</b></div><ul class="list-unordered"><li class="list-unordered">Replaced <span class="id">JSON</span> module with <span class="id">JSON::PP</span> which ships with core Perl.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Various help fixes. (<i>Reviewed by Michael Renner. Reported by Michael Renner.</i>)</li></ul></div></div><div class="section2"><a id="0.65"></a><div class="section2-header"><div class="section2-title">v0.65 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Improved Resume and Restore Logging, Compact Restores</div><div class="section2-subsubtitle">Released May 11, 2015</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed an issue where an absolute path was not written into <span class="file">recovery.conf</span> when the restore was run with a relative path.</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Better resume support. Resumed files are checked to be sure they have not been modified and the manifest is saved more often to preserve checksums as the backup progresses. More unit tests to verify each resume case.</li><li class="list-unordered">Resume is now optional. Use the <span class="br-setting">resume</span> setting or <span class="br-setting">--no-resume</span> from the command line to disable.</li><li class="list-unordered">More info messages during restore. Previously, most of the restore messages were debug level so not a lot was output in the log.</li><li class="list-unordered">Added <span class="br-setting">tablespace</span> setting to allow tablespaces to be restored into the <span class="path">pg_tblspc</span> path. This produces compact restores that are convenient for development, staging, etc. Currently these restores cannot be backed up as <span class="backrest">pgBackRest</span> expects only links in the <span class="path">pg_tblspc</span> path.</li></ul></div></div><div class="section2"><a id="0.61"></a><div class="section2-header"><div class="section2-title">v0.61 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Bug Fix for Uncompressed Remote Destination</div><div class="section2-subsubtitle">Released April 21, 2015</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed a buffering error that could occur on large, highly-compressible files when copying to an uncompressed remote destination. The error was detected in the decompression code and resulted in a failed backup rather than corruption so it should not affect successful backups made with previous versions.</li></ul></div></div><div class="section2"><a id="0.60"></a><div class="section2-header"><div class="section2-title">v0.60 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Better Version Support and WAL Improvements</div><div class="section2-subsubtitle">Released April 19, 2015</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Pushing duplicate WAL now generates an error. This worked before only if checksums were disabled.</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Database System IDs are used to make sure that all WAL in an archive matches up. This should help prevent misconfigurations that send WAL from multiple clusters to the same archive.</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Improved threading model by starting threads early and terminating them late.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Test Suite Features:</b></div><ul class="list-unordered"><li class="list-unordered">Regression tests working back to <span class="postgres">PostgreSQL</span> 8.3.</li></ul></div></div><div class="section2"><a id="0.50"></a><div class="section2-header"><div class="section2-title">v0.50 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Restore and Much More</div><div class="section2-subsubtitle">Released March 25, 2015</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Fixed broken checksums and now they work with normal and resumed backups. Finally realized that checksums and checksum deltas should be functionally separated and this simplified a number of things. Issue #28 has been created for checksum deltas.</li><li class="list-unordered">Fixed an issue where a backup could be resumed from an aborted backup that didn't have the same type and prior backup.</li></ul><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Added restore functionality.</li><li class="list-unordered">All options can now be set on the command-line making <span class="file">pg_backrest.conf</span> optional.</li><li class="list-unordered">De/compression is now performed without threads and checksum/size is calculated in stream. That means file checksums are no longer optional.</li><li class="list-unordered">Added option <span class="br-setting">--no-start-stop</span> to allow backups when Postgres is shut down. If <span class="file">postmaster.pid</span> is present then <span class="br-setting">--force</span> is required to make the backup run (though if Postgres is running an inconsistent backup will likely be created). This option was added primarily for the purpose of unit testing, but there may be applications in the real world as well.</li><li class="list-unordered">Checksum for <span class="file">backup.manifest</span> to detect a corrupted/modified manifest.</li><li class="list-unordered">Link <span class="path">latest</span> always points to the last backup. This has been added for convenience and to make restores simpler.</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Removed dependency on <span class="id">Moose</span>. It wasn't being used extensively and makes for longer startup times.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Test Suite Features:</b></div><ul class="list-unordered"><li class="list-unordered">More comprehensive unit tests in all areas.</li></ul></div></div><div class="section2"><a id="0.30"></a><div class="section2-header"><div class="section2-title">v0.30 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Core Restructuring and Unit Tests</div><div class="section2-subsubtitle">Released October 5, 2014</div><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Complete rewrite of <span class="id">BackRest::File</span> module to use a custom protocol for remote operations and Perl native GZIP and SHA operations. Compression is performed in threads rather than forked processes.</li><li class="list-unordered">Removed dependency on <span class="id">Storable</span> and replaced with a custom ini file implementation.</li><li class="list-unordered">Numerous other changes that can only be identified with a diff.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Features:</b></div><ul class="list-unordered"><li class="list-unordered">Added much needed documentation</li></ul><div class="section-body-text"><b>Test Suite Features:</b></div><ul class="list-unordered"><li class="list-unordered">Fairly comprehensive unit tests for all the basic operations. More work to be done here for sure, but then there is always more work to be done on unit tests.</li></ul></div></div><div class="section2"><a id="0.19"></a><div class="section2-header"><div class="section2-title">v0.19 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Improved Error Reporting/Handling</div><div class="section2-subsubtitle">Released May 13, 2014</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Found and squashed a nasty bug where <span class="id">file_copy()</span> was defaulted to ignore errors. There was also an issue in <span class="id">file_exists()</span> that was causing the test to fail when the file actually did exist. Together they could have resulted in a corrupt backup with no errors, though it is very unlikely.</li></ul><div class="section-body-text"><b> Development:</b></div><ul class="list-unordered"><li class="list-unordered">Worked on improving error handling in the <span class="id">File</span> object. This is not complete, but works well enough to find a few errors that have been causing us problems (notably, find is occasionally failing building the archive async manifest when system is under load).</li></ul></div></div><div class="section2"><a id="0.18"></a><div class="section2-header"><div class="section2-title">v0.18 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Return Soft Error When Archive Missing</div><div class="section2-subsubtitle">Released April 13, 2014</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">The <span class="cmd">archive-get</span> command now returns a 1 when the archive file is missing to differentiate from hard errors (ssh connection failure, file copy error, etc.) This lets <span class="postgres">PostgreSQL</span> know that that the archive stream has terminated normally. However, this does not take into account possible holes in the archive stream. (<i>Reported by Stephen Frost.</i>)</li></ul></div></div><div class="section2"><a id="0.17"></a><div class="section2-header"><div class="section2-title">v0.17 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Warn When Archive Directories Cannot Be Deleted</div><div class="section2-subsubtitle">Released April 3, 2014</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">If an archive directory which should be empty could not be deleted backrest was throwing an error. There's a good fix for that coming, but for the time being it has been changed to a warning so processing can continue. This was impacting backups as sometimes the final archive file would not get pushed if the first archive file had been in a different directory (plus some bad luck).</li></ul></div></div><div class="section2"><a id="0.16"></a><div class="section2-header"><div class="section2-title">v0.16 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">RequestTTY=yes for SSH Sessions</div><div class="section2-subsubtitle">Released April 1, 2014</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Added <span class="br-setting">RequestTTY=yes</span> to ssh sessions. Hoping this will prevent random lockups.</li></ul></div></div><div class="section2"><a id="0.15"></a><div class="section2-header"><div class="section2-title">v0.15 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Added archive-get</div><div class="section2-subsubtitle">Released March 29, 2014</div><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">Added <span class="cmd">archive-get</span> functionality to aid in restores.</li><li class="list-unordered">Added option to force a checkpoint when starting the backup, <span class="br-setting">start-fast=y</span>.</li></ul></div></div><div class="section2"><a id="0.11"></a><div class="section2-header"><div class="section2-title">v0.11 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Minor Fixes</div><div class="section2-subsubtitle">Released March 26, 2014</div><div class="section-body-text"><b> Bug Fixes:</b></div><ul class="list-unordered"><li class="list-unordered">Removed <span class="br-setting">master_stderr_discard</span> option on database SSH connections. There have been occasional lockups and they could be related to issues originally seen in the file code. (<i>Reported by Stephen Frost.</i>)</li><li class="list-unordered">Changed lock file conflicts on <span class="cmd">backup</span> and <span class="cmd">expire</span> commands to <span class="id">ERROR</span>. They were set to <span class="id">DEBUG</span> due to a copy-and-paste from the archive locks.</li></ul></div></div><div class="section2"><a id="0.10"></a><div class="section2-header"><div class="section2-title">v0.10 Release Notes</div></div><div class="section-body"><div class="section2-subtitle">Backup and Archiving are Functional</div><div class="section2-subsubtitle">Released March 5, 2014</div><div class="section-body-text"><b> Features:</b></div><ul class="list-unordered"><li class="list-unordered">No restore functionality, but the backup directories are consistent <span class="postgres">PostgreSQL</span> data directories. You'll need to either uncompress the files or turn off compression in the backup. Uncompressed backups on a ZFS (or similar) filesystem are a good option because backups can be restored locally via a snapshot to create logical backups or do spot data recovery.</li><li class="list-unordered">Archiving is single-threaded. This has not posed an issue on our multi-terabyte databases with heavy write volume. Recommend a large WAL volume or to use the async option with a large volume nearby.</li><li class="list-unordered">Backups are multi-threaded, but the <span class="id">Net::OpenSSH</span> library does not appear to be 100% thread-safe so it will very occasionally lock up on a thread. There is an overall process timeout that resolves this issue by killing the process. Yes, very ugly.</li><li class="list-unordered">Checksums are lost on any resumed backup. Only the final backup will record checksum on multiple resumes. Checksums from previous backups are correctly recorded and a full backup will reset everything.</li><li class="list-unordered">The <span class="file">backup.manifest</span> is being written as <span class="id">Storable</span> because <span class="id">Config::IniFile</span> does not seem to handle large files well. Would definitely like to save these as human-readable text.</li></ul><div class="section2-subtitle">Additional Notes</div><div class="section-body-text"><b>Documentation Features:</b></div><ul class="list-unordered"><li class="list-unordered">Absolutely no documentation (outside the code). Well, excepting these release notes.</li></ul></div></div></div></div></div><div class="page-footer">Copyright &copy; 2015-2019, The PostgreSQL Global Development Group, <a href="https://github.com/pgbackrest/pgbackrest/blob/master/LICENSE">MIT License</a>.  Updated April 11, 2019</div></body></html>