<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>pgBackRest v2.07 C Code Coverage - config/parse.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">pgBackRest v2.07 C Code Coverage</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">config</a> - parse.c<span style="font-size: 80%;"> (source / <a href="parse.c.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">all C unit</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">400</td>
            <td class="headerCovTableEntry">406</td>
            <td class="headerCovTableEntryHi">98.5 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2018-11-16 14:25:47</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">4</td>
            <td class="headerCovTableEntry">4</td>
            <td class="headerCovTableEntryHi">100.0 %</td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td class="headerItem">Branches:</td>
            <td class="headerCovTableEntry">265</td>
            <td class="headerCovTableEntry">266</td>
            <td class="headerCovTableEntryHi">99.6 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">           Branch data    Line data  Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>                :         : /***********************************************************************************************************************************</a>
<span class="lineNum">       2 </span>                :         : Command and Option Parse
<span class="lineNum">       3 </span>                :         : ***********************************************************************************************************************************/
<span class="lineNum">       4 </span>                :         : #include &lt;getopt.h&gt;
<span class="lineNum">       5 </span>                :         : #include &lt;string.h&gt;
<span class="lineNum">       6 </span>                :         : #include &lt;strings.h&gt;
<span class="lineNum">       7 </span>                :         : #include &lt;unistd.h&gt;
<span class="lineNum">       8 </span>                :         : 
<span class="lineNum">       9 </span>                :         : #include &quot;common/assert.h&quot;
<span class="lineNum">      10 </span>                :         : #include &quot;common/debug.h&quot;
<span class="lineNum">      11 </span>                :         : #include &quot;common/error.h&quot;
<span class="lineNum">      12 </span>                :         : #include &quot;common/ini.h&quot;
<span class="lineNum">      13 </span>                :         : #include &quot;common/log.h&quot;
<span class="lineNum">      14 </span>                :         : #include &quot;common/memContext.h&quot;
<span class="lineNum">      15 </span>                :         : #include &quot;common/regExp.h&quot;
<span class="lineNum">      16 </span>                :         : #include &quot;config/parse.h&quot;
<span class="lineNum">      17 </span>                :         : #include &quot;storage/helper.h&quot;
<span class="lineNum">      18 </span>                :         : #include &quot;version.h&quot;
<span class="lineNum">      19 </span>                :         : 
<span class="lineNum">      20 </span>                :         : /***********************************************************************************************************************************
<span class="lineNum">      21 </span>                :         : Standard config file name and old default path and name
<span class="lineNum">      22 </span>                :         : ***********************************************************************************************************************************/
<span class="lineNum">      23 </span>                :         : #define PGBACKREST_CONFIG_FILE                                      PGBACKREST_BIN &quot;.conf&quot;
<span class="lineNum">      24 </span>                :         : #define PGBACKREST_CONFIG_ORIG_PATH_FILE                            &quot;/etc/&quot; PGBACKREST_CONFIG_FILE
<span class="lineNum">      25 </span>                :         :     STRING_STATIC(PGBACKREST_CONFIG_ORIG_PATH_FILE_STR,             PGBACKREST_CONFIG_ORIG_PATH_FILE)
<span class="lineNum">      26 </span>                :         : 
<span class="lineNum">      27 </span>                :         : /***********************************************************************************************************************************
<span class="lineNum">      28 </span>                :         : Prefix for environment variables
<span class="lineNum">      29 </span>                :         : ***********************************************************************************************************************************/
<span class="lineNum">      30 </span>                :         : #define PGBACKREST_ENV                                              &quot;PGBACKREST_&quot;
<span class="lineNum">      31 </span>                :         : #define PGBACKREST_ENV_SIZE                                         (sizeof(PGBACKREST_ENV) - 1)
<span class="lineNum">      32 </span>                :         : 
<span class="lineNum">      33 </span>                :         : // In some environments this will not be extern'd
<span class="lineNum">      34 </span>                :         : extern char **environ;
<span class="lineNum">      35 </span>                :         : 
<span class="lineNum">      36 </span>                :         : /***********************************************************************************************************************************
<span class="lineNum">      37 </span>                :         : Standard config include path name
<span class="lineNum">      38 </span>                :         : ***********************************************************************************************************************************/
<span class="lineNum">      39 </span>                :         : #define PGBACKREST_CONFIG_INCLUDE_PATH                              &quot;conf.d&quot;
<span class="lineNum">      40 </span>                :         : 
<span class="lineNum">      41 </span>                :         : /***********************************************************************************************************************************
<span class="lineNum">      42 </span>                :         : Parse option flags
<span class="lineNum">      43 </span>                :         : ***********************************************************************************************************************************/
<span class="lineNum">      44 </span>                :         : // Offset the option values so they don't conflict with getopt_long return codes
<span class="lineNum">      45 </span>                :         : #define PARSE_OPTION_FLAG                                           (1 &lt;&lt; 30)
<span class="lineNum">      46 </span>                :         : 
<span class="lineNum">      47 </span>                :         : // Add a flag for negation rather than checking &quot;--no-&quot;
<span class="lineNum">      48 </span>                :         : #define PARSE_NEGATE_FLAG                                           (1 &lt;&lt; 29)
<span class="lineNum">      49 </span>                :         : 
<span class="lineNum">      50 </span>                :         : // Add a flag for reset rather than checking &quot;--reset-&quot;
<span class="lineNum">      51 </span>                :         : #define PARSE_RESET_FLAG                                            (1 &lt;&lt; 28)
<span class="lineNum">      52 </span>                :         : 
<span class="lineNum">      53 </span>                :         : // Indicate that option name has been deprecated and will be removed in a future release
<span class="lineNum">      54 </span>                :         : #define PARSE_DEPRECATE_FLAG                                        (1 &lt;&lt; 27)
<span class="lineNum">      55 </span>                :         : 
<span class="lineNum">      56 </span>                :         : // Mask to exclude all flags and get at the actual option id (only 12 bits allowed for option id, the rest reserved for flags)
<span class="lineNum">      57 </span>                :         : #define PARSE_OPTION_MASK                                           0xFFF
<span class="lineNum">      58 </span>                :         : 
<span class="lineNum">      59 </span>                :         : /***********************************************************************************************************************************
<span class="lineNum">      60 </span>                :         : Include automatically generated data structure for getopt_long()
<span class="lineNum">      61 </span>                :         : ***********************************************************************************************************************************/
<span class="lineNum">      62 </span>                :         : #include &quot;config/parse.auto.c&quot;
<span class="lineNum">      63 </span>                :         : 
<span class="lineNum">      64 </span>                :         : /***********************************************************************************************************************************
<span class="lineNum">      65 </span>                :         : Struct to hold options parsed from the command line
<span class="lineNum">      66 </span>                :         : ***********************************************************************************************************************************/
<span class="lineNum">      67 </span>                :         : typedef struct ParseOption
<span class="lineNum">      68 </span>                :         : {
<span class="lineNum">      69 </span>                :         :     bool found:1;                                                   // Was the option found on the command line?
<span class="lineNum">      70 </span>                :         :     bool negate:1;                                                  // Was the option negated on the command line?
<span class="lineNum">      71 </span>                :         :     bool reset:1;                                                   // Was the option reset on the command line?
<span class="lineNum">      72 </span>                :         :     unsigned int source:2;                                          // Where was to option found?
<span class="lineNum">      73 </span>                :         :     StringList *valueList;                                          // List of values found
<span class="lineNum">      74 </span>                :         : } ParseOption;
<span class="lineNum">      75 </span>                :         : 
<span class="lineNum">      76 </span>                :         : /***********************************************************************************************************************************
<span class="lineNum">      77 </span>                :         : Find an option by name in the option list
<a name="78"><span class="lineNum">      78 </span>                :         : ***********************************************************************************************************************************/</a>
<span class="lineNum">      79 </span>                :         : static unsigned int
<span class="lineNum">      80 </span>                :<span class="lineCov">     154 : optionFind(const String *option)</span>
<span class="lineNum">      81 </span>                :         : {
<span class="lineNum">      82 </span>                :<span class="lineCov">     154 :     unsigned int optionIdx = 0;</span>
<span class="lineNum">      83 </span>                :         : 
<span class="lineNum">      84 </span>        [<span class="branchCov" title="Branch 0 was taken 34773 times"> + </span><span class="branchCov" title="Branch 1 was taken 4 times"> + </span>]:<span class="lineCov">   34777 :     while (optionList[optionIdx].name != NULL)</span>
<span class="lineNum">      85 </span>                :         :     {
<span class="lineNum">      86 </span>        [<span class="branchCov" title="Branch 1 was taken 150 times"> + </span><span class="branchCov" title="Branch 2 was taken 34623 times"> + </span>]:<span class="lineCov">   34773 :         if (strcmp(strPtr(option), optionList[optionIdx].name) == 0)</span>
<span class="lineNum">      87 </span>                :<span class="lineCov">     150 :             break;</span>
<span class="lineNum">      88 </span>                :         : 
<span class="lineNum">      89 </span>                :<span class="lineCov">   34623 :         optionIdx++;</span>
<span class="lineNum">      90 </span>                :         :     }
<span class="lineNum">      91 </span>                :         : 
<span class="lineNum">      92 </span>                :<span class="lineCov">     154 :     return optionIdx;</span>
<span class="lineNum">      93 </span>                :         : }
<span class="lineNum">      94 </span>                :         : 
<span class="lineNum">      95 </span>                :         : /***********************************************************************************************************************************
<span class="lineNum">      96 </span>                :         : Convert the value passed into bytes and update valueDbl for range checking
<a name="97"><span class="lineNum">      97 </span>                :         : ***********************************************************************************************************************************/</a>
<span class="lineNum">      98 </span>                :         : void
<span class="lineNum">      99 </span>                :<span class="lineCov">      21 : convertToByte(String **value, double *valueDbl)</span>
<span class="lineNum">     100 </span>                :         : {
<span class="lineNum">     101 </span>                :<span class="lineCov">      21 :     FUNCTION_DEBUG_BEGIN(logLevelTrace);</span>
<span class="lineNum">     102 </span>                :<span class="lineCov">      21 :         FUNCTION_DEBUG_PARAM(STRINGP, value);</span>
<span class="lineNum">     103 </span>                :<span class="lineCov">      21 :         FUNCTION_DEBUG_PARAM(DOUBLEP, valueDbl);</span>
<span class="lineNum">     104 </span>                :         : 
<span class="lineNum">     105 </span>                :<span class="lineCov">      21 :         FUNCTION_DEBUG_ASSERT(valueDbl != NULL);</span>
<span class="lineNum">     106 </span>                :<span class="lineCov">      21 :     FUNCTION_DEBUG_END();</span>
<span class="lineNum">     107 </span>                :         : 
<span class="lineNum">     108 </span>                :         :     // Make a copy of the value so it is not updated until we know the conversion will succeed
<span class="lineNum">     109 </span>                :<span class="lineCov">      21 :     String *result = strLower(strDup(*value));</span>
<span class="lineNum">     110 </span>                :         : 
<span class="lineNum">     111 </span>                :         :     // Match the value against possible values
<span class="lineNum">     112 </span>                :<span class="lineCov">      21 :     if (regExpMatchOne(STRING_CONST(&quot;^[0-9]+(kb|k|mb|m|gb|g|tb|t|pb|p|b)*$&quot;), result))</span>
<span class="lineNum">     113 </span>                :         :     {
<span class="lineNum">     114 </span>                :         :         // Get the character array and size
<span class="lineNum">     115 </span>                :<span class="lineCov">      17 :         const char *strArray = strPtr(result);</span>
<span class="lineNum">     116 </span>                :<span class="lineCov">      17 :         size_t size = strSize(result);</span>
<span class="lineNum">     117 </span>                :<span class="lineCov">      17 :         int chrPos = -1;</span>
<span class="lineNum">     118 </span>                :         : 
<span class="lineNum">     119 </span>                :         :         // If there is a 'b' on the end, then see if the previous character is a number
<span class="lineNum">     120 </span>        [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchCov" title="Branch 1 was taken 10 times"> + </span>]:<span class="lineCov">      17 :         if (strArray[size - 1] == 'b')</span>
<span class="lineNum">     121 </span>                :         :         {
<span class="lineNum">     122 </span>                :         :             // If the previous character is a number, then the letter to look at is 'b' which is the last position else it is in the
<span class="lineNum">     123 </span>                :         :             // next to last position (e.g. kb - so the 'k' is the position of interest).  Only need to test for &lt;= 9 since the regex
<span class="lineNum">     124 </span>                :         :             // enforces the format.
<span class="lineNum">     125 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 6 times"> + </span>]:<span class="lineCov">       7 :             if (strArray[size - 2] &lt;= '9')</span>
<span class="lineNum">     126 </span>                :<span class="lineCov">       1 :                 chrPos = (int)(size - 1);</span>
<span class="lineNum">     127 </span>                :         :             else
<span class="lineNum">     128 </span>                :<span class="lineCov">       7 :                 chrPos = (int)(size - 2);</span>
<span class="lineNum">     129 </span>                :         :         }
<span class="lineNum">     130 </span>                :         :         // else if there is no 'b' at the end but the last position is not a number then it must be one of the letters, e.g. 'k'
<span class="lineNum">     131 </span>        [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchCov" title="Branch 1 was taken 4 times"> + </span>]:<span class="lineCov">      10 :         else if (strArray[size - 1] &gt; '9')</span>
<span class="lineNum">     132 </span>                :<span class="lineCov">       6 :             chrPos = (int)(size - 1);</span>
<span class="lineNum">     133 </span>                :         : 
<span class="lineNum">     134 </span>                :<span class="lineCov">      17 :         double multiplier = 1;</span>
<span class="lineNum">     135 </span>                :         : 
<span class="lineNum">     136 </span>                :         :         // If a letter was found, then truncate, else do nothing since assumed value is already in bytes
<span class="lineNum">     137 </span>        [<span class="branchCov" title="Branch 0 was taken 13 times"> + </span><span class="branchCov" title="Branch 1 was taken 4 times"> + </span>]:<span class="lineCov">      17 :         if (chrPos != -1)</span>
<span class="lineNum">     138 </span>                :         :         {
<span class="lineNum">     139 </span>        [<span class="branchCov" title="Branch 0 was taken 12 times"> + </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">      13 :             if (strArray[chrPos] != 'b')</span>
<span class="lineNum">     140 </span>                :         :             {
<span class="lineNum">     141 </span>                :<span class="lineCov">      12 :                 switch (strArray[chrPos])</span>
<span class="lineNum">     142 </span>                :         :                 {
<span class="lineNum">     143 </span>                :<span class="lineCov">       2 :                     case 'k':</span>
<span class="lineNum">     144 </span>                :<span class="lineCov">       2 :                         multiplier = 1024;</span>
<span class="lineNum">     145 </span>                :<span class="lineCov">       2 :                         break;</span>
<span class="lineNum">     146 </span>                :         : 
<span class="lineNum">     147 </span>                :<span class="lineCov">       3 :                     case 'm':</span>
<span class="lineNum">     148 </span>                :<span class="lineCov">       3 :                         multiplier = 1024 * 1024;</span>
<span class="lineNum">     149 </span>                :<span class="lineCov">       3 :                         break;</span>
<span class="lineNum">     150 </span>                :         : 
<span class="lineNum">     151 </span>                :<span class="lineCov">       2 :                     case 'g':</span>
<span class="lineNum">     152 </span>                :<span class="lineCov">       2 :                         multiplier = 1024 * 1024 * 1024;</span>
<span class="lineNum">     153 </span>                :<span class="lineCov">       2 :                         break;</span>
<span class="lineNum">     154 </span>                :         : 
<span class="lineNum">     155 </span>                :<span class="lineCov">       2 :                     case 't':</span>
<span class="lineNum">     156 </span>                :<span class="lineCov">       2 :                         multiplier = 1024LL * 1024LL * 1024LL * 1024LL;</span>
<span class="lineNum">     157 </span>                :<span class="lineCov">       2 :                         break;</span>
<span class="lineNum">     158 </span>                :         : 
<span class="lineNum">     159 </span>                :<span class="lineCov">       3 :                     case 'p':</span>
<span class="lineNum">     160 </span>                :<span class="lineCov">       3 :                         multiplier = 1024LL * 1024LL * 1024LL * 1024LL * 1024LL;</span>
<span class="lineNum">     161 </span>                :<span class="lineCov">       3 :                         break;</span>
<span class="lineNum">     162 </span>                :         : 
<span class="lineNum">     163 </span>                :<span class="lineNoCov">       0 :                     default:                                        // {uncoverable - regex covers all cases but default required}</span>
<span class="lineNum">     164 </span>                :<span class="lineNoCov">       0 :                         THROW_FMT(                                  // {+uncoverable}</span>
<span class="lineNum">     165 </span>                :         :                             AssertError, &quot;character %c is not a valid type&quot;, strArray[chrPos]);
<span class="lineNum">     166 </span>                :         :                 }
<span class="lineNum">     167 </span>                :<span class="lineCov">       1 :             }</span>
<span class="lineNum">     168 </span>                :         : 
<span class="lineNum">     169 </span>                :         :             // Remove any letters
<span class="lineNum">     170 </span>                :<span class="lineCov">      13 :             strTrunc(result, chrPos);</span>
<span class="lineNum">     171 </span>                :         :         }
<span class="lineNum">     172 </span>                :         : 
<span class="lineNum">     173 </span>                :         :         // Convert string to bytes
<span class="lineNum">     174 </span>                :<span class="lineCov">      17 :         double newDbl = varDblForce(varNewStr(result)) * multiplier;</span>
<span class="lineNum">     175 </span>                :<span class="lineCov">      17 :         result = varStrForce(varNewDbl(newDbl));</span>
<span class="lineNum">     176 </span>                :         : 
<span class="lineNum">     177 </span>                :         :         // If nothing has blown up then safe to overwrite the original values
<span class="lineNum">     178 </span>                :<span class="lineCov">      17 :         *valueDbl = newDbl;</span>
<span class="lineNum">     179 </span>                :<span class="lineCov">      17 :         *value = result;</span>
<span class="lineNum">     180 </span>                :         :     }
<span class="lineNum">     181 </span>                :         :     else
<span class="lineNum">     182 </span>                :<span class="lineCov">       4 :         THROW_FMT(FormatError, &quot;value '%s' is not valid&quot;, strPtr(*value));</span>
<span class="lineNum">     183 </span>                :         : 
<span class="lineNum">     184 </span>                :<span class="lineCov">      17 :     FUNCTION_DEBUG_RESULT_VOID();</span>
<span class="lineNum">     185 </span>                :<span class="lineCov">      17 : }</span>
<span class="lineNum">     186 </span>                :         : 
<span class="lineNum">     187 </span>                :         : /***********************************************************************************************************************************
<span class="lineNum">     188 </span>                :         : Load the configuration file(s)
<span class="lineNum">     189 </span>                :         : 
<span class="lineNum">     190 </span>                :         : The parent mem context is used. Defaults are passed to make testing easier.
<span class="lineNum">     191 </span>                :         : 
<span class="lineNum">     192 </span>                :         : Rules:
<span class="lineNum">     193 </span>                :         : - config and config-include-path are default. In this case, the config file will be loaded, if it exists, and *.conf files in the
<span class="lineNum">     194 </span>                :         :   config-include-path will be appended, if they exist. A missing/empty dir will be ignored except that the original default
<span class="lineNum">     195 </span>                :         :   for the config file will be attempted to be loaded if the current default is not found.
<span class="lineNum">     196 </span>                :         : - config only is specified. Only the specified config file will be loaded and is required. The default config-include-path will be
<span class="lineNum">     197 </span>                :         :   ignored.
<span class="lineNum">     198 </span>                :         : - config and config-path are specified. The specified config file will be loaded and is required. The overridden default of the
<span class="lineNum">     199 </span>                :         :   config-include-path (&lt;config-path&gt;/conf.d) will be loaded if exists but is not required.
<span class="lineNum">     200 </span>                :         : - config-include-path only is specified. *.conf files in the config-include-path will be loaded and the path is required to exist.
<span class="lineNum">     201 </span>                :         :   The default config will be be loaded if it exists.
<span class="lineNum">     202 </span>                :         : - config-include-path and config-path are specified. The *.conf files in the config-include-path will be loaded and the directory
<span class="lineNum">     203 </span>                :         :   passed must exist. The overridden default of the config file path (&lt;config-path&gt;/pgbackrest.conf) will be loaded if exists but is
<span class="lineNum">     204 </span>                :         :   not required.
<span class="lineNum">     205 </span>                :         : - If the config and config-include-path are specified. The config file will be loaded and is expected to exist and *.conf files in
<span class="lineNum">     206 </span>                :         :   the config-include-path will be appended and at least one is expected to exist.
<span class="lineNum">     207 </span>                :         : - If --no-config is specified and --config-include-path is specified then only *.conf files in the config-include-path will be
<span class="lineNum">     208 </span>                :         :   loaded; the directory is required.
<span class="lineNum">     209 </span>                :         : - If --no-config is specified and --config-path is specified then only *.conf files in the overriden default config-include-path
<span class="lineNum">     210 </span>                :         :   (&lt;config-path&gt;/conf.d) will be loaded if exist but not required.
<span class="lineNum">     211 </span>                :         : - If --no-config is specified and neither --config-include-path nor --config-path are specified then no configs will be loaded.
<span class="lineNum">     212 </span>                :         : - If --config-path only, the defaults for config and config-include-path will be changed to use that as a base path but the files
<span class="lineNum">     213 </span>                :         :   will not be required to exist since this is a default override.
<a name="214"><span class="lineNum">     214 </span>                :         : ***********************************************************************************************************************************/</a>
<span class="lineNum">     215 </span>                :         : static String *
<span class="lineNum">     216 </span>                :<span class="lineCov">      54 : cfgFileLoad(                                                        // NOTE: Passing defaults to enable more complete test coverage</span>
<span class="lineNum">     217 </span>                :         :     const ParseOption *optionList,                                  // All options and their current settings
<span class="lineNum">     218 </span>                :         :     const String *optConfigDefault,                                 // Current default for --config option
<span class="lineNum">     219 </span>                :         :     const String *optConfigIncludePathDefault,                      // Current default for --config-include-path option
<span class="lineNum">     220 </span>                :         :     const String *origConfigDefault)                                // Original --config option default (/etc/pgbackrest.conf)
<span class="lineNum">     221 </span>                :         : {
<span class="lineNum">     222 </span>                :<span class="lineCov">      54 :     FUNCTION_DEBUG_BEGIN(logLevelTrace);</span>
<span class="lineNum">     223 </span>                :<span class="lineCov">      54 :         FUNCTION_DEBUG_PARAM_PTR(&quot;ParseOption *&quot;, optionList);</span>
<span class="lineNum">     224 </span>                :<span class="lineCov">      54 :         FUNCTION_DEBUG_PARAM(STRING, optConfigDefault);</span>
<span class="lineNum">     225 </span>                :<span class="lineCov">      54 :         FUNCTION_DEBUG_PARAM(STRING, optConfigIncludePathDefault);</span>
<span class="lineNum">     226 </span>                :<span class="lineCov">      54 :         FUNCTION_DEBUG_PARAM(STRING, origConfigDefault);</span>
<span class="lineNum">     227 </span>                :         : 
<span class="lineNum">     228 </span>                :<span class="lineCov">      54 :         FUNCTION_TEST_ASSERT(optionList != NULL);</span>
<span class="lineNum">     229 </span>                :<span class="lineCov">      54 :         FUNCTION_TEST_ASSERT(optConfigDefault != NULL);</span>
<span class="lineNum">     230 </span>                :<span class="lineCov">      54 :         FUNCTION_TEST_ASSERT(optConfigIncludePathDefault != NULL);</span>
<span class="lineNum">     231 </span>                :<span class="lineCov">      54 :         FUNCTION_TEST_ASSERT(origConfigDefault != NULL);</span>
<span class="lineNum">     232 </span>                :<span class="lineCov">      54 :     FUNCTION_DEBUG_END();</span>
<span class="lineNum">     233 </span>                :         : 
<span class="lineNum">     234 </span>                :<span class="lineCov">      54 :     bool loadConfig = true;</span>
<span class="lineNum">     235 </span>                :<span class="lineCov">      54 :     bool loadConfigInclude = true;</span>
<span class="lineNum">     236 </span>                :         : 
<span class="lineNum">     237 </span>                :         :     // If the option is specified on the command line, then found will be true meaning the file is required to exist,
<span class="lineNum">     238 </span>                :         :     // else it is optional
<span class="lineNum">     239 </span>                :<span class="lineCov">      54 :     bool configRequired = optionList[cfgOptConfig].found;</span>
<span class="lineNum">     240 </span>                :<span class="lineCov">      54 :     bool configIncludeRequired = optionList[cfgOptConfigIncludePath].found;</span>
<span class="lineNum">     241 </span>                :         : 
<span class="lineNum">     242 </span>                :         :     // Save default for later determining if must check old original default config path
<span class="lineNum">     243 </span>                :<span class="lineCov">      54 :     const String *optConfigDefaultCurrent = optConfigDefault;</span>
<span class="lineNum">     244 </span>                :         : 
<span class="lineNum">     245 </span>                :         :     // If the config-path option is found on the command line, then its value will override the base path defaults for config and
<span class="lineNum">     246 </span>                :         :     // config-include-path
<span class="lineNum">     247 </span>        [<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchCov" title="Branch 1 was taken 50 times"> + </span>]:<span class="lineCov">      54 :     if (optionList[cfgOptConfigPath].found)</span>
<span class="lineNum">     248 </span>                :         :     {
<span class="lineNum">     249 </span>                :<span class="lineCov">       4 :         optConfigDefault =</span>
<span class="lineNum">     250 </span>                :<span class="lineCov">       4 :             strNewFmt(&quot;%s/%s&quot;, strPtr(strLstGet(optionList[cfgOptConfigPath].valueList, 0)), strPtr(strBase(optConfigDefault)));</span>
<span class="lineNum">     251 </span>                :<span class="lineCov">       4 :         optConfigIncludePathDefault =</span>
<span class="lineNum">     252 </span>                :<span class="lineCov">       4 :             strNewFmt(&quot;%s/%s&quot;, strPtr(strLstGet(optionList[cfgOptConfigPath].valueList, 0)), PGBACKREST_CONFIG_INCLUDE_PATH);</span>
<span class="lineNum">     253 </span>                :         :     }
<span class="lineNum">     254 </span>                :         : 
<span class="lineNum">     255 </span>                :         :     // If the --no-config option was passed then do not load the config file
<span class="lineNum">     256 </span>        [<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchCov" title="Branch 1 was taken 50 times"> + </span>]:<span class="lineCov">      54 :     if (optionList[cfgOptConfig].negate)</span>
<span class="lineNum">     257 </span>                :         :     {
<span class="lineNum">     258 </span>                :<span class="lineCov">       4 :         loadConfig = false;</span>
<span class="lineNum">     259 </span>                :<span class="lineCov">       4 :         configRequired = false;</span>
<span class="lineNum">     260 </span>                :         :     }
<span class="lineNum">     261 </span>                :         : 
<span class="lineNum">     262 </span>                :         :     // If --config option is specified on the command line but neither the --config-include-path nor the config-path are passed,
<span class="lineNum">     263 </span>                :         :     // then do not attempt to load the include files
<span class="lineNum">     264 </span>[<span class="branchCov" title="Branch 0 was taken 20 times"> + </span><span class="branchCov" title="Branch 1 was taken 34 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 15 times"> + </span><span class="branchCov" title="Branch 3 was taken 5 times"> + </span>]:<span class="lineCov">      54 :     if (optionList[cfgOptConfig].found &amp;&amp; !(optionList[cfgOptConfigIncludePath].found || optionList[cfgOptConfigPath].found))</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 4 was taken 13 times"> + </span><span class="branchCov" title="Branch 5 was taken 2 times"> + </span>]
<span class="lineNum">     265 </span>                :         :     {
<span class="lineNum">     266 </span>                :<span class="lineCov">      13 :         loadConfigInclude = false;</span>
<span class="lineNum">     267 </span>                :<span class="lineCov">      13 :         configIncludeRequired = false;</span>
<span class="lineNum">     268 </span>                :         :     }
<span class="lineNum">     269 </span>                :         : 
<span class="lineNum">     270 </span>                :<span class="lineCov">      54 :     String *result = NULL;</span>
<span class="lineNum">     271 </span>                :         : 
<span class="lineNum">     272 </span>                :         :     // Load the main config file
<span class="lineNum">     273 </span>        [<span class="branchCov" title="Branch 0 was taken 50 times"> + </span><span class="branchCov" title="Branch 1 was taken 4 times"> + </span>]:<span class="lineCov">      54 :     if (loadConfig)</span>
<span class="lineNum">     274 </span>                :         :     {
<span class="lineNum">     275 </span>                :<span class="lineCov">      50 :         const String *configFileName = NULL;</span>
<span class="lineNum">     276 </span>                :         : 
<span class="lineNum">     277 </span>                :         :         // Get the config file name from the command-line if it exists else default
<span class="lineNum">     278 </span>        [<span class="branchCov" title="Branch 0 was taken 16 times"> + </span><span class="branchCov" title="Branch 1 was taken 34 times"> + </span>]:<span class="lineCov">      50 :         if (optionList[cfgOptConfig].found)</span>
<span class="lineNum">     279 </span>                :<span class="lineCov">      16 :             configFileName = strLstGet(optionList[cfgOptConfig].valueList, 0);</span>
<span class="lineNum">     280 </span>                :         :         else
<span class="lineNum">     281 </span>                :<span class="lineCov">      34 :             configFileName = optConfigDefault;</span>
<span class="lineNum">     282 </span>                :         : 
<span class="lineNum">     283 </span>                :         :         // Load the config file
<span class="lineNum">     284 </span>                :<span class="lineCov">      50 :         Buffer *buffer = storageGetNP(storageNewReadP(storageLocal(), configFileName, .ignoreMissing = !configRequired));</span>
<span class="lineNum">     285 </span>                :         : 
<span class="lineNum">     286 </span>                :         :         // Convert the contents of the file buffer to the config string object
<span class="lineNum">     287 </span>        [<span class="branchCov" title="Branch 0 was taken 19 times"> + </span><span class="branchCov" title="Branch 1 was taken 30 times"> + </span>]:<span class="lineCov">      49 :         if (buffer != NULL)</span>
<span class="lineNum">     288 </span>                :<span class="lineCov">      19 :             result = strNewBuf(buffer);</span>
<span class="lineNum">     289 </span>        [<span class="branchCov" title="Branch 1 was taken 29 times"> + </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span>]:<span class="lineCov">      30 :         else if (strEq(configFileName, optConfigDefaultCurrent))</span>
<span class="lineNum">     290 </span>                :         :         {
<span class="lineNum">     291 </span>                :         :             // If confg is current default and it was not found, attempt to load the config file from the old default location
<span class="lineNum">     292 </span>                :<span class="lineCov">      29 :             buffer = storageGetNP(storageNewReadP(storageLocal(), origConfigDefault, .ignoreMissing = !configRequired));</span>
<span class="lineNum">     293 </span>                :         : 
<span class="lineNum">     294 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 27 times"> + </span>]:<span class="lineCov">      29 :             if (buffer != NULL)</span>
<span class="lineNum">     295 </span>                :<span class="lineCov">       2 :                 result = strNewBuf(buffer);</span>
<span class="lineNum">     296 </span>                :         :         }
<span class="lineNum">     297 </span>                :         :     }
<span class="lineNum">     298 </span>                :         : 
<span class="lineNum">     299 </span>                :         :     // Load *.conf files from the include directory
<span class="lineNum">     300 </span>        [<span class="branchCov" title="Branch 0 was taken 40 times"> + </span><span class="branchCov" title="Branch 1 was taken 13 times"> + </span>]:<span class="lineCov">      53 :     if (loadConfigInclude)</span>
<span class="lineNum">     301 </span>                :         :     {
<span class="lineNum">     302 </span>        [<span class="branchCov" title="Branch 0 was taken 11 times"> + </span><span class="branchCov" title="Branch 1 was taken 29 times"> + </span>]:<span class="lineCov">      40 :         if (result != NULL)</span>
<span class="lineNum">     303 </span>                :         :         {
<span class="lineNum">     304 </span>                :         :             // Validate the file by parsing it as an Ini object. If the file is not properly formed, en error will occur.
<span class="lineNum">     305 </span>                :<span class="lineCov">      11 :             Ini *ini = iniNew();</span>
<span class="lineNum">     306 </span>                :<span class="lineCov">      11 :             iniParse(ini, result);</span>
<span class="lineNum">     307 </span>                :         :         }
<span class="lineNum">     308 </span>                :         : 
<span class="lineNum">     309 </span>                :<span class="lineCov">      40 :         const String *configIncludePath = NULL;</span>
<span class="lineNum">     310 </span>                :         : 
<span class="lineNum">     311 </span>                :         :         // Get the config include path from the command-line if it exists else default
<span class="lineNum">     312 </span>        [<span class="branchCov" title="Branch 0 was taken 9 times"> + </span><span class="branchCov" title="Branch 1 was taken 31 times"> + </span>]:<span class="lineCov">      40 :         if (optionList[cfgOptConfigIncludePath].found)</span>
<span class="lineNum">     313 </span>                :<span class="lineCov">       9 :             configIncludePath = strLstGet(optionList[cfgOptConfigIncludePath].valueList, 0);</span>
<span class="lineNum">     314 </span>                :         :         else
<span class="lineNum">     315 </span>                :<span class="lineCov">      31 :             configIncludePath = optConfigIncludePathDefault;</span>
<span class="lineNum">     316 </span>                :         : 
<span class="lineNum">     317 </span>                :         :         // Get a list of conf files from the specified path -error on missing directory if the option was passed on the command line
<span class="lineNum">     318 </span>                :<span class="lineCov">      40 :         StringList *list = storageListP(</span>
<span class="lineNum">     319 </span>                :         :             storageLocal(), configIncludePath, .expression = STRING_CONST(&quot;.+\\.conf$&quot;), .errorOnMissing = configIncludeRequired);
<span class="lineNum">     320 </span>                :         : 
<span class="lineNum">     321 </span>                :         :         // If conf files are found, then add them to the config string
<span class="lineNum">     322 </span>[<span class="branchCov" title="Branch 0 was taken 13 times"> + </span><span class="branchCov" title="Branch 1 was taken 26 times"> + </span>][<span class="branchCov" title="Branch 3 was taken 12 times"> + </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span>]:<span class="lineCov">      39 :         if (list != NULL &amp;&amp; strLstSize(list) &gt; 0)</span>
<span class="lineNum">     323 </span>                :         :         {
<span class="lineNum">     324 </span>                :         :             // Sort the list for reproducibility only -- order does not matter
<span class="lineNum">     325 </span>                :<span class="lineCov">      12 :             strLstSort(list, sortOrderAsc);</span>
<span class="lineNum">     326 </span>                :         : 
<span class="lineNum">     327 </span>        [<span class="branchCov" title="Branch 1 was taken 14 times"> + </span><span class="branchCov" title="Branch 2 was taken 12 times"> + </span>]:<span class="lineCov">      26 :             for (unsigned int listIdx = 0; listIdx &lt; strLstSize(list); listIdx++)</span>
<span class="lineNum">     328 </span>                :         :             {
<span class="lineNum">     329 </span>                :<span class="lineCov">      14 :                 Buffer *fileBuffer = storageGetNP(</span>
<span class="lineNum">     330 </span>                :         :                     storageNewReadP(
<span class="lineNum">     331 </span>                :         :                         storageLocal(), strNewFmt(&quot;%s/%s&quot;, strPtr(configIncludePath), strPtr(strLstGet(list, listIdx))),
<span class="lineNum">     332 </span>                :         :                         .ignoreMissing = true));
<span class="lineNum">     333 </span>                :         : 
<span class="lineNum">     334 </span>        [<span class="branchCov" title="Branch 0 was taken 14 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">      14 :                 if (fileBuffer != NULL) // {uncovered - NULL can only occur if file is missing after file list is retrieved}</span>
<span class="lineNum">     335 </span>                :         :                 {
<span class="lineNum">     336 </span>                :         :                     // Convert the contents of the file buffer to a string object
<span class="lineNum">     337 </span>                :<span class="lineCov">      14 :                     String *configPart = strNewBuf(fileBuffer);</span>
<span class="lineNum">     338 </span>                :         : 
<span class="lineNum">     339 </span>                :         :                     // Validate the file by parsing it as an Ini object. If the file is not properly formed, an error will occur.
<span class="lineNum">     340 </span>        [<span class="branchCov" title="Branch 1 was taken 13 times"> + </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span>]:<span class="lineCov">      14 :                     if (strSize(configPart) &gt; 0)</span>
<span class="lineNum">     341 </span>                :         :                     {
<span class="lineNum">     342 </span>                :<span class="lineCov">      13 :                         Ini *configPartIni = iniNew();</span>
<span class="lineNum">     343 </span>                :<span class="lineCov">      13 :                         iniParse(configPartIni, configPart);</span>
<span class="lineNum">     344 </span>                :         : 
<span class="lineNum">     345 </span>                :         :                         // Create the result config file
<span class="lineNum">     346 </span>        [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchCov" title="Branch 1 was taken 10 times"> + </span>]:<span class="lineCov">      13 :                         if (result == NULL)</span>
<span class="lineNum">     347 </span>                :<span class="lineCov">       3 :                             result = strNew(&quot;&quot;);</span>
<span class="lineNum">     348 </span>                :         :                         // Else add an LF in case the previous file did not end with one
<span class="lineNum">     349 </span>                :         :                         else
<span class="lineNum">     350 </span>                :<span class="lineCov">      10 :                             strCat(result, &quot;\n&quot;);</span>
<span class="lineNum">     351 </span>                :         : 
<span class="lineNum">     352 </span>                :         :                         // Add the config part to the result config file
<span class="lineNum">     353 </span>                :<span class="lineCov">      13 :                         strCat(result, strPtr(configPart));</span>
<span class="lineNum">     354 </span>                :         :                     }
<span class="lineNum">     355 </span>                :         :                 }
<span class="lineNum">     356 </span>                :         :             }
<span class="lineNum">     357 </span>                :         :         }
<span class="lineNum">     358 </span>                :         :     }
<span class="lineNum">     359 </span>                :         : 
<span class="lineNum">     360 </span>                :<span class="lineCov">      52 :     FUNCTION_DEBUG_RESULT(STRING, result);</span>
<span class="lineNum">     361 </span>                :         : }
<span class="lineNum">     362 </span>                :         : 
<span class="lineNum">     363 </span>                :         : /***********************************************************************************************************************************
<span class="lineNum">     364 </span>                :         : Parse the command-line arguments and config file to produce final config data
<span class="lineNum">     365 </span>                :         : 
<span class="lineNum">     366 </span>                :         : ??? Add validation of section names and check all sections for invalid options in the check command.  It's too expensive to add the
<span class="lineNum">     367 </span>                :         : logic to this critical path code.
<a name="368"><span class="lineNum">     368 </span>                :         : ***********************************************************************************************************************************/</a>
<span class="lineNum">     369 </span>                :         : void
<span class="lineNum">     370 </span>                :<span class="lineCov">     100 : configParse(unsigned int argListSize, const char *argList[], bool resetLogLevel)</span>
<span class="lineNum">     371 </span>                :         : {
<span class="lineNum">     372 </span>                :<span class="lineCov">      54 :     FUNCTION_DEBUG_BEGIN(logLevelTrace);</span>
<span class="lineNum">     373 </span>                :<span class="lineCov">      54 :         FUNCTION_DEBUG_PARAM(UINT, argListSize);</span>
<span class="lineNum">     374 </span>                :<span class="lineCov">      54 :         FUNCTION_DEBUG_PARAM(CHARPY, argList);</span>
<span class="lineNum">     375 </span>                :<span class="lineCov">      54 :     FUNCTION_DEBUG_END();</span>
<span class="lineNum">     376 </span>                :         : 
<span class="lineNum">     377 </span>                :         :     // Initialize configuration
<span class="lineNum">     378 </span>                :<span class="lineCov">      54 :     cfgInit();</span>
<span class="lineNum">     379 </span>                :         : 
<span class="lineNum">     380 </span>                :<span class="lineCov">     292 :     MEM_CONTEXT_TEMP_BEGIN()</span>
<span class="lineNum">     381 </span>                :         :     {
<span class="lineNum">     382 </span>                :         :         // Set the exe
<span class="lineNum">     383 </span>                :<span class="lineCov">      54 :         cfgExeSet(strNew(argList[0]));</span>
<span class="lineNum">     384 </span>                :         : 
<span class="lineNum">     385 </span>                :         :         // Phase 1: parse command line parameters
<span class="lineNum">     386 </span>                :         :         // -------------------------------------------------------------------------------------------------------------------------
<span class="lineNum">     387 </span>                :         :         int option;                                                     // Code returned by getopt_long
<span class="lineNum">     388 </span>                :         :         int optionListIdx;                                              // Index of option is list (if an option was returned)
<span class="lineNum">     389 </span>                :<span class="lineCov">      54 :         bool argFound = false;                                          // Track args found to decide on error or help at the end</span>
<span class="lineNum">     390 </span>                :<span class="lineCov">      54 :         StringList *commandParamList = NULL;                            // List of command  parameters</span>
<span class="lineNum">     391 </span>                :         : 
<span class="lineNum">     392 </span>                :         :         // Reset optind to 1 in case getopt_long has been called before
<span class="lineNum">     393 </span>                :<span class="lineCov">      54 :         optind = 1;</span>
<span class="lineNum">     394 </span>                :         : 
<span class="lineNum">     395 </span>                :         :         // Don't error automatically on unknown options - they will be processed in the loop below
<span class="lineNum">     396 </span>                :<span class="lineCov">      54 :         opterr = false;</span>
<span class="lineNum">     397 </span>                :         : 
<span class="lineNum">     398 </span>                :         :         // List of parsed options
<span class="lineNum">     399 </span>                :         :         ParseOption parseOptionList[CFG_OPTION_TOTAL];
<span class="lineNum">     400 </span>                :<span class="lineCov">      54 :         memset(&amp;parseOptionList, 0, sizeof(parseOptionList));</span>
<span class="lineNum">     401 </span>                :         : 
<span class="lineNum">     402 </span>                :         :         // Only the first non-option parameter should be treated as a command so track if the command has been set
<span class="lineNum">     403 </span>                :<span class="lineCov">      54 :         bool commandSet = false;</span>
<span class="lineNum">     404 </span>                :         : 
<span class="lineNum">     405 </span>        [<span class="branchCov" title="Branch 1 was taken 178 times"> + </span><span class="branchCov" title="Branch 2 was taken 42 times"> + </span>]:<span class="lineCov">     220 :         while ((option = getopt_long((int)argListSize, (char **)argList, &quot;-:&quot;, optionList, &amp;optionListIdx)) != -1)</span>
<span class="lineNum">     406 </span>                :         :         {
<span class="lineNum">     407 </span>                :<span class="lineCov">     178 :             switch (option)</span>
<span class="lineNum">     408 </span>                :         :             {
<span class="lineNum">     409 </span>                :         :                 // Parse arguments that are not options, i.e. commands and parameters passed to commands
<span class="lineNum">     410 </span>                :<span class="lineCov">      46 :                 case 1:</span>
<span class="lineNum">     411 </span>                :         :                 {
<span class="lineNum">     412 </span>                :         :                     // The first argument should be the command
<span class="lineNum">     413 </span>        [<span class="branchCov" title="Branch 0 was taken 44 times"> + </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>]:<span class="lineCov">      46 :                     if (!commandSet)</span>
<span class="lineNum">     414 </span>                :         :                     {
<span class="lineNum">     415 </span>                :         :                         // Try getting the command from the valid command list
<span class="lineNum">     416 </span>                :<span class="lineCov">     133 :                         TRY_BEGIN()</span>
<span class="lineNum">     417 </span>                :         :                         {
<span class="lineNum">     418 </span>                :<span class="lineCov">      44 :                             cfgCommandSet(cfgCommandId(argList[optind - 1]));</span>
<span class="lineNum">     419 </span>                :         :                         }
<span class="lineNum">     420 </span>                :         :                         // Assert error means the command does not exist, which is correct for all usages but this one (since we
<span class="lineNum">     421 </span>                :         :                         // don't have any control over what the user passes), so modify the error code and message.
<span class="lineNum">     422 </span>                :<span class="lineCov">      45 :                         CATCH(AssertError)</span>
<span class="lineNum">     423 </span>                :         :                         {
<span class="lineNum">     424 </span>                :<span class="lineCov">       1 :                             THROW_FMT(CommandInvalidError, &quot;invalid command '%s'&quot;, argList[optind - 1]);</span>
<span class="lineNum">     425 </span>                :         :                         }
<span class="lineNum">     426 </span>                :         :                         TRY_END();
<span class="lineNum">     427 </span>                :         : 
<span class="lineNum">     428 </span>        [<span class="branchCov" title="Branch 1 was taken 3 times"> + </span><span class="branchCov" title="Branch 2 was taken 40 times"> + </span>]:<span class="lineCov">      43 :                         if (cfgCommand() == cfgCmdHelp)</span>
<span class="lineNum">     429 </span>                :<span class="lineCov">       3 :                             cfgCommandHelpSet(true);</span>
<span class="lineNum">     430 </span>                :         :                         else
<span class="lineNum">     431 </span>                :<span class="lineCov">      43 :                             commandSet = true;</span>
<span class="lineNum">     432 </span>                :         :                     }
<span class="lineNum">     433 </span>                :         :                     // Additional arguments are command arguments
<span class="lineNum">     434 </span>                :         :                     else
<span class="lineNum">     435 </span>                :         :                     {
<span class="lineNum">     436 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">       2 :                         if (commandParamList == NULL)</span>
<span class="lineNum">     437 </span>                :<span class="lineCov">       1 :                             commandParamList = strLstNew();</span>
<span class="lineNum">     438 </span>                :         : 
<span class="lineNum">     439 </span>                :<span class="lineCov">       2 :                         strLstAdd(commandParamList, strNew(argList[optind - 1]));</span>
<span class="lineNum">     440 </span>                :         :                     }
<span class="lineNum">     441 </span>                :         : 
<span class="lineNum">     442 </span>                :<span class="lineCov">      45 :                     break;</span>
<span class="lineNum">     443 </span>                :         :                 }
<span class="lineNum">     444 </span>                :         : 
<span class="lineNum">     445 </span>                :         :                 // If the option is unknown then error
<span class="lineNum">     446 </span>                :<span class="lineCov">       1 :                 case '?':</span>
<span class="lineNum">     447 </span>                :<span class="lineCov">       1 :                     THROW_FMT(OptionInvalidError, &quot;invalid option '%s'&quot;, argList[optind - 1]);</span>
<span class="lineNum">     448 </span>                :         : 
<span class="lineNum">     449 </span>                :         :                 // If the option is missing an argument then error
<span class="lineNum">     450 </span>                :<span class="lineCov">       1 :                 case ':':</span>
<span class="lineNum">     451 </span>                :<span class="lineCov">       1 :                     THROW_FMT(OptionInvalidError, &quot;option '%s' requires argument&quot;, argList[optind - 1]);</span>
<span class="lineNum">     452 </span>                :         : 
<span class="lineNum">     453 </span>                :         :                 // Parse valid option
<span class="lineNum">     454 </span>                :<span class="lineCov">     130 :                 default:</span>
<span class="lineNum">     455 </span>                :         :                 {
<span class="lineNum">     456 </span>                :         :                     // Get option id and flags from the option code
<span class="lineNum">     457 </span>                :<span class="lineCov">     130 :                     ConfigOption optionId = option &amp; PARSE_OPTION_MASK;</span>
<span class="lineNum">     458 </span>                :<span class="lineCov">     130 :                     bool negate = option &amp; PARSE_NEGATE_FLAG;</span>
<span class="lineNum">     459 </span>                :<span class="lineCov">     130 :                     bool reset = option &amp; PARSE_RESET_FLAG;</span>
<span class="lineNum">     460 </span>                :         : 
<span class="lineNum">     461 </span>                :         :                     // Make sure the option id is valid
<span class="lineNum">     462 </span>                :<span class="lineCov">     130 :                     ASSERT_DEBUG(optionId &lt; CFG_OPTION_TOTAL);</span>
<span class="lineNum">     463 </span>                :         : 
<span class="lineNum">     464 </span>                :         :                     // Error if this option is secure and cannot be passed on the command line
<span class="lineNum">     465 </span>        [<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchCov" title="Branch 3 was taken 129 times"> + </span>]:<span class="lineCov">     130 :                     if (cfgDefOptionSecure(cfgOptionDefIdFromId(optionId)))</span>
<span class="lineNum">     466 </span>                :         :                     {
<span class="lineNum">     467 </span>                :<span class="lineCov">       1 :                         THROW_FMT(</span>
<span class="lineNum">     468 </span>                :         :                             OptionInvalidError,
<span class="lineNum">     469 </span>                :         :                             &quot;option '%s' is not allowed on the command-line\n&quot;
<span class="lineNum">     470 </span>                :         :                             &quot;HINT: this option could expose secrets in the process list.\n&quot;
<span class="lineNum">     471 </span>                :         :                             &quot;HINT: specify the option in a configuration file or an environment variable instead.&quot;,
<span class="lineNum">     472 </span>                :         :                             cfgOptionName(optionId));
<span class="lineNum">     473 </span>                :         :                     }
<span class="lineNum">     474 </span>                :         : 
<span class="lineNum">     475 </span>                :         :                     // If the the option has not been found yet then set it
<span class="lineNum">     476 </span>        [<span class="branchCov" title="Branch 0 was taken 119 times"> + </span><span class="branchCov" title="Branch 1 was taken 10 times"> + </span>]:<span class="lineCov">     129 :                     if (!parseOptionList[optionId].found)</span>
<span class="lineNum">     477 </span>                :         :                     {
<span class="lineNum">     478 </span>                :<span class="lineCov">     119 :                         parseOptionList[optionId].found = true;</span>
<span class="lineNum">     479 </span>                :<span class="lineCov">     119 :                         parseOptionList[optionId].negate = negate;</span>
<span class="lineNum">     480 </span>                :<span class="lineCov">     119 :                         parseOptionList[optionId].reset = reset;</span>
<span class="lineNum">     481 </span>                :<span class="lineCov">     119 :                         parseOptionList[optionId].source = cfgSourceParam;</span>
<span class="lineNum">     482 </span>                :         : 
<span class="lineNum">     483 </span>                :         :                         // Only set the argument if the option requires one
<span class="lineNum">     484 </span>        [<span class="branchCov" title="Branch 0 was taken 100 times"> + </span><span class="branchCov" title="Branch 1 was taken 19 times"> + </span>]:<span class="lineCov">     119 :                         if (optionList[optionListIdx].has_arg == required_argument)</span>
<span class="lineNum">     485 </span>                :<span class="lineCov">     119 :                             parseOptionList[optionId].valueList = strLstAdd(strLstNew(), strNew(optarg));</span>
<span class="lineNum">     486 </span>                :         :                     }
<span class="lineNum">     487 </span>                :         :                     else
<span class="lineNum">     488 </span>                :         :                     {
<span class="lineNum">     489 </span>                :         :                         // Make sure option is not negated more than once.  It probably wouldn't hurt anything to accept this case
<span class="lineNum">     490 </span>                :         :                         // but there's no point in allowing the user to be sloppy.
<span class="lineNum">     491 </span>[<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchCov" title="Branch 1 was taken 7 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchCov" title="Branch 3 was taken 2 times"> + </span>]:<span class="lineCov">      10 :                         if (parseOptionList[optionId].negate &amp;&amp; negate)</span>
<span class="lineNum">     492 </span>                :<span class="lineCov">       1 :                             THROW_FMT(OptionInvalidError, &quot;option '%s' is negated multiple times&quot;, cfgOptionName(optionId));</span>
<span class="lineNum">     493 </span>                :         : 
<span class="lineNum">     494 </span>                :         :                         // Make sure option is not reset more than once.  Same justification as negate.
<span class="lineNum">     495 </span>[<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchCov" title="Branch 1 was taken 6 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchCov" title="Branch 3 was taken 2 times"> + </span>]:<span class="lineCov">       9 :                         if (parseOptionList[optionId].reset &amp;&amp; reset)</span>
<span class="lineNum">     496 </span>                :<span class="lineCov">       1 :                             THROW_FMT(OptionInvalidError, &quot;option '%s' is reset multiple times&quot;, cfgOptionName(optionId));</span>
<span class="lineNum">     497 </span>                :         : 
<span class="lineNum">     498 </span>                :         :                         // Don't allow an option to be both negated and reset
<span class="lineNum">     499 </span>[<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 6 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchCov" title="Branch 3 was taken 1 time"> + </span>]:<span class="lineCov">       8 :                         if ((parseOptionList[optionId].reset &amp;&amp; negate) || (parseOptionList[optionId].negate &amp;&amp; reset))</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 4 was taken 2 times"> + </span><span class="branchCov" title="Branch 5 was taken 5 times"> + </span>][<span class="branchCov" title="Branch 6 was taken 1 time"> + </span><span class="branchCov" title="Branch 7 was taken 1 time"> + </span>]
<span class="lineNum">     500 </span>                :<span class="lineCov">       2 :                             THROW_FMT(OptionInvalidError, &quot;option '%s' cannot be negated and reset&quot;, cfgOptionName(optionId));</span>
<span class="lineNum">     501 </span>                :         : 
<span class="lineNum">     502 </span>                :         :                         // Don't allow an option to be both set and negated
<span class="lineNum">     503 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 5 times"> + </span>]:<span class="lineCov">       6 :                         if (parseOptionList[optionId].negate != negate)</span>
<span class="lineNum">     504 </span>                :<span class="lineCov">       1 :                             THROW_FMT(OptionInvalidError, &quot;option '%s' cannot be set and negated&quot;, cfgOptionName(optionId));</span>
<span class="lineNum">     505 </span>                :         : 
<span class="lineNum">     506 </span>                :         :                         // Don't allow an option to be both set and reset
<span class="lineNum">     507 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 4 times"> + </span>]:<span class="lineCov">       5 :                         if (parseOptionList[optionId].reset != reset)</span>
<span class="lineNum">     508 </span>                :<span class="lineCov">       1 :                             THROW_FMT(OptionInvalidError, &quot;option '%s' cannot be set and reset&quot;, cfgOptionName(optionId));</span>
<span class="lineNum">     509 </span>                :         : 
<span class="lineNum">     510 </span>                :         :                         // Add the argument
<span class="lineNum">     511 </span>  [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchCov" title="Branch 2 was taken 2 times"> + </span><span class="branchCov" title="Branch 3 was taken 1 time"> + </span>]:<span class="lineCov">       7 :                         if (optionList[optionListIdx].has_arg == required_argument &amp;&amp;</span>
<span class="lineNum">     512 </span>                :<span class="lineCov">       3 :                             cfgDefOptionMulti(cfgOptionDefIdFromId(optionId)))</span>
<span class="lineNum">     513 </span>                :         :                         {
<span class="lineNum">     514 </span>                :<span class="lineCov">       2 :                             strLstAdd(parseOptionList[optionId].valueList, strNew(optarg));</span>
<span class="lineNum">     515 </span>                :         :                         }
<span class="lineNum">     516 </span>                :         :                         // Error if the option does not accept multiple arguments
<span class="lineNum">     517 </span>                :         :                         else
<span class="lineNum">     518 </span>                :<span class="lineCov">       2 :                             THROW_FMT(OptionInvalidError, &quot;option '%s' cannot be set multiple times&quot;, cfgOptionName(optionId));</span>
<span class="lineNum">     519 </span>                :         :                     }
<span class="lineNum">     520 </span>                :         : 
<span class="lineNum">     521 </span>                :<span class="lineCov">     121 :                     break;</span>
<span class="lineNum">     522 </span>                :         :                 }
<span class="lineNum">     523 </span>                :         :             }
<span class="lineNum">     524 </span>                :         : 
<span class="lineNum">     525 </span>                :         :             // Arg has been found
<span class="lineNum">     526 </span>                :<span class="lineCov">     166 :             argFound = true;</span>
<span class="lineNum">     527 </span>                :         :         }
<span class="lineNum">     528 </span>                :         : 
<span class="lineNum">     529 </span>                :         :         // Handle command not found
<span class="lineNum">     530 </span>[<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchCov" title="Branch 1 was taken 39 times"> + </span>][<span class="branchCov" title="Branch 3 was taken 2 times"> + </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span>]:<span class="lineCov">      42 :         if (!commandSet &amp;&amp; !cfgCommandHelp())</span>
<span class="lineNum">     531 </span>                :         :         {
<span class="lineNum">     532 </span>                :         :             // If there are args then error
<span class="lineNum">     533 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">       2 :             if (argFound)</span>
<span class="lineNum">     534 </span>                :<span class="lineCov">       1 :                 THROW_FMT(CommandRequiredError, &quot;no command found&quot;);</span>
<span class="lineNum">     535 </span>                :         : 
<span class="lineNum">     536 </span>                :         :             // Otherwise set the comand to help
<span class="lineNum">     537 </span>                :<span class="lineCov">       1 :             cfgCommandHelpSet(true);</span>
<span class="lineNum">     538 </span>                :         :         }
<span class="lineNum">     539 </span>                :         : 
<span class="lineNum">     540 </span>                :         :         // Set command params
<span class="lineNum">     541 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 40 times"> + </span>]:<span class="lineCov">      41 :         if (commandParamList != NULL)</span>
<span class="lineNum">     542 </span>                :<span class="lineCov">       1 :             cfgCommandParamSet(commandParamList);</span>
<span class="lineNum">     543 </span>                :         : 
<span class="lineNum">     544 </span>                :         :         // Enable logging (except for local and remote commands) so config file warnings will be output
<span class="lineNum">     545 </span>[<span class="branchCov" title="Branch 1 was taken 40 times"> + </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span>][<span class="branchCov" title="Branch 4 was taken 39 times"> + </span><span class="branchCov" title="Branch 5 was taken 1 time"> + </span>]:<span class="lineCov">      41 :         if (cfgCommand() != cfgCmdLocal &amp;&amp; cfgCommand() != cfgCmdRemote &amp;&amp; resetLogLevel)</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 6 was taken 1 time"> + </span><span class="branchCov" title="Branch 7 was taken 38 times"> + </span>]
<span class="lineNum">     546 </span>                :<span class="lineCov">       1 :             logInit(logLevelWarn, logLevelWarn, logLevelOff, false);</span>
<span class="lineNum">     547 </span>                :         : 
<span class="lineNum">     548 </span>                :         :         // Only continue if command options need to be validated, i.e. a real command is running or we are getting help for a
<span class="lineNum">     549 </span>                :         :         // specific command and would like to display actual option values in the help.
<span class="lineNum">     550 </span>  [<span class="branchCov" title="Branch 1 was taken 40 times"> + </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchCov" title="Branch 3 was taken 39 times"> + </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span>]:<span class="lineCov">      81 :         if (cfgCommand() != cfgCmdNone &amp;&amp;</span>
<span class="lineNum">     551 </span>        [<span class="branchCov" title="Branch 1 was taken 38 times"> + </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span>]:<span class="lineCov">      79 :             cfgCommand() != cfgCmdVersion &amp;&amp;</span>
<span class="lineNum">     552 </span>                :<span class="lineCov">      39 :             cfgCommand() != cfgCmdHelp)</span>
<span class="lineNum">     553 </span>                :         :         {
<span class="lineNum">     554 </span>                :         :             // Phase 2: parse environment variables
<span class="lineNum">     555 </span>                :         :             // ---------------------------------------------------------------------------------------------------------------------
<span class="lineNum">     556 </span>                :<span class="lineCov">      38 :             ConfigDefineCommand commandDefId = cfgCommandDefIdFromId(cfgCommand());</span>
<span class="lineNum">     557 </span>                :         : 
<span class="lineNum">     558 </span>                :<span class="lineCov">      38 :             unsigned int environIdx = 0;</span>
<span class="lineNum">     559 </span>                :         : 
<span class="lineNum">     560 </span>                :         :             // Loop through all environment variables and look for our env vars by matching the prefix
<span class="lineNum">     561 </span>        [<span class="branchCov" title="Branch 0 was taken 480 times"> + </span><span class="branchCov" title="Branch 1 was taken 36 times"> + </span>]:<span class="lineCov">     516 :             while (environ[environIdx] != NULL)</span>
<span class="lineNum">     562 </span>                :         :             {
<span class="lineNum">     563 </span>                :<span class="lineCov">     480 :                 const char *keyValue = environ[environIdx];</span>
<span class="lineNum">     564 </span>                :<span class="lineCov">     480 :                 environIdx++;</span>
<span class="lineNum">     565 </span>                :         : 
<span class="lineNum">     566 </span>        [<span class="branchCov" title="Branch 0 was taken 15 times"> + </span><span class="branchCov" title="Branch 1 was taken 465 times"> + </span>]:<span class="lineCov">     480 :                 if (strstr(keyValue, PGBACKREST_ENV) == keyValue)</span>
<span class="lineNum">     567 </span>                :         :                 {
<span class="lineNum">     568 </span>                :         :                     // Find the first = char
<span class="lineNum">     569 </span>                :<span class="lineCov">      15 :                     const char *equalPtr = strchr(keyValue, '=');</span>
<span class="lineNum">     570 </span>                :<span class="lineCov">      15 :                     ASSERT_DEBUG(equalPtr != NULL);</span>
<span class="lineNum">     571 </span>                :         : 
<span class="lineNum">     572 </span>                :         :                     // Get key and value
<span class="lineNum">     573 </span>                :<span class="lineCov">      15 :                     String *key = strReplaceChr(</span>
<span class="lineNum">     574 </span>                :<span class="lineCov">      15 :                         strLower(strNewN(keyValue + PGBACKREST_ENV_SIZE, (size_t)(equalPtr - (keyValue + PGBACKREST_ENV_SIZE)))),</span>
<span class="lineNum">     575 </span>                :         :                         '_', '-');
<span class="lineNum">     576 </span>                :<span class="lineCov">      15 :                     String *value = strNew(equalPtr + 1);</span>
<span class="lineNum">     577 </span>                :         : 
<span class="lineNum">     578 </span>                :         :                     // Find the option
<span class="lineNum">     579 </span>                :<span class="lineCov">      15 :                     unsigned int optionIdx = optionFind(key);</span>
<span class="lineNum">     580 </span>                :         : 
<span class="lineNum">     581 </span>                :         :                     // Warn if the option not found
<span class="lineNum">     582 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 14 times"> + </span>]:<span class="lineCov">      15 :                     if (optionList[optionIdx].name == NULL)</span>
<span class="lineNum">     583 </span>                :         :                     {
<span class="lineNum">     584 </span>                :<span class="lineCov">       1 :                         LOG_WARN(&quot;environment contains invalid option '%s'&quot;, strPtr(key));</span>
<span class="lineNum">     585 </span>                :<span class="lineCov">       1 :                         continue;</span>
<span class="lineNum">     586 </span>                :         :                     }
<span class="lineNum">     587 </span>                :         :                     // Warn if negate option found in env
<span class="lineNum">     588 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 13 times"> + </span>]:<span class="lineCov">      14 :                     else if (optionList[optionIdx].val &amp; PARSE_NEGATE_FLAG)</span>
<span class="lineNum">     589 </span>                :         :                     {
<span class="lineNum">     590 </span>                :<span class="lineCov">       1 :                         LOG_WARN(&quot;environment contains invalid negate option '%s'&quot;, strPtr(key));</span>
<span class="lineNum">     591 </span>                :<span class="lineCov">       1 :                         continue;</span>
<span class="lineNum">     592 </span>                :         :                     }
<span class="lineNum">     593 </span>                :         :                     // Warn if reset option found in env
<span class="lineNum">     594 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 12 times"> + </span>]:<span class="lineCov">      13 :                     else if (optionList[optionIdx].val &amp; PARSE_RESET_FLAG)</span>
<span class="lineNum">     595 </span>                :         :                     {
<span class="lineNum">     596 </span>                :<span class="lineCov">       1 :                         LOG_WARN(&quot;environment contains invalid reset option '%s'&quot;, strPtr(key));</span>
<span class="lineNum">     597 </span>                :<span class="lineCov">       1 :                         continue;</span>
<span class="lineNum">     598 </span>                :         :                     }
<span class="lineNum">     599 </span>                :         : 
<span class="lineNum">     600 </span>                :<span class="lineCov">      12 :                     ConfigOption optionId = optionList[optionIdx].val &amp; PARSE_OPTION_MASK;</span>
<span class="lineNum">     601 </span>                :<span class="lineCov">      12 :                     ConfigDefineOption optionDefId = cfgOptionDefIdFromId(optionId);</span>
<span class="lineNum">     602 </span>                :         : 
<span class="lineNum">     603 </span>                :         :                     // Continue if the option is not valid for this command
<span class="lineNum">     604 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchCov" title="Branch 2 was taken 11 times"> + </span>]:<span class="lineCov">      12 :                     if (!cfgDefOptionValid(commandDefId, optionDefId))</span>
<span class="lineNum">     605 </span>                :<span class="lineCov">       1 :                         continue;</span>
<span class="lineNum">     606 </span>                :         : 
<span class="lineNum">     607 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchCov" title="Branch 2 was taken 10 times"> + </span>]:<span class="lineCov">      11 :                     if (strSize(value) == 0)</span>
<span class="lineNum">     608 </span>                :<span class="lineCov">       1 :                         THROW_FMT(OptionInvalidValueError, &quot;environment variable '%s' must have a value&quot;, strPtr(key));</span>
<span class="lineNum">     609 </span>                :         : 
<span class="lineNum">     610 </span>                :         :                     // Continue if the option has already been specified on the command line
<span class="lineNum">     611 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 9 times"> + </span>]:<span class="lineCov">      10 :                     if (parseOptionList[optionId].found)</span>
<span class="lineNum">     612 </span>                :<span class="lineCov">       1 :                         continue;</span>
<span class="lineNum">     613 </span>                :         : 
<span class="lineNum">     614 </span>                :<span class="lineCov">       9 :                     parseOptionList[optionId].found = true;</span>
<span class="lineNum">     615 </span>                :<span class="lineCov">       9 :                     parseOptionList[optionId].source = cfgSourceConfig;</span>
<span class="lineNum">     616 </span>                :         : 
<span class="lineNum">     617 </span>                :         :                     // Convert boolean to string
<span class="lineNum">     618 </span>        [<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchCov" title="Branch 2 was taken 7 times"> + </span>]:<span class="lineCov">       9 :                     if (cfgDefOptionType(optionDefId) == cfgDefOptTypeBoolean)</span>
<span class="lineNum">     619 </span>                :         :                     {
<span class="lineNum">     620 </span>                :<span class="lineCov">       2 :                         if (strEqZ(value, &quot;n&quot;))</span>
<span class="lineNum">     621 </span>                :<span class="lineCov">       1 :                             parseOptionList[optionId].negate = true;</span>
<span class="lineNum">     622 </span>                :<span class="lineCov">       1 :                         else if (!strEqZ(value, &quot;y&quot;))</span>
<span class="lineNum">     623 </span>                :<span class="lineCov">       1 :                             THROW_FMT(OptionInvalidValueError, &quot;environment boolean option '%s' must be 'y' or 'n'&quot;, strPtr(key));</span>
<span class="lineNum">     624 </span>                :         :                     }
<span class="lineNum">     625 </span>                :         :                     // Else split list/hash into separate values
<span class="lineNum">     626 </span>        [<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchCov" title="Branch 2 was taken 5 times"> + </span>]:<span class="lineCov">       7 :                     else if (cfgDefOptionMulti(optionDefId))</span>
<span class="lineNum">     627 </span>                :         :                     {
<span class="lineNum">     628 </span>                :<span class="lineCov">       2 :                         parseOptionList[optionId].valueList = strLstNewSplitZ(value, &quot;:&quot;);</span>
<span class="lineNum">     629 </span>                :         :                     }
<span class="lineNum">     630 </span>                :         :                     // Else add the string value
<span class="lineNum">     631 </span>                :         :                     else
<span class="lineNum">     632 </span>                :         :                     {
<span class="lineNum">     633 </span>                :<span class="lineCov">       5 :                         parseOptionList[optionId].valueList = strLstNew();</span>
<span class="lineNum">     634 </span>                :<span class="lineCov">       5 :                         strLstAdd(parseOptionList[optionId].valueList, value);</span>
<span class="lineNum">     635 </span>                :         :                     }
<span class="lineNum">     636 </span>                :         :                 }
<span class="lineNum">     637 </span>                :         :             }
<span class="lineNum">     638 </span>                :         : 
<span class="lineNum">     639 </span>                :         :             // Phase 3: parse config file unless --no-config passed
<span class="lineNum">     640 </span>                :         :             // ---------------------------------------------------------------------------------------------------------------------
<span class="lineNum">     641 </span>                :         :             // Load the configuration file(s)
<span class="lineNum">     642 </span>                :<span class="lineCov">      36 :             String *configString = cfgFileLoad(parseOptionList,</span>
<span class="lineNum">     643 </span>                :<span class="lineCov">      36 :                 strNew(cfgDefOptionDefault(commandDefId, cfgOptionDefIdFromId(cfgOptConfig))),</span>
<span class="lineNum">     644 </span>                :<span class="lineCov">      36 :                 strNew(cfgDefOptionDefault(commandDefId, cfgOptionDefIdFromId(cfgOptConfigIncludePath))),</span>
<span class="lineNum">     645 </span>                :         :                 PGBACKREST_CONFIG_ORIG_PATH_FILE_STR);
<span class="lineNum">     646 </span>                :         : 
<span class="lineNum">     647 </span>        [<span class="branchCov" title="Branch 0 was taken 10 times"> + </span><span class="branchCov" title="Branch 1 was taken 26 times"> + </span>]:<span class="lineCov">      36 :             if (configString != NULL)</span>
<span class="lineNum">     648 </span>                :         :             {
<span class="lineNum">     649 </span>                :<span class="lineCov">      10 :                 Ini *config = iniNew();</span>
<span class="lineNum">     650 </span>                :<span class="lineCov">      10 :                 iniParse(config, configString);</span>
<span class="lineNum">     651 </span>                :         :                 // Get the stanza name
<span class="lineNum">     652 </span>                :<span class="lineCov">      10 :                 String *stanza = NULL;</span>
<span class="lineNum">     653 </span>                :         : 
<span class="lineNum">     654 </span>        [<span class="branchCov" title="Branch 0 was taken 9 times"> + </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">      10 :                 if (parseOptionList[cfgOptStanza].found)</span>
<span class="lineNum">     655 </span>                :<span class="lineCov">       9 :                     stanza = strLstGet(parseOptionList[cfgOptStanza].valueList, 0);</span>
<span class="lineNum">     656 </span>                :         : 
<span class="lineNum">     657 </span>                :         :                 // Build list of sections to search for options
<span class="lineNum">     658 </span>                :<span class="lineCov">      10 :                 StringList *sectionList = strLstNew();</span>
<span class="lineNum">     659 </span>                :         : 
<span class="lineNum">     660 </span>        [<span class="branchCov" title="Branch 0 was taken 9 times"> + </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">      10 :                 if (stanza != NULL)</span>
<span class="lineNum">     661 </span>                :         :                 {
<span class="lineNum">     662 </span>                :<span class="lineCov">       9 :                     strLstAdd(sectionList, strNewFmt(&quot;%s:%s&quot;, strPtr(stanza), cfgCommandName(cfgCommand())));</span>
<span class="lineNum">     663 </span>                :<span class="lineCov">       9 :                     strLstAdd(sectionList, stanza);</span>
<span class="lineNum">     664 </span>                :         :                 }
<span class="lineNum">     665 </span>                :         : 
<span class="lineNum">     666 </span>                :<span class="lineCov">      10 :                 strLstAdd(sectionList, strNewFmt(CFGDEF_SECTION_GLOBAL &quot;:%s&quot;, cfgCommandName(cfgCommand())));</span>
<span class="lineNum">     667 </span>                :<span class="lineCov">      10 :                 strLstAdd(sectionList, CFGDEF_SECTION_GLOBAL_STR);</span>
<span class="lineNum">     668 </span>                :         : 
<span class="lineNum">     669 </span>                :         :                 // Loop through sections to search for options
<span class="lineNum">     670 </span>        [<span class="branchCov" title="Branch 1 was taken 32 times"> + </span><span class="branchCov" title="Branch 2 was taken 5 times"> + </span>]:<span class="lineCov">      37 :                 for (unsigned int sectionIdx = 0; sectionIdx &lt; strLstSize(sectionList); sectionIdx++)</span>
<span class="lineNum">     671 </span>                :         :                 {
<span class="lineNum">     672 </span>                :<span class="lineCov">      32 :                     String *section = strLstGet(sectionList, sectionIdx);</span>
<span class="lineNum">     673 </span>                :<span class="lineCov">      32 :                     StringList *keyList = iniSectionKeyList(config, section);</span>
<span class="lineNum">     674 </span>                :<span class="lineCov">      32 :                     KeyValue *optionFound = kvNew();</span>
<span class="lineNum">     675 </span>                :         : 
<span class="lineNum">     676 </span>                :         :                     // Loop through keys to search for options
<span class="lineNum">     677 </span>        [<span class="branchCov" title="Branch 1 was taken 43 times"> + </span><span class="branchCov" title="Branch 2 was taken 27 times"> + </span>]:<span class="lineCov">      70 :                     for (unsigned int keyIdx = 0; keyIdx &lt; strLstSize(keyList); keyIdx++)</span>
<span class="lineNum">     678 </span>                :         :                     {
<span class="lineNum">     679 </span>                :<span class="lineCov">      43 :                         String *key = strLstGet(keyList, keyIdx);</span>
<span class="lineNum">     680 </span>                :         : 
<span class="lineNum">     681 </span>                :         :                         // Find the optionName in the main list
<span class="lineNum">     682 </span>                :<span class="lineCov">      43 :                         unsigned int optionIdx = optionFind(key);</span>
<span class="lineNum">     683 </span>                :         : 
<span class="lineNum">     684 </span>                :         :                         // Warn if the option not found
<span class="lineNum">     685 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 41 times"> + </span>]:<span class="lineCov">      43 :                         if (optionList[optionIdx].name == NULL)</span>
<span class="lineNum">     686 </span>                :         :                         {
<span class="lineNum">     687 </span>                :<span class="lineCov">       2 :                             LOG_WARN(&quot;configuration file contains invalid option '%s'&quot;, strPtr(key));</span>
<span class="lineNum">     688 </span>                :<span class="lineCov">       2 :                             continue;</span>
<span class="lineNum">     689 </span>                :         :                         }
<span class="lineNum">     690 </span>                :         :                         // Warn if negate option found in config
<span class="lineNum">     691 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 39 times"> + </span>]:<span class="lineCov">      41 :                         else if (optionList[optionIdx].val &amp; PARSE_NEGATE_FLAG)</span>
<span class="lineNum">     692 </span>                :         :                         {
<span class="lineNum">     693 </span>                :<span class="lineCov">       2 :                             LOG_WARN(&quot;configuration file contains negate option '%s'&quot;, strPtr(key));</span>
<span class="lineNum">     694 </span>                :<span class="lineCov">       2 :                             continue;</span>
<span class="lineNum">     695 </span>                :         :                         }
<span class="lineNum">     696 </span>                :         :                         // Warn if reset option found in config
<span class="lineNum">     697 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 37 times"> + </span>]:<span class="lineCov">      39 :                         else if (optionList[optionIdx].val &amp; PARSE_RESET_FLAG)</span>
<span class="lineNum">     698 </span>                :         :                         {
<span class="lineNum">     699 </span>                :<span class="lineCov">       2 :                             LOG_WARN(&quot;configuration file contains reset option '%s'&quot;, strPtr(key));</span>
<span class="lineNum">     700 </span>                :<span class="lineCov">       2 :                             continue;</span>
<span class="lineNum">     701 </span>                :         :                         }
<span class="lineNum">     702 </span>                :         : 
<span class="lineNum">     703 </span>                :<span class="lineCov">      37 :                         ConfigOption optionId = optionList[optionIdx].val &amp; PARSE_OPTION_MASK;</span>
<span class="lineNum">     704 </span>                :<span class="lineCov">      37 :                         ConfigDefineOption optionDefId = cfgOptionDefIdFromId(optionId);</span>
<span class="lineNum">     705 </span>                :         : 
<span class="lineNum">     706 </span>                :         :                         /// Warn if this option should be command-line only
<span class="lineNum">     707 </span>        [<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchCov" title="Branch 2 was taken 35 times"> + </span>]:<span class="lineCov">      37 :                         if (cfgDefOptionSection(optionDefId) == cfgDefSectionCommandLine)</span>
<span class="lineNum">     708 </span>                :         :                         {
<span class="lineNum">     709 </span>                :<span class="lineCov">       2 :                             LOG_WARN(&quot;configuration file contains command-line only option '%s'&quot;, strPtr(key));</span>
<span class="lineNum">     710 </span>                :<span class="lineCov">       2 :                             continue;</span>
<span class="lineNum">     711 </span>                :         :                         }
<span class="lineNum">     712 </span>                :         : 
<span class="lineNum">     713 </span>                :         :                         // Make sure this option does not appear in the same section with an alternate name
<span class="lineNum">     714 </span>                :<span class="lineCov">      35 :                         Variant *optionFoundKey = varNewInt(optionId);</span>
<span class="lineNum">     715 </span>                :<span class="lineCov">      35 :                         const Variant *optionFoundName = kvGet(optionFound, optionFoundKey);</span>
<span class="lineNum">     716 </span>                :         : 
<span class="lineNum">     717 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 34 times"> + </span>]:<span class="lineCov">      35 :                         if (optionFoundName != NULL)</span>
<span class="lineNum">     718 </span>                :         :                         {
<span class="lineNum">     719 </span>                :<span class="lineCov">       1 :                             THROW_FMT(</span>
<span class="lineNum">     720 </span>                :         :                                 OptionInvalidError, &quot;configuration file contains duplicate options ('%s', '%s') in section '[%s]'&quot;,
<span class="lineNum">     721 </span>                :         :                                 strPtr(key), strPtr(varStr(optionFoundName)), strPtr(section));
<span class="lineNum">     722 </span>                :         :                         }
<span class="lineNum">     723 </span>                :         :                         else
<span class="lineNum">     724 </span>                :<span class="lineCov">      34 :                             kvPut(optionFound, optionFoundKey, varNewStr(key));</span>
<span class="lineNum">     725 </span>                :         : 
<span class="lineNum">     726 </span>                :         :                         // Continue if the option is not valid for this command
<span class="lineNum">     727 </span>        [<span class="branchCov" title="Branch 1 was taken 6 times"> + </span><span class="branchCov" title="Branch 2 was taken 28 times"> + </span>]:<span class="lineCov">      34 :                         if (!cfgDefOptionValid(commandDefId, optionDefId))</span>
<span class="lineNum">     728 </span>                :         :                         {
<span class="lineNum">     729 </span>                :         :                             // Warn if it is in a command section
<span class="lineNum">     730 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 4 times"> + </span>]:<span class="lineCov">       6 :                             if (sectionIdx % 2 == 0)</span>
<span class="lineNum">     731 </span>                :         :                             {
<span class="lineNum">     732 </span>                :<span class="lineCov">       2 :                                 LOG_WARN(</span>
<span class="lineNum">     733 </span>                :         :                                     &quot;configuration file contains option '%s' invalid for section '%s'&quot;, strPtr(key),
<span class="lineNum">     734 </span>                :         :                                     strPtr(section));
<span class="lineNum">     735 </span>                :<span class="lineCov">       2 :                                 continue;</span>
<span class="lineNum">     736 </span>                :         :                             }
<span class="lineNum">     737 </span>                :         : 
<span class="lineNum">     738 </span>                :<span class="lineCov">       4 :                             continue;</span>
<span class="lineNum">     739 </span>                :         :                         }
<span class="lineNum">     740 </span>                :         : 
<span class="lineNum">     741 </span>                :         :                         // Continue if stanza option is in a global section
<span class="lineNum">     742 </span>  [<span class="branchCov" title="Branch 1 was taken 9 times"> + </span><span class="branchCov" title="Branch 2 was taken 19 times"> + </span><span class="branchCov" title="Branch 3 was taken 2 times"> + </span><span class="branchCov" title="Branch 4 was taken 7 times"> + </span>]:<span class="lineCov">      37 :                         if (cfgDefOptionSection(optionDefId) == cfgDefSectionStanza &amp;&amp;</span>
<span class="lineNum">     743 </span>                :<span class="lineCov">       9 :                             strBeginsWithZ(section, CFGDEF_SECTION_GLOBAL))</span>
<span class="lineNum">     744 </span>                :         :                         {
<span class="lineNum">     745 </span>                :<span class="lineCov">       2 :                             LOG_WARN(</span>
<span class="lineNum">     746 </span>                :         :                                 &quot;configuration file contains stanza-only option '%s' in global section '%s'&quot;, strPtr(key),
<span class="lineNum">     747 </span>                :         :                                 strPtr(section));
<span class="lineNum">     748 </span>                :<span class="lineCov">       2 :                             continue;</span>
<span class="lineNum">     749 </span>                :         :                         }
<span class="lineNum">     750 </span>                :         : 
<span class="lineNum">     751 </span>                :         :                         // Continue if this option has already been found in another section or command-line/environment
<span class="lineNum">     752 </span>        [<span class="branchCov" title="Branch 0 was taken 5 times"> + </span><span class="branchCov" title="Branch 1 was taken 21 times"> + </span>]:<span class="lineCov">      26 :                         if (parseOptionList[optionId].found)</span>
<span class="lineNum">     753 </span>                :<span class="lineCov">       5 :                             continue;</span>
<span class="lineNum">     754 </span>                :         : 
<span class="lineNum">     755 </span>                :         :                         // Get the option value
<span class="lineNum">     756 </span>                :<span class="lineCov">      21 :                         const Variant *value = iniGetDefault(config, section, key, NULL);</span>
<span class="lineNum">     757 </span>                :         : 
<span class="lineNum">     758 </span>[<span class="branchCov" title="Branch 1 was taken 18 times"> + </span><span class="branchCov" title="Branch 2 was taken 3 times"> + </span>][<span class="branchCov" title="Branch 5 was taken 1 time"> + </span><span class="branchCov" title="Branch 6 was taken 17 times"> + </span>]:<span class="lineCov">      21 :                         if (varType(value) == varTypeString &amp;&amp; strSize(varStr(value)) == 0)</span>
<span class="lineNum">     759 </span>                :         :                         {
<span class="lineNum">     760 </span>                :<span class="lineCov">       1 :                             THROW_FMT(</span>
<span class="lineNum">     761 </span>                :         :                                 OptionInvalidValueError, &quot;section '%s', key '%s' must have a value&quot;, strPtr(section), strPtr(key));
<span class="lineNum">     762 </span>                :         :                         }
<span class="lineNum">     763 </span>                :         : 
<span class="lineNum">     764 </span>                :<span class="lineCov">      20 :                         parseOptionList[optionId].found = true;</span>
<span class="lineNum">     765 </span>                :<span class="lineCov">      20 :                         parseOptionList[optionId].source = cfgSourceConfig;</span>
<span class="lineNum">     766 </span>                :         : 
<span class="lineNum">     767 </span>        [<span class="branchCov" title="Branch 1 was taken 3 times"> + </span><span class="branchCov" title="Branch 2 was taken 17 times"> + </span>]:<span class="lineCov">      20 :                         if (varType(value) == varTypeVariantList)</span>
<span class="lineNum">     768 </span>                :         :                         {
<span class="lineNum">     769 </span>                :         :                             // Error if the option cannot be specified multiple times
<span class="lineNum">     770 </span>        [<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span>]:<span class="lineCov">       3 :                             if (!cfgDefOptionMulti(optionDefId))</span>
<span class="lineNum">     771 </span>                :<span class="lineCov">       2 :                                 THROW_FMT(OptionInvalidError, &quot;option '%s' cannot be set multiple times&quot;, cfgOptionName(optionId));</span>
<span class="lineNum">     772 </span>                :         : 
<span class="lineNum">     773 </span>                :<span class="lineCov">       1 :                             parseOptionList[optionId].valueList = strLstNewVarLst(varVarLst(value));</span>
<span class="lineNum">     774 </span>                :         :                         }
<span class="lineNum">     775 </span>                :         :                         // Convert boolean
<span class="lineNum">     776 </span>        [<span class="branchCov" title="Branch 1 was taken 7 times"> + </span><span class="branchCov" title="Branch 2 was taken 10 times"> + </span>]:<span class="lineCov">      17 :                         else if (cfgDefOptionType(optionDefId) == cfgDefOptTypeBoolean)</span>
<span class="lineNum">     777 </span>                :         :                         {
<span class="lineNum">     778 </span>        [<span class="branchCov" title="Branch 2 was taken 2 times"> + </span><span class="branchCov" title="Branch 3 was taken 5 times"> + </span>]:<span class="lineCov">       7 :                             if (strcasecmp(strPtr(varStr(value)), &quot;n&quot;) == 0)</span>
<span class="lineNum">     779 </span>                :<span class="lineCov">       2 :                                 parseOptionList[optionId].negate = true;</span>
<span class="lineNum">     780 </span>        [<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchCov" title="Branch 3 was taken 4 times"> + </span>]:<span class="lineCov">       5 :                             else if (strcasecmp(strPtr(varStr(value)), &quot;y&quot;) != 0)</span>
<span class="lineNum">     781 </span>                :<span class="lineCov">       1 :                                 THROW_FMT(OptionInvalidValueError, &quot;boolean option '%s' must be 'y' or 'n'&quot;, strPtr(key));</span>
<span class="lineNum">     782 </span>                :         :                         }
<span class="lineNum">     783 </span>                :         :                         // Else add the string value
<span class="lineNum">     784 </span>                :         :                         else
<span class="lineNum">     785 </span>                :         :                         {
<span class="lineNum">     786 </span>                :<span class="lineCov">      10 :                             parseOptionList[optionId].valueList = strLstNew();</span>
<span class="lineNum">     787 </span>                :<span class="lineCov">      10 :                             strLstAdd(parseOptionList[optionId].valueList, varStr(value));</span>
<span class="lineNum">     788 </span>                :         :                         }
<span class="lineNum">     789 </span>                :         :                     }
<span class="lineNum">     790 </span>                :         :                 }
<span class="lineNum">     791 </span>                :         :             }
<span class="lineNum">     792 </span>                :         : 
<span class="lineNum">     793 </span>                :         :             // Phase 4: validate option definitions and load into configuration
<span class="lineNum">     794 </span>                :         :             // ---------------------------------------------------------------------------------------------------------------------
<span class="lineNum">     795 </span>        [<span class="branchCov" title="Branch 0 was taken 4181 times"> + </span><span class="branchCov" title="Branch 1 was taken 13 times"> + </span>]:<span class="lineCov">    4197 :             for (unsigned int optionOrderIdx = 0; optionOrderIdx &lt; CFG_OPTION_TOTAL; optionOrderIdx++)</span>
<span class="lineNum">     796 </span>                :         :             {
<span class="lineNum">     797 </span>                :         :                 // Validate options based on the option resolve order.  This allows resolving all options in a single pass.
<span class="lineNum">     798 </span>                :<span class="lineCov">    4181 :                 ConfigOption optionId = optionResolveOrder[optionOrderIdx];</span>
<span class="lineNum">     799 </span>                :         : 
<span class="lineNum">     800 </span>                :         :                 // Get the option data parsed from the command-line
<span class="lineNum">     801 </span>                :<span class="lineCov">    4181 :                 ParseOption *parseOption = &amp;parseOptionList[optionId];</span>
<span class="lineNum">     802 </span>                :         : 
<span class="lineNum">     803 </span>                :         :                 // Get the option definition id -- will be used to look up option rules
<span class="lineNum">     804 </span>                :<span class="lineCov">    4181 :                 ConfigDefineOption optionDefId = cfgOptionDefIdFromId(optionId);</span>
<span class="lineNum">     805 </span>                :<span class="lineCov">    4181 :                 ConfigDefineOptionType optionDefType = cfgDefOptionType(optionDefId);</span>
<span class="lineNum">     806 </span>                :         : 
<span class="lineNum">     807 </span>                :         :                 // Error if the option is not valid for this command
<span class="lineNum">     808 </span>[<span class="branchCov" title="Branch 0 was taken 116 times"> + </span><span class="branchCov" title="Branch 1 was taken 4065 times"> + </span>][<span class="branchCov" title="Branch 3 was taken 1 time"> + </span><span class="branchCov" title="Branch 4 was taken 115 times"> + </span>]:<span class="lineCov">    4181 :                 if (parseOption-&gt;found &amp;&amp; !cfgDefOptionValid(commandDefId, optionDefId))</span>
<span class="lineNum">     809 </span>                :         :                 {
<span class="lineNum">     810 </span>                :<span class="lineCov">       1 :                     THROW_FMT(</span>
<span class="lineNum">     811 </span>                :         :                         OptionInvalidError, &quot;option '%s' not valid for command '%s'&quot;, cfgOptionName(optionId),
<span class="lineNum">     812 </span>                :         :                         cfgCommandName(cfgCommand()));
<span class="lineNum">     813 </span>                :         :                 }
<span class="lineNum">     814 </span>                :         : 
<span class="lineNum">     815 </span>                :         :                 // Is the option valid for this command?  If not, there is nothing more to do.
<span class="lineNum">     816 </span>                :<span class="lineCov">    4180 :                 cfgOptionValidSet(optionId, cfgDefOptionValid(commandDefId, optionDefId));</span>
<span class="lineNum">     817 </span>                :         : 
<span class="lineNum">     818 </span>        [<span class="branchCov" title="Branch 1 was taken 1879 times"> + </span><span class="branchCov" title="Branch 2 was taken 2301 times"> + </span>]:<span class="lineCov">    4180 :                 if (!cfgOptionValid(optionId))</span>
<span class="lineNum">     819 </span>                :<span class="lineCov">    1879 :                     continue;</span>
<span class="lineNum">     820 </span>                :         : 
<span class="lineNum">     821 </span>                :         :                 // Is the value set for this option?
<span class="lineNum">     822 </span>                :<span class="lineCov">    2301 :                 bool optionSet =</span>
<span class="lineNum">     823 </span>[<span class="branchCov" title="Branch 0 was taken 115 times"> + </span><span class="branchCov" title="Branch 1 was taken 2186 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 101 times"> + </span><span class="branchCov" title="Branch 3 was taken 14 times"> + </span>]:<span class="lineCov">    2301 :                     parseOption-&gt;found &amp;&amp; (optionDefType == cfgDefOptTypeBoolean || !parseOption-&gt;negate) &amp;&amp;</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 4 was taken 99 times"> + </span><span class="branchCov" title="Branch 5 was taken 2 times"> + </span>][<span class="branchCov" title="Branch 6 was taken 109 times"> + </span><span class="branchCov" title="Branch 7 was taken 4 times"> + </span>]
<span class="lineNum">     824 </span>                :<span class="lineCov">     113 :                     !parseOption-&gt;reset;</span>
<span class="lineNum">     825 </span>                :         : 
<span class="lineNum">     826 </span>                :         :                 // Set negate flag
<span class="lineNum">     827 </span>                :<span class="lineCov">    2301 :                 cfgOptionNegateSet(optionId, parseOption-&gt;negate);</span>
<span class="lineNum">     828 </span>                :         : 
<span class="lineNum">     829 </span>                :         :                 // Set reset flag
<span class="lineNum">     830 </span>                :<span class="lineCov">    2301 :                 cfgOptionResetSet(optionId, parseOption-&gt;reset);</span>
<span class="lineNum">     831 </span>                :         : 
<span class="lineNum">     832 </span>                :         :                 // Check option dependencies
<span class="lineNum">     833 </span>                :<span class="lineCov">    2301 :                 bool dependResolved = true;</span>
<span class="lineNum">     834 </span>                :         : 
<span class="lineNum">     835 </span>        [<span class="branchCov" title="Branch 1 was taken 944 times"> + </span><span class="branchCov" title="Branch 2 was taken 1357 times"> + </span>]:<span class="lineCov">    2301 :                 if (cfgDefOptionDepend(commandDefId, optionDefId))</span>
<span class="lineNum">     836 </span>                :         :                 {
<span class="lineNum">     837 </span>                :<span class="lineCov">     944 :                     ConfigOption dependOptionId =</span>
<span class="lineNum">     838 </span>                :<span class="lineCov">     944 :                         cfgOptionIdFromDefId(cfgDefOptionDependOption(commandDefId, optionDefId), cfgOptionIndex(optionId));</span>
<span class="lineNum">     839 </span>                :<span class="lineCov">     944 :                     ConfigDefineOption dependOptionDefId = cfgOptionDefIdFromId(dependOptionId);</span>
<span class="lineNum">     840 </span>                :<span class="lineCov">     944 :                     ConfigDefineOptionType dependOptionDefType = cfgDefOptionType(dependOptionDefId);</span>
<span class="lineNum">     841 </span>                :         : 
<span class="lineNum">     842 </span>                :         :                     // Get the depend option value
<span class="lineNum">     843 </span>                :<span class="lineCov">     944 :                     const Variant *dependValue = cfgOption(dependOptionId);</span>
<span class="lineNum">     844 </span>                :         : 
<span class="lineNum">     845 </span>        [<span class="branchCov" title="Branch 0 was taken 237 times"> + </span><span class="branchCov" title="Branch 1 was taken 707 times"> + </span>]:<span class="lineCov">     944 :                     if (dependValue != NULL)</span>
<span class="lineNum">     846 </span>                :         :                     {
<span class="lineNum">     847 </span>        [<span class="branchCov" title="Branch 0 was taken 37 times"> + </span><span class="branchCov" title="Branch 1 was taken 200 times"> + </span>]:<span class="lineCov">     237 :                         if (dependOptionDefType == cfgDefOptTypeBoolean)</span>
<span class="lineNum">     848 </span>                :         :                         {
<span class="lineNum">     849 </span>        [<span class="branchCov" title="Branch 1 was taken 12 times"> + </span><span class="branchCov" title="Branch 2 was taken 25 times"> + </span>]:<span class="lineCov">      37 :                             if (cfgOptionBool(dependOptionId))</span>
<span class="lineNum">     850 </span>                :<span class="lineCov">      12 :                                 dependValue = varNewStrZ(&quot;1&quot;);</span>
<span class="lineNum">     851 </span>                :         :                             else
<span class="lineNum">     852 </span>                :<span class="lineCov">      25 :                                 dependValue = varNewStrZ(&quot;0&quot;);</span>
<span class="lineNum">     853 </span>                :         :                         }
<span class="lineNum">     854 </span>                :         :                     }
<span class="lineNum">     855 </span>                :         : 
<span class="lineNum">     856 </span>                :         :                     // Can't resolve if the depend option value is null
<span class="lineNum">     857 </span>        [<span class="branchCov" title="Branch 0 was taken 707 times"> + </span><span class="branchCov" title="Branch 1 was taken 237 times"> + </span>]:<span class="lineCov">     944 :                     if (dependValue == NULL)</span>
<span class="lineNum">     858 </span>                :         :                     {
<span class="lineNum">     859 </span>                :<span class="lineCov">     707 :                         dependResolved = false;</span>
<span class="lineNum">     860 </span>                :         : 
<span class="lineNum">     861 </span>                :         :                         // If depend not resolved and option value is set on the command-line then error.  See unresolved list
<span class="lineNum">     862 </span>                :         :                         // depend below for a detailed explanation.
<span class="lineNum">     863 </span>[<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchCov" title="Branch 1 was taken 704 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 1 time"> + </span><span class="branchCov" title="Branch 3 was taken 2 times"> + </span>]:<span class="lineCov">     707 :                         if (optionSet &amp;&amp; parseOption-&gt;source == cfgSourceParam)</span>
<span class="lineNum">     864 </span>                :         :                         {
<span class="lineNum">     865 </span>                :<span class="lineCov">       1 :                             THROW_FMT(</span>
<span class="lineNum">     866 </span>                :         :                                 OptionInvalidError, &quot;option '%s' not valid without option '%s'&quot;, cfgOptionName(optionId),
<span class="lineNum">     867 </span>                :         :                                 cfgOptionName(dependOptionId));
<span class="lineNum">     868 </span>                :         :                         }
<span class="lineNum">     869 </span>                :         :                     }
<span class="lineNum">     870 </span>                :         :                     // If a depend list exists, make sure the value is in the list
<span class="lineNum">     871 </span>        [<span class="branchCov" title="Branch 1 was taken 223 times"> + </span><span class="branchCov" title="Branch 2 was taken 14 times"> + </span>]:<span class="lineCov">     237 :                     else if (cfgDefOptionDependValueTotal(commandDefId, optionDefId) &gt; 0)</span>
<span class="lineNum">     872 </span>                :         :                     {
<span class="lineNum">     873 </span>                :<span class="lineCov">     223 :                         dependResolved = cfgDefOptionDependValueValid(commandDefId, optionDefId, strPtr(varStr(dependValue)));</span>
<span class="lineNum">     874 </span>                :         : 
<span class="lineNum">     875 </span>                :         :                         // If depend not resolved and option value is set on the command-line then error.  It's OK to have
<span class="lineNum">     876 </span>                :         :                         // unresolved options in the config file because they may be there for another command.  For instance,
<span class="lineNum">     877 </span>                :         :                         // spool-path is only loaded for the archive-push command when archive-async=y, and the presense of
<span class="lineNum">     878 </span>                :         :                         // spool-path in the config file should not cause an error here, it will just end up null.
<span class="lineNum">     879 </span>[<span class="branchCov" title="Branch 0 was taken 191 times"> + </span><span class="branchCov" title="Branch 1 was taken 32 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 5 times"> + </span><span class="branchCov" title="Branch 3 was taken 186 times"> + </span>]:<span class="lineCov">     223 :                         if (!dependResolved &amp;&amp; optionSet &amp;&amp; parseOption-&gt;source == cfgSourceParam)</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 4 was taken 4 times"> + </span><span class="branchCov" title="Branch 5 was taken 1 time"> + </span>]
<span class="lineNum">     880 </span>                :         :                         {
<span class="lineNum">     881 </span>                :         :                             // Get the depend option name
<span class="lineNum">     882 </span>                :<span class="lineCov">       4 :                             String *dependOptionName = strNew(cfgOptionName(dependOptionId));</span>
<span class="lineNum">     883 </span>                :         : 
<span class="lineNum">     884 </span>                :         :                             // Build the list of possible depend values
<span class="lineNum">     885 </span>                :<span class="lineCov">       4 :                             StringList *dependValueList = strLstNew();</span>
<span class="lineNum">     886 </span>                :         : 
<span class="lineNum">     887 </span>        [<span class="branchCov" title="Branch 0 was taken 5 times"> + </span><span class="branchCov" title="Branch 1 was taken 4 times"> + </span>]:<span class="lineCov">      13 :                             for (unsigned int listIdx = 0;</span>
<span class="lineNum">     888 </span>                :<span class="lineCov">       9 :                                     listIdx &lt; cfgDefOptionDependValueTotal(commandDefId, optionDefId); listIdx++)</span>
<span class="lineNum">     889 </span>                :         :                             {
<span class="lineNum">     890 </span>                :<span class="lineCov">       5 :                                 const char *dependValue = cfgDefOptionDependValue(commandDefId, optionDefId, listIdx);</span>
<span class="lineNum">     891 </span>                :         : 
<span class="lineNum">     892 </span>                :         :                                 // Build list based on depend option type
<span class="lineNum">     893 </span>                :<span class="lineCov">       5 :                                 switch (dependOptionDefType)</span>
<span class="lineNum">     894 </span>                :         :                                 {
<span class="lineNum">     895 </span>                :         :                                     // Boolean outputs depend option name as no-* when false
<span class="lineNum">     896 </span>                :<span class="lineCov">       2 :                                     case cfgDefOptTypeBoolean:</span>
<span class="lineNum">     897 </span>                :         :                                     {
<span class="lineNum">     898 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">       2 :                                         if (strcmp(dependValue, &quot;0&quot;) == 0)</span>
<span class="lineNum">     899 </span>                :<span class="lineCov">       1 :                                             dependOptionName = strNewFmt(&quot;no-%s&quot;, cfgOptionName(dependOptionId));</span>
<span class="lineNum">     900 </span>                :         : 
<span class="lineNum">     901 </span>                :<span class="lineCov">       2 :                                         break;</span>
<span class="lineNum">     902 </span>                :         :                                     }
<span class="lineNum">     903 </span>                :         : 
<span class="lineNum">     904 </span>                :         :                                     // String is output with quotes
<span class="lineNum">     905 </span>                :<span class="lineCov">       3 :                                     case cfgDefOptTypeString:</span>
<span class="lineNum">     906 </span>                :         :                                     {
<span class="lineNum">     907 </span>                :<span class="lineCov">       3 :                                         strLstAdd(dependValueList, strNewFmt(&quot;'%s'&quot;, dependValue));</span>
<span class="lineNum">     908 </span>                :<span class="lineCov">       3 :                                         break;</span>
<span class="lineNum">     909 </span>                :         :                                     }
<span class="lineNum">     910 </span>                :         : 
<span class="lineNum">     911 </span>                :         :                                     // Other types are output plain
<span class="lineNum">     912 </span>                :<span class="lineNoCov">       0 :                                     case cfgDefOptTypeFloat:                        // {uncovered - no depends of other types}</span>
<span class="lineNum">     913 </span>                :         :                                     case cfgDefOptTypeHash:
<span class="lineNum">     914 </span>                :         :                                     case cfgDefOptTypeInteger:
<span class="lineNum">     915 </span>                :         :                                     case cfgDefOptTypeList:
<span class="lineNum">     916 </span>                :         :                                     case cfgDefOptTypeSize:
<span class="lineNum">     917 </span>                :         :                                     {
<span class="lineNum">     918 </span>                :<span class="lineNoCov">       0 :                                         strLstAddZ(dependValueList, dependValue);   // {+uncovered}</span>
<span class="lineNum">     919 </span>                :<span class="lineNoCov">       0 :                                         break;                                      // {+uncovered}</span>
<span class="lineNum">     920 </span>                :         :                                     }
<span class="lineNum">     921 </span>                :         :                                 }
<span class="lineNum">     922 </span>                :         :                             }
<span class="lineNum">     923 </span>                :         : 
<span class="lineNum">     924 </span>                :         :                             // Build the error string
<span class="lineNum">     925 </span>                :<span class="lineCov">       4 :                             String *errorValue = strNew(&quot;&quot;);</span>
<span class="lineNum">     926 </span>                :         : 
<span class="lineNum">     927 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchCov" title="Branch 2 was taken 3 times"> + </span>]:<span class="lineCov">       4 :                             if (strLstSize(dependValueList) == 1)</span>
<span class="lineNum">     928 </span>                :<span class="lineCov">       1 :                                 errorValue = strNewFmt(&quot; = %s&quot;, strPtr(strLstGet(dependValueList, 0)));</span>
<span class="lineNum">     929 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchCov" title="Branch 2 was taken 2 times"> + </span>]:<span class="lineCov">       3 :                             else if (strLstSize(dependValueList) &gt; 1)</span>
<span class="lineNum">     930 </span>                :<span class="lineCov">       1 :                                 errorValue = strNewFmt(&quot; in (%s)&quot;, strPtr(strLstJoin(dependValueList, &quot;, &quot;)));</span>
<span class="lineNum">     931 </span>                :         : 
<span class="lineNum">     932 </span>                :         :                             // Throw the error
<span class="lineNum">     933 </span>                :<span class="lineCov">       4 :                             THROW(</span>
<span class="lineNum">     934 </span>                :         :                                 OptionInvalidError,
<span class="lineNum">     935 </span>                :         :                                 strPtr(
<span class="lineNum">     936 </span>                :         :                                     strNewFmt(
<span class="lineNum">     937 </span>                :         :                                         &quot;option '%s' not valid without option '%s'%s&quot;, cfgOptionName(optionId),
<span class="lineNum">     938 </span>                :         :                                         strPtr(dependOptionName), strPtr(errorValue))));
<span class="lineNum">     939 </span>                :         :                         }
<span class="lineNum">     940 </span>                :         :                     }
<span class="lineNum">     941 </span>                :         :                 }
<span class="lineNum">     942 </span>                :         : 
<span class="lineNum">     943 </span>                :         :                 // Is the option resolved?
<span class="lineNum">     944 </span>        [<span class="branchCov" title="Branch 0 was taken 1403 times"> + </span><span class="branchCov" title="Branch 1 was taken 893 times"> + </span>]:<span class="lineCov">    2296 :                 if (dependResolved)</span>
<span class="lineNum">     945 </span>                :         :                 {
<span class="lineNum">     946 </span>                :         :                     // Is the option set?
<span class="lineNum">     947 </span>        [<span class="branchCov" title="Branch 0 was taken 101 times"> + </span><span class="branchCov" title="Branch 1 was taken 1302 times"> + </span>]:<span class="lineCov">    1403 :                     if (optionSet)</span>
<span class="lineNum">     948 </span>                :         :                     {
<span class="lineNum">     949 </span>        [<span class="branchCov" title="Branch 0 was taken 8 times"> + </span><span class="branchCov" title="Branch 1 was taken 93 times"> + </span>]:<span class="lineCov">     101 :                         if (optionDefType == cfgDefOptTypeBoolean)</span>
<span class="lineNum">     950 </span>                :         :                         {
<span class="lineNum">     951 </span>                :<span class="lineCov">       8 :                             cfgOptionSet(optionId, parseOption-&gt;source, varNewBool(!parseOption-&gt;negate));</span>
<span class="lineNum">     952 </span>                :         :                         }
<span class="lineNum">     953 </span>        [<span class="branchCov" title="Branch 0 was taken 5 times"> + </span><span class="branchCov" title="Branch 1 was taken 88 times"> + </span>]:<span class="lineCov">      93 :                         else if (optionDefType == cfgDefOptTypeHash)</span>
<span class="lineNum">     954 </span>                :         :                         {
<span class="lineNum">     955 </span>                :<span class="lineCov">       5 :                             Variant *value = varNewKv();</span>
<span class="lineNum">     956 </span>                :<span class="lineCov">       5 :                             KeyValue *keyValue = varKv(value);</span>
<span class="lineNum">     957 </span>                :         : 
<span class="lineNum">     958 </span>        [<span class="branchCov" title="Branch 1 was taken 8 times"> + </span><span class="branchCov" title="Branch 2 was taken 3 times"> + </span>]:<span class="lineCov">      11 :                             for (unsigned int listIdx = 0; listIdx &lt; strLstSize(parseOption-&gt;valueList); listIdx++)</span>
<span class="lineNum">     959 </span>                :         :                             {
<span class="lineNum">     960 </span>                :<span class="lineCov">       8 :                                 const char *pair = strPtr(strLstGet(parseOption-&gt;valueList, listIdx));</span>
<span class="lineNum">     961 </span>                :<span class="lineCov">       8 :                                 const char *equal = strchr(pair, '=');</span>
<span class="lineNum">     962 </span>                :         : 
<span class="lineNum">     963 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 6 times"> + </span>]:<span class="lineCov">       8 :                                 if (equal == NULL)</span>
<span class="lineNum">     964 </span>                :         :                                 {
<span class="lineNum">     965 </span>                :<span class="lineCov">       2 :                                     THROW_FMT(</span>
<span class="lineNum">     966 </span>                :         :                                         OptionInvalidError, &quot;key/value '%s' not valid for '%s' option&quot;,
<span class="lineNum">     967 </span>                :         :                                         strPtr(strLstGet(parseOption-&gt;valueList, listIdx)), cfgOptionName(optionId));
<span class="lineNum">     968 </span>                :         :                                 }
<span class="lineNum">     969 </span>                :         : 
<span class="lineNum">     970 </span>                :<span class="lineCov">       6 :                                 kvPut(keyValue, varNewStr(strNewN(pair, (size_t)(equal - pair))), varNewStr(strNew(equal + 1)));</span>
<span class="lineNum">     971 </span>                :         :                             }
<span class="lineNum">     972 </span>                :         : 
<span class="lineNum">     973 </span>                :<span class="lineCov">       3 :                             cfgOptionSet(optionId, parseOption-&gt;source, value);</span>
<span class="lineNum">     974 </span>                :         :                         }
<span class="lineNum">     975 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 86 times"> + </span>]:<span class="lineCov">      88 :                         else if (optionDefType == cfgDefOptTypeList)</span>
<span class="lineNum">     976 </span>                :         :                         {
<span class="lineNum">     977 </span>                :<span class="lineCov">       2 :                             cfgOptionSet(optionId, parseOption-&gt;source, varNewVarLst(varLstNewStrLst(parseOption-&gt;valueList)));</span>
<span class="lineNum">     978 </span>                :         :                         }
<span class="lineNum">     979 </span>                :         :                         else
<span class="lineNum">     980 </span>                :         :                         {
<span class="lineNum">     981 </span>                :<span class="lineCov">      86 :                             String *value = strLstGet(parseOption-&gt;valueList, 0);</span>
<span class="lineNum">     982 </span>                :         : 
<span class="lineNum">     983 </span>                :         :                             // If a numeric type check that the value is valid
<span class="lineNum">     984 </span>[<span class="branchCov" title="Branch 0 was taken 78 times"> + </span><span class="branchCov" title="Branch 1 was taken 8 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 76 times"> + </span><span class="branchCov" title="Branch 3 was taken 2 times"> + </span>]:<span class="lineCov">      86 :                             if (optionDefType == cfgDefOptTypeInteger || optionDefType == cfgDefOptTypeFloat ||</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 4 was taken 6 times"> + </span><span class="branchCov" title="Branch 5 was taken 70 times"> + </span>]
<span class="lineNum">     985 </span>                :         :                                 optionDefType == cfgDefOptTypeSize)
<span class="lineNum">     986 </span>                :         :                             {
<span class="lineNum">     987 </span>                :<span class="lineCov">      16 :                                 double valueDbl = 0;</span>
<span class="lineNum">     988 </span>                :         : 
<span class="lineNum">     989 </span>                :         :                                 // Check that the value can be converted
<span class="lineNum">     990 </span>                :<span class="lineCov">      51 :                                 TRY_BEGIN()</span>
<span class="lineNum">     991 </span>                :         :                                 {
<span class="lineNum">     992 </span>                :         : 
<span class="lineNum">     993 </span>        [<span class="branchCov" title="Branch 0 was taken 8 times"> + </span><span class="branchCov" title="Branch 1 was taken 8 times"> + </span>]:<span class="lineCov">      16 :                                     if (optionDefType == cfgDefOptTypeInteger)</span>
<span class="lineNum">     994 </span>                :         :                                     {
<span class="lineNum">     995 </span>                :<span class="lineCov">       8 :                                         valueDbl = (double)varInt64Force(varNewStr(value));</span>
<span class="lineNum">     996 </span>                :         :                                     }
<span class="lineNum">     997 </span>        [<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>]:<span class="lineCov">       8 :                                     else if (optionDefType == cfgDefOptTypeSize)</span>
<span class="lineNum">     998 </span>                :         :                                     {
<span class="lineNum">     999 </span>                :<span class="lineCov">       6 :                                         convertToByte(&amp;value, &amp;valueDbl);</span>
<span class="lineNum">    1000 </span>                :         :                                     }
<span class="lineNum">    1001 </span>                :         :                                     else
<span class="lineNum">    1002 </span>                :<span class="lineCov">      14 :                                         valueDbl = varDblForce(varNewStr(value));</span>
<span class="lineNum">    1003 </span>                :         :                                 }
<span class="lineNum">    1004 </span>                :<span class="lineCov">      19 :                                 CATCH(AssertError)</span>
<span class="lineNum">    1005 </span>                :         :                                 {
<span class="lineNum">    1006 </span>                :<span class="lineNoCov">       0 :                                     RETHROW();                      // {uncovered - asserts can't currently happen here this is JIC}</span>
<span class="lineNum">    1007 </span>                :         :                                 }
<span class="lineNum">    1008 </span>                :<span class="lineCov">      19 :                                 CATCH_ANY()</span>
<span class="lineNum">    1009 </span>                :         :                                 {
<span class="lineNum">    1010 </span>                :<span class="lineCov">       3 :                                     THROW_FMT(</span>
<span class="lineNum">    1011 </span>                :         :                                         OptionInvalidValueError, &quot;'%s' is not valid for '%s' option&quot;, strPtr(value),
<span class="lineNum">    1012 </span>                :         :                                         cfgOptionName(optionId));
<span class="lineNum">    1013 </span>                :         :                                 }
<span class="lineNum">    1014 </span>                :         :                                 TRY_END();
<span class="lineNum">    1015 </span>                :         : 
<span class="lineNum">    1016 </span>                :         :                                 // Check value range
<span class="lineNum">    1017 </span>  [<span class="branchCov" title="Branch 1 was taken 10 times"> + </span><span class="branchCov" title="Branch 2 was taken 3 times"> + </span><span class="branchCov" title="Branch 3 was taken 8 times"> + </span><span class="branchCov" title="Branch 4 was taken 2 times"> + </span>]:<span class="lineCov">      23 :                                 if (cfgDefOptionAllowRange(commandDefId, optionDefId) &amp;&amp;</span>
<span class="lineNum">    1018 </span>        [<span class="branchCov" title="Branch 1 was taken 2 times"> + </span><span class="branchCov" title="Branch 2 was taken 6 times"> + </span>]:<span class="lineCov">      18 :                                     (valueDbl &lt; cfgDefOptionAllowRangeMin(commandDefId, optionDefId) ||</span>
<span class="lineNum">    1019 </span>                :<span class="lineCov">       8 :                                      valueDbl &gt; cfgDefOptionAllowRangeMax(commandDefId, optionDefId)))</span>
<span class="lineNum">    1020 </span>                :         :                                 {
<span class="lineNum">    1021 </span>                :<span class="lineCov">      13 :                                     THROW_FMT(</span>
<span class="lineNum">    1022 </span>                :         :                                         OptionInvalidValueError, &quot;'%s' is out of range for '%s' option&quot;, strPtr(value),
<span class="lineNum">    1023 </span>                :         :                                         cfgOptionName(optionId));
<span class="lineNum">    1024 </span>                :         :                                 }
<span class="lineNum">    1025 </span>                :         :                             }
<span class="lineNum">    1026 </span>                :         : 
<span class="lineNum">    1027 </span>                :         :                             // If the option has an allow list then check it
<span class="lineNum">    1028 </span>  [<span class="branchCov" title="Branch 1 was taken 9 times"> + </span><span class="branchCov" title="Branch 2 was taken 70 times"> + </span><span class="branchCov" title="Branch 3 was taken 1 time"> + </span><span class="branchCov" title="Branch 4 was taken 8 times"> + </span>]:<span class="lineCov">      88 :                             if (cfgDefOptionAllowList(commandDefId, optionDefId) &amp;&amp;</span>
<span class="lineNum">    1029 </span>                :<span class="lineCov">       9 :                                 !cfgDefOptionAllowListValueValid(commandDefId, optionDefId, strPtr(value)))</span>
<span class="lineNum">    1030 </span>                :         :                             {
<span class="lineNum">    1031 </span>                :<span class="lineCov">       1 :                                 THROW_FMT(</span>
<span class="lineNum">    1032 </span>                :         :                                     OptionInvalidValueError, &quot;'%s' is not allowed for '%s' option&quot;, strPtr(value),
<span class="lineNum">    1033 </span>                :         :                                     cfgOptionName(optionId));
<span class="lineNum">    1034 </span>                :         :                             }
<span class="lineNum">    1035 </span>                :         : 
<span class="lineNum">    1036 </span>                :<span class="lineCov">      91 :                             cfgOptionSet(optionId, parseOption-&gt;source, varNewStr(value));</span>
<span class="lineNum">    1037 </span>                :         :                         }
<span class="lineNum">    1038 </span>                :         :                     }
<span class="lineNum">    1039 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 1300 times"> + </span>]:<span class="lineCov">    1302 :                     else if (parseOption-&gt;negate)</span>
<span class="lineNum">    1040 </span>                :<span class="lineCov">       2 :                         cfgOptionSet(optionId, parseOption-&gt;source, NULL);</span>
<span class="lineNum">    1041 </span>                :         :                     // Else try to set a default
<span class="lineNum">    1042 </span>                :         :                     else
<span class="lineNum">    1043 </span>                :         :                     {
<span class="lineNum">    1044 </span>                :         :                         // Get the default value for this option
<span class="lineNum">    1045 </span>                :<span class="lineCov">    1300 :                         const char *value = cfgDefOptionDefault(commandDefId, optionDefId);</span>
<span class="lineNum">    1046 </span>                :         : 
<span class="lineNum">    1047 </span>        [<span class="branchCov" title="Branch 0 was taken 748 times"> + </span><span class="branchCov" title="Branch 1 was taken 552 times"> + </span>]:<span class="lineCov">    1300 :                         if (value != NULL)</span>
<span class="lineNum">    1048 </span>                :<span class="lineCov">     748 :                             cfgOptionSet(optionId, cfgSourceDefault, varNewStrZ(value));</span>
<span class="lineNum">    1049 </span>        [<span class="branchCov" title="Branch 1 was taken 188 times"> + </span><span class="branchCov" title="Branch 2 was taken 364 times"> + </span>]:<span class="lineCov">     556 :                         else if (cfgOptionIndex(optionId) == 0 &amp;&amp; cfgDefOptionRequired(commandDefId, optionDefId) &amp;&amp;</span>
<span class="lineNum">         </span>  [<span class="branchCov" title="Branch 4 was taken 4 times"> + </span><span class="branchCov" title="Branch 5 was taken 184 times"> + </span><span class="branchCov" title="Branch 6 was taken 2 times"> + </span><span class="branchCov" title="Branch 7 was taken 2 times"> + </span>]
<span class="lineNum">    1050 </span>                :<span class="lineCov">       4 :                                  !cfgCommandHelp())</span>
<span class="lineNum">    1051 </span>                :         :                         {
<span class="lineNum">    1052 </span>                :<span class="lineCov">       2 :                             const char *hint = &quot;&quot;;</span>
<span class="lineNum">    1053 </span>                :         : 
<span class="lineNum">    1054 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchCov" title="Branch 2 was taken 1 time"> + </span>]:<span class="lineCov">       2 :                             if (cfgDefOptionSection(optionDefId) == cfgDefSectionStanza)</span>
<span class="lineNum">    1055 </span>                :<span class="lineCov">       1 :                                 hint = &quot;\nHINT: does this stanza exist?&quot;;</span>
<span class="lineNum">    1056 </span>                :         : 
<span class="lineNum">    1057 </span>                :<span class="lineCov">       2 :                             THROW_FMT(</span>
<span class="lineNum">    1058 </span>                :         :                                 OptionRequiredError, &quot;%s command requires option: %s%s&quot;, cfgCommandName(cfgCommand()),
<span class="lineNum">    1059 </span>                :         :                                 cfgOptionName(optionId), hint);
<span class="lineNum">    1060 </span>                :         :                         }
<span class="lineNum">    1061 </span>                :         :                     }
<span class="lineNum">    1062 </span>                :         :                 }
<span class="lineNum">    1063 </span>                :         :             }
<span class="lineNum">    1064 </span>                :         :         }
<span class="lineNum">    1065 </span>                :         :     }
<span class="lineNum">    1066 </span>                :<span class="lineCov">     200 :     MEM_CONTEXT_TEMP_END();</span>
<span class="lineNum">    1067 </span>                :         : 
<span class="lineNum">    1068 </span>                :<span class="lineCov">      16 :     FUNCTION_DEBUG_RESULT_VOID();</span>
<span class="lineNum">    1069 </span>                :<span class="lineCov">      16 : }</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.13</a></td></tr>
  </table>
  <br>

</body>
</html>
